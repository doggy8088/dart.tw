<!DOCTYPE html><html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Language" content="zh-cmn-Hans">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Google Tag Manager -->
<!--  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':-->
<!--  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],-->
<!--  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=-->
<!--  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);-->
<!--  })(window,document,'script','dataLayer','GTM-5VSZM5J');</script>-->
  <!-- End Google Tag Manager -->

  <meta name="description" content="Publish Dart packages to pub.dev directly from GitHub Actions.">
  <title>Automated publishing of packages to pub.dev | Dart</title>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-28P0PYCRZ9"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-28P0PYCRZ9');
  </script>

  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?fa71f2474b82505e00203cf9956cf0bc";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>

  <!-- Favicon / Touch Icons -->
  <link rel="icon" sizes="64x64" href="/assets/shared/dart/icon/64.png">
  <link href="/assets/img/touch-icon-iphone.png" rel="apple-touch-icon">
  <link href="/assets/img/touch-icon-ipad.png" rel="apple-touch-icon" sizes="152x152">
  <link href="/assets/img/touch-icon-iphone-retina.png" rel="apple-touch-icon" sizes="180x180">
  <link href="/assets/img/touch-icon-ipad-retina.png" rel="apple-touch-icon" sizes="167x167">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@dart_lang">
  <meta name="twitter:title" content="Automated publishing of packages to pub.dev">
  <meta name="twitter:description" content="Publish Dart packages to pub.dev directly from GitHub Actions.">

  <!-- Open Graph -->
  <meta property="og:title" content="Automated publishing of packages to pub.dev">
  <meta property="og:description" content="Publish Dart packages to pub.dev directly from GitHub Actions.">
  <meta property="og:url" content="https://dart.tw.gh.miniasp.com/tools/pub/automated-publishing.html">

  <meta property="og:image" content="https://dart.tw.gh.miniasp.com/assets/shared/dart-logo-for-shares.png?2">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
  <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&amp;display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Google+Sans+Display:wght@400&amp;display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Google+Sans+Mono:wght@400;500;700&amp;display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&amp;display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons&amp;display=swap" rel="stylesheet">
  <script src="https://cdn.staticfile.org/font-awesome/5.15.4/js/all.js" data-auto-replace-svg="nest">
  </script>

  <link rel="stylesheet" href="/assets/css/main.css?v=1693674404">
  <script src="https://cdn.staticfile.org/jquery/3.7.0/jquery.min.js" integrity="sha512-3gJwYpMe3QewGELv8k/BX9vcqhryRdzRMxVfq6ngyWXwo03GFEzjsUm8Q7RZcHPHksttq7/GFoxjCVUjkjvPdw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdn.staticfile.org/popper.js/1.16.1/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdn.staticfile.org/bootstrap/4.6.2/js/bootstrap.min.js" integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <!-- <script src="https://cdn.staticfile.org/js-cookie/3.0.5/js.cookie.min.js"
          integrity="sha512-nlp9/l96/EpjYBx7EP7pGASVXNe80hGhYAUrjeXnu/fyF5Py0/RXav4BBNs7n5Hx1WFhOEOWSAVjGeC3oKxDVQ=="
          crossorigin="anonymous"
          referrerpolicy="no-referrer"></script> -->

  <script src="/assets/js/vendor/code-prettify/prettify.js"></script>
  <script src="/assets/js/vendor/code-prettify/lang-dart.js"></script>
  <script src="/assets/js/vendor/code-prettify/lang-yaml.js"></script>
  <script src="/assets/js/os-tabs.js?v=1693674404"></script>
  <script src="/assets/js/utilities.js?v=1693674404"></script>
  <script src="/assets/js/main.js?v=1693674404"></script>

  <script>

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-122680122-5', 'auto');
ga('send', 'pageview');

</script>


 <link href="/assets/translator/css/translator.css" rel="stylesheet"></head>

  <body class="default show_banner">
    <section id="cookie-notice">
  <div class="container">
    <p>Google uses cookies to deliver its services, to personalize ads, and to 
      analyze traffic. You can adjust your privacy controls anytime in your 
      <a href="https://myaccount.google.com/data-and-personalization" target="_blank" rel="noopener" class="no-automatic-external">Google settings</a>. 
      <a href="https://policies.google.com/technologies/cookies" target="_blank" rel="noopener" class="no-automatic-external">Learn more</a>.
    </p>
    <button id="cookie-consent" class="btn btn-primary">Okay</button>
  </div>
</section>

    <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=G-28P0PYCRZ9"
 height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

    <header id="page-header" class="site-header">
  <nav id="mainnav" class="site-header">
  <div id="menu-toggle"><i class="material-icons">menu</i></div>
  <a href="/" class="brand" title="Dart">
    <img src="/assets/img/shared/dart/logo+text/horizontal/white.svg" alt="Dart">
  </a>
  <ul class="navbar">
    <li>
      <a href="/overview" class="nav-link">概覽</a>
    </li>
    <li class="mainnav__get-started">
      <a href="/guides" class="nav-link
         active">
        <span>文件</span>
      </a>
    </li>
    <li>
      <a href="/community" class="nav-link">社群</a>
    </li>
    <li>
      <a href="/#try-dart" class="nav-link">嘗試 Dart</a>
    </li>
    <li>
      <a href="/get-dart" class="nav-link">獲取 Dart SDK</a>
    </li>
    <li class="searchfield">
      <form action="/search" class="site-header__search form-inline" id="cse-search-box">
        <input type="hidden" name="cx" value="011220921317074318178:_yy-tmb5t_i">
        <input type="hidden" name="ie" value="UTF-8">
        <input type="hidden" name="hl" value="en">
        <input class="site-header__searchfield form-control search-field" type="search" name="q" id="q" autocomplete="off" placeholder="Search" aria-label="Search">
      </form>
    </li>
  </ul>
</nav>

  
</header>
 <div class="banner">
  <p class="banner__text">
    Dart 3 已釋出！帶來了全新的
    <a href="https://dart.tw.gh.miniasp.com/language/records" class="no-automatic-external">記錄型別 (records)</a>、
    <a href="https://dart.tw.gh.miniasp.com/language/patterns" class="no-automatic-external">模式匹配 (patterns)</a>
    以及 <a href="https://dart.tw.gh.miniasp.com/language/class-modifiers" class="no-automatic-external">型別修飾符 (class modifiers)</a>。
    <br>
    <!--<a href="https://medium.com/p/53f065a10635" class="no-automatic-external">Check out the blog post</a>!-->
  </p>
</div>
 

    <div id="sidenav" class="">
  <form action="/search/" class="site-header__search form-inline">
    <input class="site-header__searchfield form-control search-field" type="search" name="q" id="q" autocomplete="off" placeholder="Search" aria-label="Search">
  </form>

  <div class="site-sidebar">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a href="/overview" class="nav-link">概覽</a>
      </li>
      <li class="nav-item">
        <a href="/community" class="nav-link">社群</a>
      </li>
      <li class="nav-item">
        <a href="https://dartpad.dev" class="nav-link">嘗試 Dart</a>
      </li>
      <li class="nav-item">
        <a href="/get-dart" class="nav-link">獲取 Dart SDK</a>
      </li>
      <li class="nav-item">
        <a href="/guides" class="nav-link active">文件</a>
      </li>
    </ul>

    <ul class="nav flex-column"><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-1" role="button" aria-expanded="false" aria-controls="sidenav-1">範例和課程</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-1">
        <li class="nav-item">
    <a class="nav-link" href="/tutorials">語言概覽</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable" data-toggle="collapse" data-target="#sidenav-1-2" href="#sidenav-1-2" role="button" aria-expanded="true" aria-controls="sidenav-1-2">Codelabs
    </a>
    <ul class="nav flex-column flex-nowrap collapse show" id="sidenav-1-2">
      <li class="nav-item">
    <a class="nav-link" href="/codelabs">Codelabs 列表</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/codelabs/dart-cheatsheet">Dart 速查表</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/codelabs/iterables">可迭代集合</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/codelabs/async-await">Dart 非同步程式設計</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/codelabs/null-safety">空安全</a>
  </li></ul>
  </li>

</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-2" role="button" aria-expanded="false" aria-controls="sidenav-2">Dart 開發語言</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2">
        <li class="nav-item">
    <a class="nav-link" href="/language">介紹</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-2-2" href="#sidenav-2-2" role="button" aria-expanded="false" aria-controls="sidenav-2-2">基礎表示式
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2-2">
      <li class="nav-item">
    <a class="nav-link" href="/language/variables">變數</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/operators">運運算元</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/comments">註釋</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/metadata">註解</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/libraries">庫 &amp; 導庫</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/keywords">關鍵字</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-2-3" href="#sidenav-2-3" role="button" aria-expanded="false" aria-controls="sidenav-2-3">型別
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2-3">
      <li class="nav-item">
    <a class="nav-link" href="/language/built-in-types">基本型別</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/records">記錄 (Records)</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/collections">集合 (Collections)</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/generics">泛型 (Generics)</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/typedefs">別名 (Typedefs)</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/type-system">型別系統</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-2-4" href="#sidenav-2-4" role="button" aria-expanded="false" aria-controls="sidenav-2-4">模式匹配
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2-4">
      <li class="nav-item">
    <a class="nav-link" href="/language/patterns">概覽 &amp; 用法</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/pattern-types">模式匹配型別</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link" href="/language/functions">函式方法</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-2-6" href="#sidenav-2-6" role="button" aria-expanded="false" aria-controls="sidenav-2-6">控制流
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2-6">
      <li class="nav-item">
    <a class="nav-link" href="/language/loops">迴圈</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/branches">分支</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link" href="/language/error-handling">錯誤處理</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-2-8" href="#sidenav-2-8" role="button" aria-expanded="false" aria-controls="sidenav-2-8">類 &amp; 物件
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2-8">
      <li class="nav-item">
    <a class="nav-link" href="/language/classes">類</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/constructors">構造方法</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/methods">成員方法</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/extend">繼承</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/mixins">混入 (Mixin)</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/enums">列舉</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/extension-methods">擴充方法</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/callable-objects">可呼叫的物件</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-2-9" href="#sidenav-2-9" role="button" aria-expanded="false" aria-controls="sidenav-2-9">型別修飾符
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2-9">
      <li class="nav-item">
    <a class="nav-link" href="/language/class-modifiers">概覽 &amp; 用法</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/class-modifiers-for-apis">API 維護者應該用的型別修飾符</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/modifier-reference">速查表</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-2-10" href="#sidenav-2-10" role="button" aria-expanded="false" aria-controls="sidenav-2-10">併發
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2-10">
      <li class="nav-item">
    <a class="nav-link" href="/language/async">非同步支援</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/concurrency">Isolates</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-2-11" href="#sidenav-2-11" role="button" aria-expanded="false" aria-controls="sidenav-2-11">Null safety
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2-11">
      <li class="nav-item">
    <a class="nav-link" href="/null-safety">健全的空安全</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/null-safety/migration-guide">遷移到空安全</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/null-safety/understanding-null-safety">深入理解空安全</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/null-safety/unsound-null-safety">非健全的空安全</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/null-safety/faq">空安全常見問題和解答</a>
  </li></ul>
  </li>

</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-3" role="button" aria-expanded="false" aria-controls="sidenav-3">高效指南 (Effective Dart)</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-3">
        <li class="nav-item">
    <a class="nav-link" href="/effective-dart">概述</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/effective-dart/style">程式碼風格</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/effective-dart/documentation">文件</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/effective-dart/usage">用法範例</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/effective-dart/design">API 設計</a>
  </li>
</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-4" role="button" aria-expanded="false" aria-controls="sidenav-4">核心函式庫</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-4">
        <li class="nav-item">
    <a class="nav-link" href="/guides/libraries">概覽</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/libraries/library-tour">概覽</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-4-3" href="#sidenav-4-3" role="button" aria-expanded="false" aria-controls="sidenav-4-3">介紹文章
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-4-3">
      <li class="nav-item">
    <a class="nav-link" href="/articles/libraries/creating-streams">建立 stream</a>
  </li></ul>
  </li>

</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-5" role="button" aria-expanded="false" aria-controls="sidenav-5">Packages</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-5">
        <li class="nav-item">
    <a class="nav-link" href="/guides/packages">如何使用 package</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/libraries/useful-libraries">常用 package 介紹</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/libraries/create-packages">建立 package</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/pub/publishing">釋出 package</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/libraries/writing-package-pages">設定 package 介紹頁</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-5-6" href="#sidenav-5-6" role="button" aria-expanded="false" aria-controls="sidenav-5-6">Package 參考資料
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-5-6">
      <li class="nav-item">
    <a class="nav-link" href="/tools/pub/dependencies">依賴</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/pub/glossary">術語表</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/pub/package-layout">Package 檔案結構</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/pub/environment-variables">設定環境變數</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/pub/pubspec">Pubspec 檔案</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/pub/troubleshoot">問題排查</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/pub/verified-publishers">釋出者認證</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/pub/versioning">版本管理</a>
  </li></ul>
  </li>

</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-6" role="button" aria-expanded="false" aria-controls="sidenav-6">開發文件</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-6">
        <li class="nav-item">
    <a class="nav-link" href="/codelabs/async-await">Futures、async 和 await</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tutorials/language/streams">Streams 介紹</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/json">使用 JSON</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/language/numbers">Dart 中的數字</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-6-5" href="#sidenav-6-5" role="button" aria-expanded="false" aria-controls="sidenav-6-5">與其他語言進行互動呼叫
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-6-5">
      <li class="nav-item">
    <a class="nav-link" href="/guides/libraries/c-interop">與 C 互調</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/libraries/objective-c-interop">與 Objective-C 和 Swift 互調</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/libraries/java-interop">與 Java 和 Kotlin 互調</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/web/js-interop">與 JavaScript 互調</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link" href="/guides/google-apis">Google APIs</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/multiplatform-apps">跨平臺應用</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-6-8" href="#sidenav-6-8" role="button" aria-expanded="false" aria-controls="sidenav-6-8">命令列和伺服器端應用
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-6-8">
      <li class="nav-item">
    <a class="nav-link" href="/server">概覽</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tutorials/server/get-started">起步課程</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tutorials/server/cmdline">命令列應用</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tutorials/server/fetch-data">從網路上獲取資料</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tutorials/server/httpserver">編寫 HTTP 伺服器端應用</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/server/libraries">庫和 package</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/server/google-cloud">Google Cloud</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-6-9" href="#sidenav-6-9" role="button" aria-expanded="false" aria-controls="sidenav-6-9">網頁端 (Web) 應用
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-6-9">
      <li class="nav-item">
    <a class="nav-link" href="/web">概覽</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tutorials/web/get-started">開始使用</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-6-9-3" href="#sidenav-6-9-3" role="button" aria-expanded="false" aria-controls="sidenav-6-9-3">底層 Web 程式設計
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-6-9-3">
      <li class="nav-item">
    <a class="nav-link" href="/tutorials/web/low-level-html/connect-dart-html">Dart 與 HTML 關聯</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tutorials/web/low-level-html/add-elements">向 DOM 新增元素</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tutorials/web/low-level-html/remove-elements">移除 DOM 元素</a>
  </li>
  </ul>
  </li>
<li class="nav-item">
    <a class="nav-link" href="/web/deployment">部署</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/web/libraries">常用 Web 函式庫和 package</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link" href="/guides/environment-declarations">環境變數宣告</a>
  </li>
</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-7" role="button" aria-expanded="false" aria-controls="sidenav-7">開發工具和使用技巧</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-7">
        <li class="nav-item">
    <a class="nav-link" href="/tools">概覽</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-7-2" href="#sidenav-7-2" role="button" aria-expanded="false" aria-controls="sidenav-7-2">編輯器和除錯工具
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-7-2">
      <li class="nav-item">
    <a class="nav-link" href="/tools/jetbrains-plugin">使用 IntelliJ 和 Android Studio</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/vs-code">使用 VS Code</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/dart-devtools">Dart 開發者工具</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-7-2-4" href="#sidenav-7-2-4" role="button" aria-expanded="false" aria-controls="sidenav-7-2-4">線上執行 Dart 程式碼
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-7-2-4">
      <li class="nav-item">
    <a class="nav-link" href="/tools/dartpad">Overview</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dartpad/dartpad-best-practices">DartPad 課程</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dartpad/troubleshoot">DartPad 疑難解答</a>
  </li>
  </ul>
  </li>
</ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-7-3" href="#sidenav-7-3" role="button" aria-expanded="false" aria-controls="sidenav-7-3">命令列工具
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-7-3">
      <li class="nav-item">
    <a class="nav-link collapsable" data-toggle="collapse" data-target="#sidenav-7-3-1" href="#sidenav-7-3-1" role="button" aria-expanded="true" aria-controls="sidenav-7-3-1">Dart SDK
    </a>
    <ul class="nav flex-column flex-nowrap collapse show" id="sidenav-7-3-1">
      <li class="nav-item">
    <a class="nav-link" href="/tools/sdk">概覽</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-tool">dart 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-analyze">dart analyze 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-compile">dart compile 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-create">dart create 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-doc">dart doc 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-fix">dart fix 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-format">dart format 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-info">dart info 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/pub/cmd">dart pub 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-run">dart run 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-test">dart test 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dartaotruntime">dartaotruntime 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/experiment-flags">實驗性命令標記</a>
  </li>
  </ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable" data-toggle="collapse" data-target="#sidenav-7-3-2" href="#sidenav-7-3-2" role="button" aria-expanded="true" aria-controls="sidenav-7-3-2">其他的命令列工具
    </a>
    <ul class="nav flex-column flex-nowrap collapse show" id="sidenav-7-3-2">
      <li class="nav-item">
    <a class="nav-link" href="/tools/build_runner">build_runner 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/webdev">webdev 命令</a>
  </li>
  </ul>
  </li>
</ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-7-4" href="#sidenav-7-4" role="button" aria-expanded="false" aria-controls="sidenav-7-4">原始碼管理
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-7-4">
      <li class="nav-item">
    <a class="nav-link" href="/guides/language/formatting">程式碼格式化</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/libraries/private-files">不應提交的內容</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-7-5" href="#sidenav-7-5" role="button" aria-expanded="false" aria-controls="sidenav-7-5">靜態分析
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-7-5">
      <li class="nav-item">
    <a class="nav-link" href="/tools/analysis">自訂靜態分析</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/language/sound-problems">修復常見的型別問題</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/diagnostic-messages">診斷訊息</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/linter-rules">Linter 規則</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-7-6" href="#sidenav-7-6" role="button" aria-expanded="false" aria-controls="sidenav-7-6">測試和調優
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-7-6">
      <li class="nav-item">
    <a class="nav-link" href="/guides/testing">測試</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/web/debugging">除錯 Web 應用</a>
  </li></ul>
  </li>

</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-8" role="button" aria-expanded="false" aria-controls="sidenav-8">資源</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-8">
        <li class="nav-item">
    <a class="nav-link" href="/resources/faq">常見問題</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/language/evolution">版本演變</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/language/spec">語言規範</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/resources/dart-3-migration">Dart 3 遷移指南</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-8-5" href="#sidenav-8-5" role="button" aria-expanded="false" aria-controls="sidenav-8-5">從其他平台轉向 Dart
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-8-5">
      <li class="nav-item">
    <a class="nav-link" href="/guides/language/coming-from/js-to-dart">從 JavaScript 到 Dart</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/language/coming-from/swift-to-dart">從 Swift 到 Dart</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link" href="/resources/glossary">詞彙表</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/resources/books">書籍資源</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/resources/videos">影片資源</a>
  </li>
</ul>
    </li><li class="nav-item">
      <a class="nav-link " data-toggle="collapse" href="#sidenav-9" role="button" aria-expanded="true" aria-controls="sidenav-9">相關站點</a>

      <ul class="nav flex-column flex-nowrap collapse show" id="sidenav-9">
        <li class="nav-item">
    <a class="nav-link" href="https://api.dart.dev" target="_blank" rel="noopener">API 文件<span class="material-icons md-24">
        open_in_new
      </span></a>
  </li><li class="nav-item">
    <a class="nav-link" href="https://medium.com/dartlang" target="_blank" rel="noopener">Dart 團隊官方部落格<span class="material-icons md-24">
        open_in_new
      </span></a>
  </li><li class="nav-item">
    <a class="nav-link" href="https://dartpad.dev" target="_blank" rel="noopener">DartPad (線上編輯器)<span class="material-icons md-24">
        open_in_new
      </span></a>
  </li><li class="nav-item">
    <a class="nav-link" href="https://flutter.tw" target="_blank" rel="noopener">Flutter<span class="material-icons md-24">
        open_in_new
      </span></a>
  </li><li class="nav-item">
    <a class="nav-link" href="https://pub.dev" target="_blank" rel="noopener">Package 網站<span class="material-icons md-24">
        open_in_new
      </span></a>
  </li>
</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-10" role="button" aria-expanded="false" aria-controls="sidenav-10">關於 Dart 中文文件</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-10">
        <li class="nav-item">
    <a class="nav-link" href="https://flutter.tw/about/docs-cn" target="_blank" rel="noopener">關於本站<span class="material-icons md-24">
        open_in_new
      </span></a>
  </li><li class="nav-item">
    <a class="nav-link" href="https://flutter.tw/disclaimer" target="_blank" rel="noopener">免責條款 (Disclaimer)<span class="material-icons md-24">
        open_in_new
      </span></a>
  </li>
</ul>
    </li></ul>

  </div>
</div>

    <main id="page-content">
      







<div id="site-toc--side" class="site-toc ">
  <header class="site-toc__title">
    目錄
    
  </header>
  <ul id="toc" class="section-nav">
<li class="toc-entry nav-item toc-h2"><a class="nav-link" href="#publishing-packages-using-github-actions">Publishing packages using GitHub Actions</a>
<ul class="nav">
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#configuring-automated-publishing-from-github-actions-on-pubdev">Configuring automated publishing from GitHub Actions on pub.dev</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#configuring-a-github-action-workflow-for-publishing-to-pubdev">Configuring a GitHub Action workflow for publishing to pub.dev</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#triggering-automated-publishing-from-github-actions">Triggering automated publishing from GitHub Actions</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#hardening-security-with-tag-protection-rules-on-github">Hardening security with tag protection rules on GitHub</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#hardening-security-with-github-deployment-environments">Hardening security with GitHub Deployment Environments</a></li>
</ul>
</li>
<li class="toc-entry nav-item toc-h2"><a class="nav-link" href="#publishing-from-google-cloud-build">Publishing from Google Cloud Build</a>
<ul class="nav">
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#creating-a-service-account-for-publishing">Creating a service account for publishing</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#granting-cloud-build-permission-to-publish">Granting Cloud Build permission to publish</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#writing-a-cloud-build-configuration-file">Writing a Cloud Build configuration file</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#creating-a-cloud-build-trigger">Creating a Cloud Build trigger</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#hardening-security-with-cloud-build-approvals">Hardening security with Cloud Build Approvals</a></li>
</ul>
</li>
<li class="toc-entry nav-item toc-h2"><a class="nav-link" href="#publish-from-anywhere-using-a-service-account">Publish from anywhere using a Service Account</a>
<ul class="nav">
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#publish-using-workload-identity-federation">Publish using Workload Identity Federation</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#publish-using-exported-service-account-keys">Publish using Exported Service Account Keys</a></li>
</ul>
</li>
</ul>
  
</div>


      <article>
        <div class="content">
          

          <div id="site-content-title">
            <div id="page-github-links" class="btn-group" aria-label="Page GitHub links" role="group">
  <a href="https://github.com/doggy8088/dart.tw/tree/master/src/tools/pub/automated-publishing.md" class="btn no-automatic-external" title="View page source" target="_blank" rel="noopener">
    <i class="material-icons">description</i>
  </a>
  <a href="https://github.com/doggy8088/dart.tw/issues/new?template=1_page_issue.yml&amp;title=[PAGE ISSUE]: 'Automated publishing of packages to pub.dev'&amp;page-url=https://dart.tw.gh.miniasp.com/tools/pub/automated-publishing.html&amp;page-source=https://github.com/doggy8088/dart.tw/tree/master/src/tools/pub/automated-publishing.md" class="btn no-automatic-external" title="Report an issue with this page" target="_blank" rel="noopener">
    <i class="material-icons">bug_report</i>
  </a>
</div>

            
            <h1 id="automated-publishing-of-packages-to-pubdev">Automated publishing of packages to pub.dev</h1>
            </div>
          







<div id="site-toc--inline" class="site-toc toc-collapsible toc-collapsed">
  <header class="site-toc__title">
    目錄
    
      <span class="site-toc--inline__toggle toc-toggle-down"><i class="material-icons">keyboard_arrow_down</i></span>
      <span class="site-toc--inline__toggle toc-toggle-up"><i class="material-icons">keyboard_arrow_up</i></span>
    
  </header>
  <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#publishing-packages-using-github-actions">Publishing packages using GitHub Actions</a>
<ul>
<li class="toc-entry toc-h3"><a href="#configuring-automated-publishing-from-github-actions-on-pubdev">Configuring automated publishing from GitHub Actions on pub.dev</a></li>
<li class="toc-entry toc-h3"><a href="#configuring-a-github-action-workflow-for-publishing-to-pubdev">Configuring a GitHub Action workflow for publishing to pub.dev</a></li>
<li class="toc-entry toc-h3"><a href="#triggering-automated-publishing-from-github-actions">Triggering automated publishing from GitHub Actions</a></li>
<li class="toc-entry toc-h3"><a href="#hardening-security-with-tag-protection-rules-on-github">Hardening security with tag protection rules on GitHub</a></li>
<li class="toc-entry toc-h3"><a href="#hardening-security-with-github-deployment-environments">Hardening security with GitHub Deployment Environments</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#publishing-from-google-cloud-build">Publishing from Google Cloud Build</a>
<ul>
<li class="toc-entry toc-h3"><a href="#creating-a-service-account-for-publishing">Creating a service account for publishing</a></li>
<li class="toc-entry toc-h3"><a href="#granting-cloud-build-permission-to-publish">Granting Cloud Build permission to publish</a></li>
<li class="toc-entry toc-h3"><a href="#writing-a-cloud-build-configuration-file">Writing a Cloud Build configuration file</a></li>
<li class="toc-entry toc-h3"><a href="#creating-a-cloud-build-trigger">Creating a Cloud Build trigger</a></li>
<li class="toc-entry toc-h3"><a href="#hardening-security-with-cloud-build-approvals">Hardening security with Cloud Build Approvals</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#publish-from-anywhere-using-a-service-account">Publish from anywhere using a Service Account</a>
<ul>
<li class="toc-entry toc-h3"><a href="#publish-using-workload-identity-federation">Publish using Workload Identity Federation</a></li>
<li class="toc-entry toc-h3"><a href="#publish-using-exported-service-account-keys">Publish using Exported Service Account Keys</a></li>
</ul>
</li>
</ul>
  
    <span class="site-toc--inline__toggle toc-toggle-more-items"><i class="material-icons">more_horiz</i></span>
  
</div>


          <p>You can automate publishing from:</p>
<ul>
  <li>
<a href="https://github.com/features/actions">GitHub Actions</a>,</li>
  <li>
<a href="https://cloud.google.com/build">Google Cloud Build</a> or,</li>
  <li>Anywhere else using a <a href="https://cloud.google.com/iam/docs/service-accounts">GCP service account</a>.</li>
</ul>

<p>The following sections explain how automated publishing is configured, and
how you can customize publishing flows in line with your preferences.</p>

<p>When configuring automated publishing you don’t need to create a long-lived
secret that is copied into your automated deployment environment.
Instead, authentication relies on temporary OpenID-Connect tokens signed by
either GitHub Actions (See <a href="https://docs.github.com/en/actions/deployment/security-hardening-your-deployments/about-security-hardening-with-openid-connect">OIDC for GitHub Actions</a>) or Google Cloud IAM.</p>

<p>You can use <em>exported service account keys</em> for deployment
environments where an identity service isn’t present.
Such exported service account keys are long-lived secrets, they might be easier
to use in some environments, but also pose a larger risk if accidentally leaked.</p>

<aside class="alert alert-info" role="alert">
  <p><i class="material-icons" aria-hidden="true">info</i> <strong>備註:</strong>
  Today, you can only automate publishing of existing packages.
  To create a new package, you must publish the first version using
  <code class="language-plaintext highlighter-rouge">dart pub publish</code>.</p>
</aside>

<h2 id="publishing-packages-using-github-actions">
<a class="anchor" href="#publishing-packages-using-github-actions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Publishing packages using GitHub Actions</h2>

<p>You can configure automated publishing using GitHub Actions. This involves:</p>
<ul>
  <li>Enabling automated publishing on pub.dev, specifying:
    <ul>
      <li>The GitHub repository and,</li>
      <li>A <em>tag-pattern</em> that must match to allow publishing.</li>
    </ul>
  </li>
  <li>Creating a GitHub Actions <em>workflow</em> for publishing to pub.dev.</li>
  <li>Pushing a <em>git tag</em> for the version to be published.</li>
</ul>

<p>The following sections outline how to complete these steps.</p>

<aside class="alert alert-info" role="alert">
  <p><i class="material-icons" aria-hidden="true">info</i> <strong>備註:</strong>
  Pub.dev only allows automated publishing from GitHub Actions when the
  <em>workflow</em> is triggered by pushing a git tag to GitHub.
  Pub.dev rejects publishing from GitHub Actions triggered without a tag.
  This ensures that new versions cannot be published by events that should
  never trigger publishing.</p>
</aside>

<h3 id="configuring-automated-publishing-from-github-actions-on-pubdev">
<a class="anchor" href="#configuring-automated-publishing-from-github-actions-on-pubdev" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuring automated publishing from GitHub Actions on pub.dev</h3>

<p>To enable automated publication from GitHub Actions to <code class="language-plaintext highlighter-rouge">pub.dev</code>, you must be:</p>
<ul>
  <li>An <em>uploader</em> on the package, or,</li>
  <li>An <em>admin</em> of the publisher (if the package is owned by a publisher).</li>
</ul>

<p>If you have sufficient permission, you can enable automated publishing by:</p>

<ol>
  <li>Navigating to the <strong>Admin</strong> tab (<code class="language-plaintext highlighter-rouge">pub.dev/packages/&lt;package&gt;/admin</code>).</li>
  <li>Find the <strong>Automated publishing</strong> section.</li>
  <li>Click <strong>Enable publishing from GitHub Actions</strong>, this prompts you to
specify:
    <ul>
      <li>A repository (<code class="language-plaintext highlighter-rouge">&lt;organization&gt;/&lt;repository&gt;</code>, example: <code class="language-plaintext highlighter-rouge">dart-lang/pana</code>),</li>
      <li>A <em>tag-pattern</em> (a string containing <code class="language-plaintext highlighter-rouge">{{version}}</code>).</li>
    </ul>
  </li>
</ol>

<p>The <em>repository</em> is the <code class="language-plaintext highlighter-rouge">&lt;organization&gt;/&lt;repository&gt;</code> on GitHub.
For example, if your repository is
<code class="language-plaintext highlighter-rouge">https://github.com/dart-lang/pana</code> you must specify <code class="language-plaintext highlighter-rouge">dart-lang/pana</code> in the
repository field.</p>

<p>The <em>tag pattern</em> is a string that must contain <code class="language-plaintext highlighter-rouge">{{version}}</code>.
Only GitHub Actions triggered by a push of a tag that matches this
<em>tag pattern</em> will be allowed to publish your package.</p>

<p><img src="pub-dev-gh-setup.png" alt="Configuration of publishing from GitHub Actions on pub.dev"></p>

<p><strong>Example:</strong> a <em>tag pattern</em> like <code class="language-plaintext highlighter-rouge">v{{version}}</code> allows
GitHub Actions (triggered by <code class="language-plaintext highlighter-rouge">git tag v1.2.3 &amp;&amp; git push v1.2.3</code>) to publish
version <code class="language-plaintext highlighter-rouge">1.2.3</code> of your package. Thus, it’s also important that the <code class="language-plaintext highlighter-rouge">version</code> key in
<code class="language-plaintext highlighter-rouge">pubspec.yaml</code> matches this version number.</p>

<p>If your repository contains multiple packages, give each a separate
<em>tag-pattern</em>. Consider using a <em>tag-pattern</em> like
<code class="language-plaintext highlighter-rouge">my_package_name-v{{version}}</code> for a package
named <code class="language-plaintext highlighter-rouge">my_package_name</code>.</p>

<h3 id="configuring-a-github-action-workflow-for-publishing-to-pubdev">
<a class="anchor" href="#configuring-a-github-action-workflow-for-publishing-to-pubdev" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuring a GitHub Action workflow for publishing to pub.dev</h3>

<p>When automated publishing from GitHub Actions is enabled on pub.dev,
you can create a GitHub Actions workflow for publishing. This is done by
creating a <code class="language-plaintext highlighter-rouge">.github/workflows/publish.yml</code> file as follows:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># .github/workflows/publish.yml</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">Publish to pub.dev</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">tags</span><span class="pi">:</span>
    <span class="c1"># must align with the tag-pattern configured on pub.dev, often just replace</span>
    <span class="c1">#  with [0-9]+.[0-9]+.[0-9]+*</span>
    <span class="pi">-</span> <span class="s1">'</span><span class="s">v[0-9]+.[0-9]+.[0-9]+*'</span> <span class="c1"># tag-pattern on pub.dev: 'v'</span>
    <span class="c1"># If you prefer tags like '1.2.3', without the 'v' prefix, then use:</span>
    <span class="c1"># - '[0-9]+.[0-9]+.[0-9]+*' # tag-pattern on pub.dev: ''</span>
    <span class="c1"># If your repository contains multiple packages consider a pattern like:</span>
    <span class="c1"># - 'my_package_name-v[0-9]+.[0-9]+.[0-9]+*'</span>

<span class="c1"># Publish using the reusable workflow from dart-lang.</span>
<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">publish</span><span class="pi">:</span>
    <span class="na">permissions</span><span class="pi">:</span>
      <span class="na">id-token</span><span class="pi">:</span> <span class="s">write</span> <span class="c1"># Required for authentication using OIDC</span>
    <span class="na">uses</span><span class="pi">:</span> <span class="s">dart-lang/setup-dart/.github/workflows/publish.yml@v1</span>
    <span class="c1"># with:</span>
    <span class="c1">#   working-directory: path/to/package/within/repository</span>
</code></pre></div></div>

<p>Make sure to match the pattern in <code class="language-plaintext highlighter-rouge">on.push.tags</code> with the <em>tag pattern</em>
specified on pub.dev. Otherwise, the GitHub Action workflow won’t work.
If publishing multiple packages from the same repository, 
use a per-package <em>tag pattern</em> like <code class="language-plaintext highlighter-rouge">my_package_name-v</code>
and create a separate workflow file for each package.</p>

<p>The workflow file above uses
<code class="language-plaintext highlighter-rouge">dart-lang/setup-dart/.github/workflows/publish.yml</code> to publish the package.
This is a <a href="https://docs.github.com/en/actions/using-workflows/reusing-workflows#calling-a-reusable-workflow">reusable workflow</a> that allows the Dart team to maintain
the publishing logic and enables pub.dev to know how the package was published.
Using this <em>reusable workflow</em> is strongly encouraged.</p>

<p>If you need generated code in your package, then it is preferable to check this
generated code into your repository.
This simplifies verifying that the files published on pub.dev match
the files from your repository. If checking generated or built artifact into
your repository is not reasonable, you can create a custom workflow along
the lines of:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># .github/workflows/publish.yml</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">Publish to pub.dev</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">tags</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s1">'</span><span class="s">v[0-9]+.[0-9]+.[0-9]+*'</span> <span class="c1"># tag pattern on pub.dev: 'v'</span>

<span class="c1"># Publish using custom workflow</span>
<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">publish</span><span class="pi">:</span>
    <span class="na">permissions</span><span class="pi">:</span>
      <span class="na">id-token</span><span class="pi">:</span> <span class="s">write</span> <span class="c1"># Required for authentication using OIDC</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v3</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">dart-lang/setup-dart@v1</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install dependencies</span>
        <span class="na">run</span><span class="pi">:</span> <span class="s">dart pub get</span>
      <span class="c1"># Here you can insert custom steps you need</span>
      <span class="c1"># - run: dart tool/generate-code.dart</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Publish</span>
        <span class="na">run</span><span class="pi">:</span> <span class="s">dart pub publish --force</span>
</code></pre></div></div>

<p>The workflow authenticates to <code class="language-plaintext highlighter-rouge">pub.dev</code> using a temporary
<a href="https://docs.github.com/en/actions/deployment/security-hardening-your-deployments/about-security-hardening-with-openid-connect">GitHub-signed OIDC token</a>, the token is created and configured in the
<code class="language-plaintext highlighter-rouge">dart-lang/setup-dart</code> step.
To publish to pub.dev, subsequent steps can run <code class="language-plaintext highlighter-rouge">dart pub publish --force</code>.</p>

<aside class="alert alert-info" role="alert">
  <p><i class="material-icons" aria-hidden="true">info</i> <strong>備註:</strong>
  At this point, anyone with push access to your repository can publish new versions
  of the package. Consider using <a href="#hardening-security-with-tag-protection-rules-on-github">tag protection rules</a> or
  <a href="#hardening-security-with-github-deployment-environments">GitHub deployment Environments</a> to limit who can publish.</p>
</aside>

<h3 id="triggering-automated-publishing-from-github-actions">
<a class="anchor" href="#triggering-automated-publishing-from-github-actions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Triggering automated publishing from GitHub Actions</h3>

<p>After you’ve configured automated publishing on <code class="language-plaintext highlighter-rouge">pub.dev</code> and created a
GitHub Actions workflow, you can publish a new version of your package.
To publish, push a <em>git tag</em> matching the configured <em>tag pattern</em>.</p>

<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span><span class="nb">cat </span>pubspec.yaml
<span class="go">package: my_package_name
</span><span class="gp">version: 1.2.3            #</span><span class="w"> </span>must match the version number used <span class="k">in </span>the git tag
<span class="go">environment:
  sdk: ^2.19.0

</span><span class="gp">$</span><span class="w"> </span>git tag v1.2.3          <span class="c"># assuming my tag pattern is: 'v'</span>
<span class="gp">$</span><span class="w"> </span>git push origin v1.2.3  <span class="c"># triggers the action that publishes my package.</span>
</code></pre></div></div>

<p>Once pushed, review the workflow logs at
<code class="language-plaintext highlighter-rouge">https://github.com/&lt;organization&gt;/&lt;repository&gt;/actions</code>.</p>

<p>If the Action didn’t trigger, check that the pattern configured in
<code class="language-plaintext highlighter-rouge">.github/workflows/publish.yml</code> matches the pushed <em>git tag</em>.
If the Action failed, the logs might contain clues as to why it failed.</p>

<p>Once published, you can see the publication event in the <code class="language-plaintext highlighter-rouge">audit-log</code> on
<code class="language-plaintext highlighter-rouge">pub.dev</code>.
The <code class="language-plaintext highlighter-rouge">audit-log</code> entry should contain a link to the GitHub Action run that
published the package version.</p>

<p><img src="audit-log-pub-gh.png" alt="Audit log after publishing from GitHub Actions"></p>

<p>If you don’t like using the <code class="language-plaintext highlighter-rouge">git</code> CLI to create tags, you can create <em>releases</em>
on GitHub from <code class="language-plaintext highlighter-rouge">https://github.com/&lt;organization&gt;/&lt;repository&gt;/releases/new</code>.
To learn more, check out <a href="https://docs.github.com/en/repositories/releasing-projects-on-github/managing-releases-in-a-repository">managing releases in a repository</a> from GitHub.</p>

<h3 id="hardening-security-with-tag-protection-rules-on-github">
<a class="anchor" href="#hardening-security-with-tag-protection-rules-on-github" aria-hidden="true"><span class="octicon octicon-link"></span></a>Hardening security with tag protection rules on GitHub</h3>

<p>Configuring automated publishing from GitHub Actions allows anyone who can push
a tag to your repository to trigger publishing to pub.dev.
You can restrict who can push tags to your repository using
<a href="https://docs.github.com/en/repositories/managing-your-repositorys-settings-and-features/managing-repository-settings/configuring-tag-protection-rules">tag protection rules</a> on GitHub.</p>

<p>By limiting who can create tags matching your <em>tag pattern</em>, you can limit who
can publish the package.</p>

<p>At this time, the <a href="https://docs.github.com/en/repositories/managing-your-repositorys-settings-and-features/managing-repository-settings/configuring-tag-protection-rules">tag protection rules</a> lack flexibility. You might want to
restrict who can trigger publishing using GitHub Deployment Environments,
as outlined in the next section.</p>

<h3 id="hardening-security-with-github-deployment-environments">
<a class="anchor" href="#hardening-security-with-github-deployment-environments" aria-hidden="true"><span class="octicon octicon-link"></span></a>Hardening security with GitHub Deployment Environments</h3>

<p>When configuring automated publishing from GitHub Actions on pub.dev, you can 
require a <a href="https://docs.github.com/en/actions/deployment/targeting-different-environments/using-environments-for-deployment">GitHub Actions environment</a>.
To require a <em>GitHub Actions environment</em> for publishing you must:</p>

<ol>
  <li>Navigate to the <strong>Admin</strong> tab (<code class="language-plaintext highlighter-rouge">pub.dev/packages/&lt;package&gt;/admin</code>).</li>
  <li>Find the <strong>Automated publishing</strong> section.</li>
  <li>Click <strong>Require GitHub Actions environment</strong>.</li>
  <li>Specify an <strong>Environment</strong> name, (<code class="language-plaintext highlighter-rouge">pub.dev</code> is typically a good name)</li>
</ol>

<p><img src="pub-dev-gh-env-setup.png" alt="Configure pub.dev to require a GitHub deployment environment"></p>

<p>When an environment is required on pub.dev, GitHub Actions won’t be able to
publish unless they have <code class="language-plaintext highlighter-rouge">environment: pub.dev</code>. Thus, you must:</p>

<ol>
  <li>
<a href="https://docs.github.com/en/actions/deployment/targeting-different-environments/using-environments-for-deployment#creating-an-environment">Create an <em>environment</em></a> with the same name on GitHub
(typically <code class="language-plaintext highlighter-rouge">pub.dev</code>)</li>
  <li>Alter your <code class="language-plaintext highlighter-rouge">.github/workflows/publish.yml</code> workflow file to specify
<code class="language-plaintext highlighter-rouge">environment: pub.dev</code>, as follows:</li>
</ol>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># .github/workflows/publish.yml</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">Publish to pub.dev</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">tags</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s1">'</span><span class="s">v[0-9]+.[0-9]+.[0-9]+*'</span> <span class="c1"># for tags like: 'v1.2.3'</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">publish</span><span class="pi">:</span>
    <span class="na">permissions</span><span class="pi">:</span>
      <span class="na">id-token</span><span class="pi">:</span> <span class="s">write</span> <span class="c1"># Required for authentication using OIDC</span>
    <span class="na">uses</span><span class="pi">:</span> <span class="s">dart-lang/setup-dart/.github/workflows/publish.yml@v1</span>
    <span class="na">with</span><span class="pi">:</span>
      <span class="c1"># Specify the github actions deployment environment</span>
      <span class="na">environment</span><span class="pi">:</span> <span class="s">pub.dev</span>
      <span class="c1"># working-directory: path/to/package/within/repository</span>
</code></pre></div></div>

<p>The <em>environment</em> is reflected in the temporary <a href="https://docs.github.com/en/actions/deployment/security-hardening-your-deployments/about-security-hardening-with-openid-connect">GitHub-signed OIDC token</a>
used for authentication with pub.dev. Thus, a user with permission to push to
your repository cannot circumvent <a href="https://docs.github.com/en/actions/deployment/targeting-different-environments/using-environments-for-deployment#environment-protection-rules">environment protection rules</a> by modifying
the workflow file.</p>

<p>In GitHub repository settings, you can use <a href="https://docs.github.com/en/actions/deployment/targeting-different-environments/using-environments-for-deployment#environment-protection-rules">environment protection rules</a> to
configure <em>required reviewers</em>. If you configure this option, GitHub prevents
actions with the environment from running until one of the
<em>required reviewers</em> have approved the run.</p>

<p><img src="gh-pending-review.png" alt="GitHub Action waiting for deployment review"></p>

<h2 id="publishing-from-google-cloud-build">
<a class="anchor" href="#publishing-from-google-cloud-build" aria-hidden="true"><span class="octicon octicon-link"></span></a>Publishing from Google Cloud Build</h2>

<p>You can configure automated publishing from <a href="https://cloud.google.com/build">Google Cloud Build</a>. This
involves:</p>
<ul>
  <li>Register a Google Cloud Project (or using an existing project),</li>
  <li>Create a <a href="https://cloud.google.com/iam/docs/service-accounts">service account</a> for publishing to pub.dev,</li>
  <li>Enable automated publishing in the admin tab for the package on pub.dev,
specifying the email of the service account created for publishing.</li>
  <li>Grant the default Cloud Build service account permission to impersonate the
service account created for publishing.</li>
  <li>Create a <code class="language-plaintext highlighter-rouge">cloudbuild.yaml</code> file that obtains a temporary OIDC <code class="language-plaintext highlighter-rouge">id_token</code>
and uses it for publishing to pub.dev</li>
  <li>Configure a Cloud Build trigger, for running the steps in <code class="language-plaintext highlighter-rouge">cloudbuild.yaml</code>
in your project on Google Cloud Build.</li>
</ul>

<p>The following sections outline how to complete these steps.</p>

<aside class="alert alert-info" role="alert">
  <p><i class="material-icons" aria-hidden="true">info</i> <strong>備註:</strong>
  When you enable automated publishing from a <em>service account</em> you must carefully
  review who has the ability to impersonate this service account, either by
  calling through APIs, exporting service account keys, or through changing
  IAM permission in the cloud project.
  To learn more, check out <a href="https://cloud.google.com/iam/docs/impersonating-service-accounts">managing service account impersonation</a>.</p>
</aside>

<h3 id="creating-a-service-account-for-publishing">
<a class="anchor" href="#creating-a-service-account-for-publishing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Creating a service account for publishing</h3>

<p>For publishing to pub.dev you are going to create a <em>service account</em> that is
granted permission to publish your package on pub.dev. You are then going to
grant Cloud Build permission to impersonate this service account.</p>

<ol>
  <li>
<a href="https://cloud.google.com/resource-manager/docs/creating-managing-projects">Create a cloud project</a>, if you don’t have an existing project.</li>
  <li>
    <p>Create a <em>service account</em> as follows:</p>

    <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> gcloud iam service-accounts create pub-dev <span class="se">\</span>
   <span class="nt">--description</span><span class="o">=</span><span class="s1">'Service account to be impersonated when publishing to pub.dev'</span> <span class="se">\</span>
   <span class="nt">--display-name</span><span class="o">=</span><span class="s1">'pub-dev'</span>
</code></pre></div>    </div>

    <p>This creates a service account named
 <code class="language-plaintext highlighter-rouge">pub-dev@$PROJECT_ID.iam.gserviceaccount.com</code>.</p>
  </li>
  <li>
    <p>Grant the service account permission to publish your package.</p>

    <p>To complete this step, you must have <em>uploader</em> permission on the package or
be an <em>admin</em> of the publisher that owns the package.</p>

    <p>a. Navigate to the <strong>Admin</strong> tab (<code class="language-plaintext highlighter-rouge">pub.dev/packages/&lt;package&gt;/admin</code>).
a. Click <strong>Enable publishing with Google Cloud Service account</strong>.
a. Type the email of the service account into the <strong>Service account email</strong> field.
   You created this account in the previous step:
   <code class="language-plaintext highlighter-rouge">pub-dev@$PROJECT_ID.iam.gserviceaccount.com</code></p>
  </li>
</ol>

<p><img src="pub-dev-gcb-config.png" alt="Configuration that allows service account to publish on pub.dev"></p>

<p>With this procedure complete, anyone who can impersonate the service account can
publish new versions of the package. Make sure to review who has permissions to
impersonate the service account and change permissions in the cloud project as
needed.</p>

<aside class="alert alert-info" role="alert">
  <p><i class="material-icons" aria-hidden="true">info</i> <strong>備註:</strong>
  The <em>service account</em> must be created in the same cloud project where you
  intend to run Cloud Build. If you need to impersonate across cloud projects,
  refer to <a href="https://cloud.google.com/iam/docs/impersonating-service-accounts#enabling-cross-project">enabling service account impersonation across projects</a>.</p>
</aside>

<h3 id="granting-cloud-build-permission-to-publish">
<a class="anchor" href="#granting-cloud-build-permission-to-publish" aria-hidden="true"><span class="octicon octicon-link"></span></a>Granting Cloud Build permission to publish</h3>

<p>To publish from Cloud Build you must give the
<a href="https://cloud.google.com/build/docs/cloud-build-service-account">default Cloud Build service account</a> permission to impersonate 
the service account created for publishing in the previous section.</p>

<ol>
  <li>
    <p>Enable the <a href="https://console.cloud.google.com/apis/api/iamcredentials.googleapis.com">IAM Service Account Credentials API</a> in the cloud project.
Attempts to impersonate a service account will fail without this API.</p>

    <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c"># Enable IAM Service Account Credentials API</span>
gcloud services <span class="nb">enable </span>iamcredentials.googleapis.com
</code></pre></div>    </div>
  </li>
  <li>
    <p>Find the project number.</p>

    <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c"># The PROJECT_NUMBER can be obtained as follows:</span>
gcloud projects describe <span class="nv">$PROJECT_ID</span> <span class="nt">--format</span><span class="o">=</span><span class="s1">'value(projectNumber)'</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Grant the permission to impersonate the publishing service account.</p>

    <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c"># Grant default cloud</span>
gcloud iam service-accounts add-iam-policy-binding <span class="se">\</span>
  pub-dev@<span class="nv">$PROJECT_ID</span>.iam.gserviceaccount.com <span class="se">\</span>
  <span class="nt">--member</span><span class="o">=</span>serviceAccount:<span class="nv">$PROJECT_NUMBER</span>@cloudbuild.gserviceaccount.com <span class="se">\</span>
  <span class="nt">--role</span><span class="o">=</span>roles/iam.serviceAccountTokenCreator
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="writing-a-cloud-build-configuration-file">
<a class="anchor" href="#writing-a-cloud-build-configuration-file" aria-hidden="true"><span class="octicon octicon-link"></span></a>Writing a Cloud Build configuration file</h3>

<p>To publish from Cloud Build, you must specify steps for Cloud Build to:</p>
<ul>
  <li>Impersonate the service account to obtain a temporary OIDC token.</li>
  <li>Provide the temporary OIDC token to <code class="language-plaintext highlighter-rouge">dart pub</code> for use when publishing.</li>
  <li>Calling <code class="language-plaintext highlighter-rouge">dart pub publish</code> to publish the package.</li>
</ul>

<p>Steps for Google Cloud Build are provided in a <code class="language-plaintext highlighter-rouge">cloudbuild.yaml</code> file, see
<a href="https://cloud.google.com/build/docs/build-config-file-schema">build configuration file schema</a> for full documentation of the format.</p>

<p>For publishing to pub.dev from Google Cloud Build, a <code class="language-plaintext highlighter-rouge">cloudbuild.yaml</code> file as
follows will do:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># cloudbuild.yaml</span>
<span class="na">steps</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s">Create temporary token</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">gcr.io/cloud-builders/gcloud</span>
  <span class="na">volumes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">temporary-secrets</span>
    <span class="na">path</span><span class="pi">:</span> <span class="s">/secrets</span>
  <span class="na">script</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">gcloud auth print-identity-token \</span>
      <span class="s">--impersonate-service-account=pub-dev@$PROJECT_ID.iam.gserviceaccount.com \</span>
      <span class="s">--audiences=https://pub.dev \</span>
      <span class="s">--include-email &gt; /secrets/temporary-pub-token.txt</span>
  <span class="na">env</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">PROJECT_ID=$PROJECT_ID</span>
<span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s">Publish to pub.dev</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">dart</span>
  <span class="na">volumes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">temporary-secrets</span>
    <span class="na">path</span><span class="pi">:</span> <span class="s">/secrets</span>
  <span class="na">script</span><span class="pi">:</span> <span class="pi">|</span> 
    <span class="s">cat /secrets/temporary-pub-token.txt | dart pub token add https://pub.dev</span>
    <span class="s">dart pub publish --force</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">gcloud auth print-identity-token</code> creates an OIDC <code class="language-plaintext highlighter-rouge">id_token</code> impersonating
the specified service account. This <code class="language-plaintext highlighter-rouge">id_token</code> is signed by Google, with a
signature that expires within 1 hour. The <em>audiences</em> parameter lets pub.dev
know that it is the intended recipient of the token. The <code class="language-plaintext highlighter-rouge">--include-email</code>
option is necessary for pub.dev to recognize the service account.</p>

<p>Once the <code class="language-plaintext highlighter-rouge">id_token</code> is created, it’s written to a file that resides in a
<em>volume</em>; this mechanism is used to <a href="https://cloud.google.com/build/docs/configuring-builds/pass-data-between-steps">pass data between steps</a>.
Don’t store the token in <code class="language-plaintext highlighter-rouge">/workspace</code>. Since <code class="language-plaintext highlighter-rouge">/workspace</code> is where the
repository from which you wish to publish is checked out.
Not using <code class="language-plaintext highlighter-rouge">/workspace</code> for storing the token reduces the risk that you
accidentally include it in your package when publishing.</p>

<h3 id="creating-a-cloud-build-trigger">
<a class="anchor" href="#creating-a-cloud-build-trigger" aria-hidden="true"><span class="octicon octicon-link"></span></a>Creating a Cloud Build trigger</h3>

<p>With service accounts configured and a <code class="language-plaintext highlighter-rouge">cloudbuild.yaml</code> file in the repository
you can create a <em>Cloud Build Trigger</em> using the <a href="https://console.cloud.google.com/cloud-build/triggers">console.cloud.google.com</a>
dashboard.
To create a build trigger, you need to connect to a <em>source repository</em>
and specify which events should trigger a build. You can use <a href="https://cloud.google.com/build/docs/automating-builds/github/connect-repo-github">GitHub</a>,
<a href="https://cloud.google.com/source-repositories/docs/create-code-repository">Cloud Source Repository</a>, or one of the <a href="https://cloud.google.com/build/docs/triggers">other options</a>.
To learn how to configure a <em>Cloud Build Trigger</em>, check out
<a href="https://cloud.google.com/build/docs/automating-builds/create-manage-triggers">creating and managing build triggers</a>.</p>

<p>To use the <code class="language-plaintext highlighter-rouge">cloudbuild.yaml</code> from the previous step, configure the
<em>Cloud Build Trigger</em> type as “Cloud Build Configuration” located in the
repository in the <code class="language-plaintext highlighter-rouge">/cloudbuild.yaml</code> file.
Do <strong>not</strong> specify a <em>service account</em> for the build to be triggered with.
Instead you’ll want to use the default service account for Cloud Build.</p>

<p><img src="gcb-trigger-configuration.png" alt="Configuration for trigger"></p>

<aside class="alert alert-info" role="alert">
  <p><i class="material-icons" aria-hidden="true">info</i> <strong>備註:</strong>
  You can configure the Cloud Build trigger to run under a custom
  <em>service account</em>. If you want to do this, create a new service
  account for this purpose. Allow this service account to impersonate
  the <code class="language-plaintext highlighter-rouge">pub-dev@$PROJECT_ID.iam.gserviceaccount.com</code> account, which can
  publish to pub.dev.</p>

  <p>The configuration of the <code class="language-plaintext highlighter-rouge">pub-dev@$PROJECT_ID.iam.gserviceaccount.com</code>
  <em>service account</em> allowed the default Cloud Build service account,
  <code class="language-plaintext highlighter-rouge">$PROJECT_NUMBER@cloudbuild.gserviceaccount.com</code>, to impersonate the 
  <code class="language-plaintext highlighter-rouge">pub-dev@$PROJECT_ID.iam.gserviceaccount.com</code> service account.
  If using a custom service account for the Cloud Build, you’ll need to change
  this.</p>

  <p>To learn more about custom service accounts for running Cloud Builds,
  check out <a href="https://cloud.google.com/build/docs/securing-builds/configure-user-specified-service-accounts">Configuring user-specified service accounts</a>.</p>
</aside>

<p>When configuring your Cloud Build trigger, consider who can trigger the
build. <em>Because triggering a build might publish a new version of your package</em>.
Consider only allowing manual builds or use
<a href="https://cloud.google.com/build/docs/securing-builds/gate-builds-on-approval">Cloud Build approvals</a> to gate builds as outlined in next section.</p>

<h3 id="hardening-security-with-cloud-build-approvals">
<a class="anchor" href="#hardening-security-with-cloud-build-approvals" aria-hidden="true"><span class="octicon octicon-link"></span></a>Hardening security with Cloud Build Approvals</h3>

<p>When configuring a Cloud Build trigger, you can select
<strong>require approval before build executes</strong>. If a Cloud Build trigger
requires approval, it won’t run when triggered. Instead, it’ll wait for
approval.
This can be used to limit who can publish new versions of your package.</p>

<p><img src="gcb-approval-checkbox.png" alt="Enabling approvals in configuration of the Cloud Build trigger"></p>

<p>Only a user with the <strong>Cloud Build Approver</strong> role can give approval.
When giving a approval, the approver can specify a URL and comment.</p>

<p><img src="gcp-waiting-for-approval.png" alt="Cloud Build run waiting for approval to run"></p>

<p>You can also configure notifications for pending approvals.
To learn more, check out <a href="https://cloud.google.com/build/docs/securing-builds/gate-builds-on-approval">gate build on approval</a>.</p>

<h2 id="publish-from-anywhere-using-a-service-account">
<a class="anchor" href="#publish-from-anywhere-using-a-service-account" aria-hidden="true"><span class="octicon octicon-link"></span></a>Publish from anywhere using a Service Account</h2>

<p>To allow automated publishing outside of GitHub Actions, you might
authenticate using service accounts in way similar to <em>Cloud Build</em>.</p>

<p>This usually involves:</p>
<ul>
  <li>
<a href="#creating-a-service-account-for-publishing">Create a service account for publishing</a>,</li>
  <li>Impersonate the publishing service account in one of two ways:
    <ul>
      <li>Workload Identity Federation</li>
      <li>Exported Service Account Keys</li>
    </ul>
  </li>
</ul>

<p>The section for <em>Cloud Build</em> outlined how to
<a href="#creating-a-service-account-for-publishing">create a service account for publishing</a>.
This should provide a service account, such as
<code class="language-plaintext highlighter-rouge">pub-dev@$PROJECT_ID.iam.gserviceaccount.com</code>.</p>

<h3 id="publish-using-workload-identity-federation">
<a class="anchor" href="#publish-using-workload-identity-federation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Publish using Workload Identity Federation</h3>

<p>When running on a cloud service that supports OIDC or SAML,
you can impersonate a GCP service account using
<a href="https://cloud.google.com/iam/docs/workload-identity-federation">Workload Identity Federation</a>. This enables you to
leverage your cloud provider’s identity services.</p>

<p>For example, if deploying on EC2, you can
<a href="https://cloud.google.com/iam/docs/workload-identity-federation-with-other-clouds">configure workload identity federation with AWS</a>, allowing
temporary AWS tokens from the EC2 metadata service to impersonate a
service account.
To learn how to configure these flows, check out
<a href="https://cloud.google.com/iam/docs/how-to#workload-identity-federation">workload identity federation</a>.</p>

<h3 id="publish-using-exported-service-account-keys">
<a class="anchor" href="#publish-using-exported-service-account-keys" aria-hidden="true"><span class="octicon octicon-link"></span></a>Publish using Exported Service Account Keys</h3>

<p>When running on a custom system without identity services, you
can export service account keys. Exported service account keys allows you to
authenticate as said <em>service account</em>.
To learn more, check out how to
<a href="https://cloud.google.com/iam/docs/creating-managing-service-account-keys">create and manage service account keys</a>.</p>

<h4 id="export-service-account-keys">Export service account keys</h4>

<ol>
  <li>
    <p>Create exported service account keys for an existing service account.</p>

    <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> gcloud iam service-accounts keys create key-file.json <span class="se">\</span>
   <span class="nt">--iam-account</span><span class="o">=</span>pub-dev@<span class="nv">$PROJECT_ID</span>.iam.gserviceaccount.com
</code></pre></div>    </div>
  </li>
  <li>
    <p>Save the <code class="language-plaintext highlighter-rouge">key-file.json</code> file for later use.</p>
  </li>
</ol>

<aside class="alert alert-warning" role="alert">
  <p><i class="material-icons" aria-hidden="true">report_problem</i> <strong>請注意:</strong>
  Treat the <code class="language-plaintext highlighter-rouge">key-file.json</code> like a password.
  Anyone who gains access to it can authenticate as the service account
  and publish your package.</p>
</aside>

<h4 id="publish-packages-using-exported-service-account-keys">Publish packages using exported service account keys</h4>

<p>To publish a package using exported service account keys:</p>

<ol>
  <li>
    <p>Setup gcloud to authenticate using <code class="language-plaintext highlighter-rouge">key-file.json</code> (created in the previous step)</p>

    <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> gcloud auth activate-service-account <span class="nt">--key-file</span><span class="o">=</span>key-file.json
</code></pre></div>    </div>
  </li>
  <li>
    <p>Create a temporary token for pub.dev and pass it to
<code class="language-plaintext highlighter-rouge">dart pub token add https://pub.dev</code>.
To impersonate service account, include the <code class="language-plaintext highlighter-rouge">--include-email</code> option.</p>

    <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> gcloud auth print-identity-token <span class="se">\</span>
   <span class="nt">--audiences</span><span class="o">=</span>https://pub.dev <span class="se">\</span>
   | dart pub token add https://pub.dev
</code></pre></div>    </div>
  </li>
  <li>
    <p>Publish using the temporary token.
Add the <code class="language-plaintext highlighter-rouge">--force</code> option to skip the <code class="language-plaintext highlighter-rouge">yes/no</code> prompt.</p>

    <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> dart pub publish <span class="nt">--force</span>
</code></pre></div>    </div>
  </li>
</ol>

<aside class="alert alert-info" role="alert">
  <p><i class="material-icons" aria-hidden="true">info</i> <strong>備註:</strong>
  Consider using <a href="https://cloud.google.com/iam/docs/workload-identity-federation">Workload Identity Federation</a>, if possible. This
  avoids long-lived secrets. Relying on Workload Identity Federation
  allows you to use short-lived secrets that your cloud provider signs.
  Short-lived secrets greatly reduces the security risks if accidentally leaked
  in logs or similar ways.</p>
</aside>


          

        </div>
      </article>
    </main>
    <footer id="page-footer">
    <div class="footer-section footer-main">
      <a href="/" class="brand" title="Dart">
        <img src="/assets/img/shared/dart/logo+text/horizontal/white.svg" alt="Dart" width="164px">
      </a>
      <div class="footer-social-links">
        <a href="https://github.com/doggy8088/dart.tw" target="_blank" rel="noopener" title="GitHub" class="no-automatic-external">
          <svg>
            <use href="/assets/img/social/github.svg#github"></use>
          </svg>
        </a>
      </div>
    </div>
    <div class="footer-section footer-tray">
      <div class="footer-licenses">
        參考中文內容需註明本站及連結作為出處，英文內容和範例程式碼均遵從源站授權協議。
      </div>
      <div class="footer-utility-links">
        <ul>
          <li><a href="/terms" title="使用條款">使用條款</a></li>
          <li><a href="https://policies.google.com/privacy?hl=zh-TW" target="_blank" rel="noopener" title="隱私政策" class="no-automatic-external">隱私政策</a></li>
          <li><a href="/security" title="Security philosophy and practices">Dart 程式碼安全說明</a></li>
          <li><a href="https://flutter.tw/about" target="_blank">關於中文文件</a>
          </li><li><a href="https://flutter.tw/disclaimer" target="_blank">免責條款</a>
          </li><li><a href="https://dart.cn/" target="_blank">Dart 簡體中文文檔</a>
        </li></ul>
      </div>
    </div>
  </footer>

  

<script src="/assets/translator/js/translator.js"></script></body></html>