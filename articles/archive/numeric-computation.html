<!DOCTYPE html><html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Language" content="zh-cmn-Hans">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Google Tag Manager -->
<!--  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':-->
<!--  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],-->
<!--  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=-->
<!--  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);-->
<!--  })(window,document,'script','dataLayer','GTM-5VSZM5J');</script>-->
  <!-- End Google Tag Manager -->

  <meta name="description" content="How you store and use numbers can have a big impact on your app's performance. This article focuses on the Dart VM.">
  <title>Numeric computation | Dart</title>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-28P0PYCRZ9"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-28P0PYCRZ9');
  </script>

  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?fa71f2474b82505e00203cf9956cf0bc";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>

  <!-- Favicon / Touch Icons -->
  <link rel="icon" sizes="64x64" href="/assets/shared/dart/icon/64.png">
  <link href="/assets/img/touch-icon-iphone.png" rel="apple-touch-icon">
  <link href="/assets/img/touch-icon-ipad.png" rel="apple-touch-icon" sizes="152x152">
  <link href="/assets/img/touch-icon-iphone-retina.png" rel="apple-touch-icon" sizes="180x180">
  <link href="/assets/img/touch-icon-ipad-retina.png" rel="apple-touch-icon" sizes="167x167">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@dart_lang">
  <meta name="twitter:title" content="Numeric computation">
  <meta name="twitter:description" content="How you store and use numbers can have a big impact on your app's performance. This article focuses on the Dart VM.">

  <!-- Open Graph -->
  <meta property="og:title" content="Numeric computation">
  <meta property="og:description" content="How you store and use numbers can have a big impact on your app's performance. This article focuses on the Dart VM.">
  <meta property="og:url" content="https://dart.tw.gh.miniasp.com/articles/archive/numeric-computation">

  <meta property="og:image" content="https://dart.tw.gh.miniasp.com/assets/shared/dart-logo-for-shares.png?2">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
  <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&amp;display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Google+Sans+Display:wght@400&amp;display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Google+Sans+Mono:wght@400;500;700&amp;display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&amp;display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons&amp;display=swap" rel="stylesheet">
  <script src="https://cdn.staticfile.org/font-awesome/5.15.4/js/all.js" data-auto-replace-svg="nest">
  </script>

  <link rel="stylesheet" href="/assets/css/main.css?v=1693674404">
  <script src="https://cdn.staticfile.org/jquery/3.7.0/jquery.min.js" integrity="sha512-3gJwYpMe3QewGELv8k/BX9vcqhryRdzRMxVfq6ngyWXwo03GFEzjsUm8Q7RZcHPHksttq7/GFoxjCVUjkjvPdw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdn.staticfile.org/popper.js/1.16.1/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdn.staticfile.org/bootstrap/4.6.2/js/bootstrap.min.js" integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <!-- <script src="https://cdn.staticfile.org/js-cookie/3.0.5/js.cookie.min.js"
          integrity="sha512-nlp9/l96/EpjYBx7EP7pGASVXNe80hGhYAUrjeXnu/fyF5Py0/RXav4BBNs7n5Hx1WFhOEOWSAVjGeC3oKxDVQ=="
          crossorigin="anonymous"
          referrerpolicy="no-referrer"></script> -->

  <script src="/assets/js/vendor/code-prettify/prettify.js"></script>
  <script src="/assets/js/vendor/code-prettify/lang-dart.js"></script>
  <script src="/assets/js/vendor/code-prettify/lang-yaml.js"></script>
  <script src="/assets/js/os-tabs.js?v=1693674404"></script>
  <script src="/assets/js/utilities.js?v=1693674404"></script>
  <script src="/assets/js/main.js?v=1693674404"></script>

  <script>

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-122680122-5', 'auto');
ga('send', 'pageview');

</script>


 <link href="/assets/translator/css/translator.css" rel="stylesheet"></head>

  <body class="default obsolete show_banner">
    <section id="cookie-notice">
  <div class="container">
    <p>Google uses cookies to deliver its services, to personalize ads, and to 
      analyze traffic. You can adjust your privacy controls anytime in your 
      <a href="https://myaccount.google.com/data-and-personalization" target="_blank" rel="noopener" class="no-automatic-external">Google settings</a>. 
      <a href="https://policies.google.com/technologies/cookies" target="_blank" rel="noopener" class="no-automatic-external">Learn more</a>.
    </p>
    <button id="cookie-consent" class="btn btn-primary">Okay</button>
  </div>
</section>

    <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=G-28P0PYCRZ9"
 height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

    <header id="page-header" class="site-header">
  <nav id="mainnav" class="site-header">
  <div id="menu-toggle"><i class="material-icons">menu</i></div>
  <a href="/" class="brand" title="Dart">
    <img src="/assets/img/shared/dart/logo+text/horizontal/white.svg" alt="Dart">
  </a>
  <ul class="navbar">
    <li>
      <a href="/overview" class="nav-link">概覽</a>
    </li>
    <li class="mainnav__get-started">
      <a href="/guides" class="nav-link
        ">
        <span>文件</span>
      </a>
    </li>
    <li>
      <a href="/community" class="nav-link">社群</a>
    </li>
    <li>
      <a href="/#try-dart" class="nav-link">嘗試 Dart</a>
    </li>
    <li>
      <a href="/get-dart" class="nav-link">獲取 Dart SDK</a>
    </li>
    <li class="searchfield">
      <form action="/search" class="site-header__search form-inline" id="cse-search-box">
        <input type="hidden" name="cx" value="011220921317074318178:_yy-tmb5t_i">
        <input type="hidden" name="ie" value="UTF-8">
        <input type="hidden" name="hl" value="en">
        <input class="site-header__searchfield form-control search-field" type="search" name="q" id="q" autocomplete="off" placeholder="Search" aria-label="Search">
      </form>
    </li>
  </ul>
</nav>

  
  <div class="alert alert-warning">
    <h4 class="text-center" id="------some-of-the-content-of-this-page-might-be-out-of-date----">
      Some of the content of this page might be out of date.
    </h4>
  </div>
  
</header>
 <div class="banner">
  <p class="banner__text">
    Dart 3 已釋出！帶來了全新的
    <a href="https://dart.tw.gh.miniasp.com/language/records" class="no-automatic-external">記錄型別 (records)</a>、
    <a href="https://dart.tw.gh.miniasp.com/language/patterns" class="no-automatic-external">模式匹配 (patterns)</a>
    以及 <a href="https://dart.tw.gh.miniasp.com/language/class-modifiers" class="no-automatic-external">型別修飾符 (class modifiers)</a>。
    <br>
    <!--<a href="https://medium.com/p/53f065a10635" class="no-automatic-external">Check out the blog post</a>!-->
  </p>
</div>
 

    <div id="sidenav" class="">
  <form action="/search/" class="site-header__search form-inline">
    <input class="site-header__searchfield form-control search-field" type="search" name="q" id="q" autocomplete="off" placeholder="Search" aria-label="Search">
  </form>

  <div class="site-sidebar">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a href="/overview" class="nav-link">概覽</a>
      </li>
      <li class="nav-item">
        <a href="/community" class="nav-link">社群</a>
      </li>
      <li class="nav-item">
        <a href="https://dartpad.dev" class="nav-link">嘗試 Dart</a>
      </li>
      <li class="nav-item">
        <a href="/get-dart" class="nav-link">獲取 Dart SDK</a>
      </li>
      <li class="nav-item">
        <a href="/guides" class="nav-link">文件</a>
      </li>
    </ul>

    <ul class="nav flex-column"><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-1" role="button" aria-expanded="false" aria-controls="sidenav-1">範例和課程</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-1">
        <li class="nav-item">
    <a class="nav-link" href="/tutorials">語言概覽</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable" data-toggle="collapse" data-target="#sidenav-1-2" href="#sidenav-1-2" role="button" aria-expanded="true" aria-controls="sidenav-1-2">Codelabs
    </a>
    <ul class="nav flex-column flex-nowrap collapse show" id="sidenav-1-2">
      <li class="nav-item">
    <a class="nav-link" href="/codelabs">Codelabs 列表</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/codelabs/dart-cheatsheet">Dart 速查表</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/codelabs/iterables">可迭代集合</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/codelabs/async-await">Dart 非同步程式設計</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/codelabs/null-safety">空安全</a>
  </li></ul>
  </li>

</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-2" role="button" aria-expanded="false" aria-controls="sidenav-2">Dart 開發語言</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2">
        <li class="nav-item">
    <a class="nav-link" href="/language">介紹</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-2-2" href="#sidenav-2-2" role="button" aria-expanded="false" aria-controls="sidenav-2-2">基礎表示式
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2-2">
      <li class="nav-item">
    <a class="nav-link" href="/language/variables">變數</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/operators">運運算元</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/comments">註釋</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/metadata">註解</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/libraries">庫 &amp; 導庫</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/keywords">關鍵字</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-2-3" href="#sidenav-2-3" role="button" aria-expanded="false" aria-controls="sidenav-2-3">型別
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2-3">
      <li class="nav-item">
    <a class="nav-link" href="/language/built-in-types">基本型別</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/records">記錄 (Records)</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/collections">集合 (Collections)</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/generics">泛型 (Generics)</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/typedefs">別名 (Typedefs)</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/type-system">型別系統</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-2-4" href="#sidenav-2-4" role="button" aria-expanded="false" aria-controls="sidenav-2-4">模式匹配
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2-4">
      <li class="nav-item">
    <a class="nav-link" href="/language/patterns">概覽 &amp; 用法</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/pattern-types">模式匹配型別</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link" href="/language/functions">函式方法</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-2-6" href="#sidenav-2-6" role="button" aria-expanded="false" aria-controls="sidenav-2-6">控制流
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2-6">
      <li class="nav-item">
    <a class="nav-link" href="/language/loops">迴圈</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/branches">分支</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link" href="/language/error-handling">錯誤處理</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-2-8" href="#sidenav-2-8" role="button" aria-expanded="false" aria-controls="sidenav-2-8">類 &amp; 物件
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2-8">
      <li class="nav-item">
    <a class="nav-link" href="/language/classes">類</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/constructors">構造方法</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/methods">成員方法</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/extend">繼承</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/mixins">混入 (Mixin)</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/enums">列舉</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/extension-methods">擴充方法</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/callable-objects">可呼叫的物件</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-2-9" href="#sidenav-2-9" role="button" aria-expanded="false" aria-controls="sidenav-2-9">型別修飾符
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2-9">
      <li class="nav-item">
    <a class="nav-link" href="/language/class-modifiers">概覽 &amp; 用法</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/class-modifiers-for-apis">API 維護者應該用的型別修飾符</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/modifier-reference">速查表</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-2-10" href="#sidenav-2-10" role="button" aria-expanded="false" aria-controls="sidenav-2-10">併發
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2-10">
      <li class="nav-item">
    <a class="nav-link" href="/language/async">非同步支援</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/concurrency">Isolates</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-2-11" href="#sidenav-2-11" role="button" aria-expanded="false" aria-controls="sidenav-2-11">Null safety
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2-11">
      <li class="nav-item">
    <a class="nav-link" href="/null-safety">健全的空安全</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/null-safety/migration-guide">遷移到空安全</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/null-safety/understanding-null-safety">深入理解空安全</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/null-safety/unsound-null-safety">非健全的空安全</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/null-safety/faq">空安全常見問題和解答</a>
  </li></ul>
  </li>

</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-3" role="button" aria-expanded="false" aria-controls="sidenav-3">高效指南 (Effective Dart)</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-3">
        <li class="nav-item">
    <a class="nav-link" href="/effective-dart">概述</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/effective-dart/style">程式碼風格</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/effective-dart/documentation">文件</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/effective-dart/usage">用法範例</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/effective-dart/design">API 設計</a>
  </li>
</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-4" role="button" aria-expanded="false" aria-controls="sidenav-4">核心函式庫</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-4">
        <li class="nav-item">
    <a class="nav-link" href="/guides/libraries">概覽</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/libraries/library-tour">概覽</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-4-3" href="#sidenav-4-3" role="button" aria-expanded="false" aria-controls="sidenav-4-3">介紹文章
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-4-3">
      <li class="nav-item">
    <a class="nav-link" href="/articles/libraries/creating-streams">建立 stream</a>
  </li></ul>
  </li>

</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-5" role="button" aria-expanded="false" aria-controls="sidenav-5">Packages</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-5">
        <li class="nav-item">
    <a class="nav-link" href="/guides/packages">如何使用 package</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/libraries/useful-libraries">常用 package 介紹</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/libraries/create-packages">建立 package</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/pub/publishing">釋出 package</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/libraries/writing-package-pages">設定 package 介紹頁</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-5-6" href="#sidenav-5-6" role="button" aria-expanded="false" aria-controls="sidenav-5-6">Package 參考資料
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-5-6">
      <li class="nav-item">
    <a class="nav-link" href="/tools/pub/dependencies">依賴</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/pub/glossary">術語表</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/pub/package-layout">Package 檔案結構</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/pub/environment-variables">設定環境變數</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/pub/pubspec">Pubspec 檔案</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/pub/troubleshoot">問題排查</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/pub/verified-publishers">釋出者認證</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/pub/versioning">版本管理</a>
  </li></ul>
  </li>

</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-6" role="button" aria-expanded="false" aria-controls="sidenav-6">開發文件</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-6">
        <li class="nav-item">
    <a class="nav-link" href="/codelabs/async-await">Futures、async 和 await</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tutorials/language/streams">Streams 介紹</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/json">使用 JSON</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/language/numbers">Dart 中的數字</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-6-5" href="#sidenav-6-5" role="button" aria-expanded="false" aria-controls="sidenav-6-5">與其他語言進行互動呼叫
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-6-5">
      <li class="nav-item">
    <a class="nav-link" href="/guides/libraries/c-interop">與 C 互調</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/libraries/objective-c-interop">與 Objective-C 和 Swift 互調</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/libraries/java-interop">與 Java 和 Kotlin 互調</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/web/js-interop">與 JavaScript 互調</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link" href="/guides/google-apis">Google APIs</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/multiplatform-apps">跨平臺應用</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-6-8" href="#sidenav-6-8" role="button" aria-expanded="false" aria-controls="sidenav-6-8">命令列和伺服器端應用
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-6-8">
      <li class="nav-item">
    <a class="nav-link" href="/server">概覽</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tutorials/server/get-started">起步課程</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tutorials/server/cmdline">命令列應用</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tutorials/server/fetch-data">從網路上獲取資料</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tutorials/server/httpserver">編寫 HTTP 伺服器端應用</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/server/libraries">庫和 package</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/server/google-cloud">Google Cloud</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-6-9" href="#sidenav-6-9" role="button" aria-expanded="false" aria-controls="sidenav-6-9">網頁端 (Web) 應用
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-6-9">
      <li class="nav-item">
    <a class="nav-link" href="/web">概覽</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tutorials/web/get-started">開始使用</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-6-9-3" href="#sidenav-6-9-3" role="button" aria-expanded="false" aria-controls="sidenav-6-9-3">底層 Web 程式設計
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-6-9-3">
      <li class="nav-item">
    <a class="nav-link" href="/tutorials/web/low-level-html/connect-dart-html">Dart 與 HTML 關聯</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tutorials/web/low-level-html/add-elements">向 DOM 新增元素</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tutorials/web/low-level-html/remove-elements">移除 DOM 元素</a>
  </li>
  </ul>
  </li>
<li class="nav-item">
    <a class="nav-link" href="/web/deployment">部署</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/web/libraries">常用 Web 函式庫和 package</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link" href="/guides/environment-declarations">環境變數宣告</a>
  </li>
</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-7" role="button" aria-expanded="false" aria-controls="sidenav-7">開發工具和使用技巧</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-7">
        <li class="nav-item">
    <a class="nav-link" href="/tools">概覽</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-7-2" href="#sidenav-7-2" role="button" aria-expanded="false" aria-controls="sidenav-7-2">編輯器和除錯工具
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-7-2">
      <li class="nav-item">
    <a class="nav-link" href="/tools/jetbrains-plugin">使用 IntelliJ 和 Android Studio</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/vs-code">使用 VS Code</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/dart-devtools">Dart 開發者工具</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-7-2-4" href="#sidenav-7-2-4" role="button" aria-expanded="false" aria-controls="sidenav-7-2-4">線上執行 Dart 程式碼
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-7-2-4">
      <li class="nav-item">
    <a class="nav-link" href="/tools/dartpad">Overview</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dartpad/dartpad-best-practices">DartPad 課程</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dartpad/troubleshoot">DartPad 疑難解答</a>
  </li>
  </ul>
  </li>
</ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-7-3" href="#sidenav-7-3" role="button" aria-expanded="false" aria-controls="sidenav-7-3">命令列工具
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-7-3">
      <li class="nav-item">
    <a class="nav-link collapsable" data-toggle="collapse" data-target="#sidenav-7-3-1" href="#sidenav-7-3-1" role="button" aria-expanded="true" aria-controls="sidenav-7-3-1">Dart SDK
    </a>
    <ul class="nav flex-column flex-nowrap collapse show" id="sidenav-7-3-1">
      <li class="nav-item">
    <a class="nav-link" href="/tools/sdk">概覽</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-tool">dart 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-analyze">dart analyze 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-compile">dart compile 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-create">dart create 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-doc">dart doc 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-fix">dart fix 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-format">dart format 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-info">dart info 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/pub/cmd">dart pub 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-run">dart run 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-test">dart test 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dartaotruntime">dartaotruntime 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/experiment-flags">實驗性命令標記</a>
  </li>
  </ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable" data-toggle="collapse" data-target="#sidenav-7-3-2" href="#sidenav-7-3-2" role="button" aria-expanded="true" aria-controls="sidenav-7-3-2">其他的命令列工具
    </a>
    <ul class="nav flex-column flex-nowrap collapse show" id="sidenav-7-3-2">
      <li class="nav-item">
    <a class="nav-link" href="/tools/build_runner">build_runner 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/webdev">webdev 命令</a>
  </li>
  </ul>
  </li>
</ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-7-4" href="#sidenav-7-4" role="button" aria-expanded="false" aria-controls="sidenav-7-4">原始碼管理
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-7-4">
      <li class="nav-item">
    <a class="nav-link" href="/guides/language/formatting">程式碼格式化</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/libraries/private-files">不應提交的內容</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-7-5" href="#sidenav-7-5" role="button" aria-expanded="false" aria-controls="sidenav-7-5">靜態分析
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-7-5">
      <li class="nav-item">
    <a class="nav-link" href="/tools/analysis">自訂靜態分析</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/language/sound-problems">修復常見的型別問題</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/diagnostic-messages">診斷訊息</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/linter-rules">Linter 規則</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-7-6" href="#sidenav-7-6" role="button" aria-expanded="false" aria-controls="sidenav-7-6">測試和調優
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-7-6">
      <li class="nav-item">
    <a class="nav-link" href="/guides/testing">測試</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/web/debugging">除錯 Web 應用</a>
  </li></ul>
  </li>

</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-8" role="button" aria-expanded="false" aria-controls="sidenav-8">資源</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-8">
        <li class="nav-item">
    <a class="nav-link" href="/resources/faq">常見問題</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/language/evolution">版本演變</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/language/spec">語言規範</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/resources/dart-3-migration">Dart 3 遷移指南</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-8-5" href="#sidenav-8-5" role="button" aria-expanded="false" aria-controls="sidenav-8-5">從其他平台轉向 Dart
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-8-5">
      <li class="nav-item">
    <a class="nav-link" href="/guides/language/coming-from/js-to-dart">從 JavaScript 到 Dart</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/language/coming-from/swift-to-dart">從 Swift 到 Dart</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link" href="/resources/glossary">詞彙表</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/resources/books">書籍資源</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/resources/videos">影片資源</a>
  </li>
</ul>
    </li><li class="nav-item">
      <a class="nav-link " data-toggle="collapse" href="#sidenav-9" role="button" aria-expanded="true" aria-controls="sidenav-9">相關站點</a>

      <ul class="nav flex-column flex-nowrap collapse show" id="sidenav-9">
        <li class="nav-item">
    <a class="nav-link" href="https://api.dart.dev" target="_blank" rel="noopener">API 文件<span class="material-icons md-24">
        open_in_new
      </span></a>
  </li><li class="nav-item">
    <a class="nav-link" href="https://medium.com/dartlang" target="_blank" rel="noopener">Dart 團隊官方部落格<span class="material-icons md-24">
        open_in_new
      </span></a>
  </li><li class="nav-item">
    <a class="nav-link" href="https://dartpad.dev" target="_blank" rel="noopener">DartPad (線上編輯器)<span class="material-icons md-24">
        open_in_new
      </span></a>
  </li><li class="nav-item">
    <a class="nav-link" href="https://flutter.tw" target="_blank" rel="noopener">Flutter<span class="material-icons md-24">
        open_in_new
      </span></a>
  </li><li class="nav-item">
    <a class="nav-link" href="https://pub.dev" target="_blank" rel="noopener">Package 網站<span class="material-icons md-24">
        open_in_new
      </span></a>
  </li>
</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-10" role="button" aria-expanded="false" aria-controls="sidenav-10">關於 Dart 中文文件</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-10">
        <li class="nav-item">
    <a class="nav-link" href="https://flutter.tw/about/docs-cn" target="_blank" rel="noopener">關於本站<span class="material-icons md-24">
        open_in_new
      </span></a>
  </li><li class="nav-item">
    <a class="nav-link" href="https://flutter.tw/disclaimer" target="_blank" rel="noopener">免責條款 (Disclaimer)<span class="material-icons md-24">
        open_in_new
      </span></a>
  </li>
</ul>
    </li></ul>

  </div>
</div>

    <main id="page-content">
      







<div id="site-toc--side" class="site-toc ">
  <header class="site-toc__title">
    目錄
    
  </header>
  <ul id="toc" class="section-nav">
<li class="toc-entry nav-item toc-h2"><a class="nav-link" href="#overview">Overview</a>
<ul class="nav">
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#integers">Integers</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#floating-point-numbers">Floating-point numbers</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#boxed-and-unboxed-numbers">Boxed and unboxed numbers</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#lists-of-numbers">Lists of numbers</a></li>
</ul>
</li>
<li class="toc-entry nav-item toc-h2"><a class="nav-link" href="#pulling-back-the-curtains">Pulling back the curtains</a>
<ul class="nav">
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#integers-1">Integers</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#doubles">Doubles</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#boxing">Boxing</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#lists">Lists</a></li>
</ul>
</li>
</ul>
  
</div>


      <article>
        <div class="content">
          

          <div id="site-content-title">
            <div id="page-github-links" class="btn-group" aria-label="Page GitHub links" role="group">
  <a href="https://github.com/doggy8088/dart.tw/tree/master/src/_articles/archive/numeric-computation.md" class="btn no-automatic-external" title="View page source" target="_blank" rel="noopener">
    <i class="material-icons">description</i>
  </a>
  <a href="https://github.com/doggy8088/dart.tw/issues/new?template=1_page_issue.yml&amp;title=[PAGE ISSUE]: 'Numeric computation'&amp;page-url=https://dart.tw.gh.miniasp.com/articles/archive/numeric-computation&amp;page-source=https://github.com/doggy8088/dart.tw/tree/master/src/_articles/archive/numeric-computation.md" class="btn no-automatic-external" title="Report an issue with this page" target="_blank" rel="noopener">
    <i class="material-icons">bug_report</i>
  </a>
</div>

            
            <h1 id="numeric-computation">Numeric computation</h1>
            </div>
          







<div id="site-toc--inline" class="site-toc toc-collapsible toc-collapsed">
  <header class="site-toc__title">
    目錄
    
      <span class="site-toc--inline__toggle toc-toggle-down"><i class="material-icons">keyboard_arrow_down</i></span>
      <span class="site-toc--inline__toggle toc-toggle-up"><i class="material-icons">keyboard_arrow_up</i></span>
    
  </header>
  <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#overview">Overview</a>
<ul>
<li class="toc-entry toc-h3"><a href="#integers">Integers</a></li>
<li class="toc-entry toc-h3"><a href="#floating-point-numbers">Floating-point numbers</a></li>
<li class="toc-entry toc-h3"><a href="#boxed-and-unboxed-numbers">Boxed and unboxed numbers</a></li>
<li class="toc-entry toc-h3"><a href="#lists-of-numbers">Lists of numbers</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#pulling-back-the-curtains">Pulling back the curtains</a>
<ul>
<li class="toc-entry toc-h3"><a href="#integers-1">Integers</a></li>
<li class="toc-entry toc-h3"><a href="#doubles">Doubles</a></li>
<li class="toc-entry toc-h3"><a href="#boxing">Boxing</a></li>
<li class="toc-entry toc-h3"><a href="#lists">Lists</a></li>
</ul>
</li>
</ul>
  
    <span class="site-toc--inline__toggle toc-toggle-more-items"><i class="material-icons">more_horiz</i></span>
  
</div>


          <p><em>Written by John Mccutchan <br>
May 2013 (note added July 2018)</em></p>

<aside class="alert alert-warning" role="alert">
  <p><i class="material-icons" aria-hidden="true">report_problem</i> <strong>請注意:</strong>
  In Dart 2, arbitrary-precision integers were replaced with 64-bit
  signed, wrapping integers. The smi and mint representations still exist,
  but overflow now results in wrapping instead of automatic conversion to
  bigint (<code class="language-plaintext highlighter-rouge">BigInt</code> objects). The <a href="https://api.dart.dev/stable/dart-core/BigInt-class.html"><code class="language-plaintext highlighter-rouge">BigInt</code> class</a>
  is now available as a separate type that doesn’t implement <code class="language-plaintext highlighter-rouge">int</code>.</p>

  <p>Continue to avoid <code class="language-plaintext highlighter-rouge">BigInt</code> when possible. The VM has optimized code for
  <code class="language-plaintext highlighter-rouge">BigInt</code> arithmetic and modulus, but it never optimizes <code class="language-plaintext highlighter-rouge">BigInt</code> objects
  down to mints or smis that can be handled directly with CPU instructions.</p>
</aside>

<p>Performance matters to everyone.
It directly impacts your bottom line, conversion rates, and user satisfaction.
Just following a few simple rules can give you 50-100% speed improvements.</p>

<p>Follow the guidelines in this article
to get the most performance from the Dart VM in numerical applications.
You’ll learn about the four different number representations,
how integer and floating-point numerical computation occurs,
and how to pick the best container for your data.</p>

<aside class="alert alert-info" role="alert">
  <p><i class="material-icons" aria-hidden="true">info</i> <strong>備註:</strong>
  This article does not cover the SIMD types available in Dart,
  which enable operating on four floating-point numbers in parallel.
  To learn more, refer to the 
  <a href="https://api.dart.dev/stable/dart-typed_data/dart-typed_data-library.html"><code class="language-plaintext highlighter-rouge">dart:typed_data</code> documentation</a>.</p>
</aside>

<h2 id="overview">
<a class="anchor" href="#overview" aria-hidden="true"><span class="octicon octicon-link"></span></a>Overview</h2>

<p>The Dart language has two numeric types: int and double.
The former is an arbitrary-precision signed integer,
and the latter is the IEEE-754 double-precision floating-point number.
Examples:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>int speed = 3232943523452345329384234242323523;
int hitPoints = 21;
double position = 32.43432;
double hp = hitPoints.toDouble();
</code></pre></div></div>

<h3 id="integers">
<a class="anchor" href="#integers" aria-hidden="true"><span class="octicon octicon-link"></span></a>Integers</h3>

<p>While the language specifies an arbitrarily sized integer,
for performance reasons the VM has
three different internal integer representations:
<strong>smi</strong> (rhymes with <em>pie</em>), <strong>mint</strong>, and <strong>bigint</strong>.
Each representation is used to hold different ranges of integer numbers
(see the table).
The VM automatically switches between these representations behind the scenes
as numbers grow and shrink in range.</p>

<table class="table table-bordered">
  <tbody><tr>
    <th> Internal representation </th>
    <td> smi (<b>sm</b>all <b>i</b>nteger) </td>
    <td> mint (<b>m</b>edium <b>int</b>eger) </td>
    <td> bigint </td>
  </tr>
  <tr>
    <th> Minimum value </th>
    <td> -2<sup>30</sup> (on a 32-bit machine)
         <br>
         -2<sup>62</sup> (on a 64-bit machine)</td>
    <td> -2<sup>63</sup> </td>
    <td> Limited by RAM </td>
  </tr>
  <tr>
    <th> Maximum value </th>
    <td> 2<sup>30</sup> - 1 (on a 32-bit machine)
         <br>
         2<sup>62</sup> - 1 (on a 64-bit machine)</td>
    <td> 2<sup>63</sup> - 1 </td>
    <td> Limited by RAM </td>
  </tr>
</tbody></table>

<p>Here is an example of how a single integer value in the VM
graduates from smi to mint to bigint:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>main() {
  int hitPoints = 21; // starts as a smi
  print(hitPoints);  // 21
  hitPoints += potionOfSuperHealth.points; // becomes a mint
  print(hitPoints); // 2133232342342423
  hitPoints += spellOfNearlyInvinciblity.points; // becomes a bigint
  print(hitPoints);  // 99999999999999999999999999999999999999999
}
</code></pre></div></div>

<h3 id="floating-point-numbers">
<a class="anchor" href="#floating-point-numbers" aria-hidden="true"><span class="octicon octicon-link"></span></a>Floating-point numbers</h3>

<p>The VM has a single representation for floating-point numbers, the
<a href="https://en.wikipedia.org/wiki/Double_precision_floating-point_format">IEEE-754 double-precision floating-point number</a>.</p>

<h3 id="boxed-and-unboxed-numbers">
<a class="anchor" href="#boxed-and-unboxed-numbers" aria-hidden="true"><span class="octicon octicon-link"></span></a>Boxed and unboxed numbers</h3>

<p>In Dart, everything is an Object, even numbers.
If you come from a C/C++ background,
this might surprise you.
The result of any arithmetic or bitwise operation
results in a <em>new</em> number object.
Allocating a new object to store
the result of a numeric operation is inefficient,
and for that reason,
the VM employs an optimization technique called <em>unboxing</em>.
Unboxed numbers sit inside CPU registers.
The results of all numeric and bitwise operations on unboxed numbers
are also held in CPU registers,
avoiding most of the overhead of numbers represented as objects.</p>

<p>Presently the VM supports unboxed double and mint.
The VM employs a trick called tagging so that
it can box and unbox smi values without
allocating memory or loading the value from a object.
More on this later.</p>

<h3 id="lists-of-numbers">
<a class="anchor" href="#lists-of-numbers" aria-hidden="true"><span class="octicon octicon-link"></span></a>Lists of numbers</h3>

<p>Dart has two ways to store lists of numeric data:
<em>object lists</em> and <em>typed lists</em>.</p>

<h4 id="object-lists">Object lists</h4>

<p>A List stores a list of objects.
Examples include:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var a = [ 1.0, 2.0, 3.0 ];
var b = new List(3); // Create a new list with a fixed length of 3.
b[0] = 5;
b[1] = 99;
b[2] = 34;
</code></pre></div></div>

<p>The list <code class="language-plaintext highlighter-rouge">b</code> is an object list,
meaning it can store any object—for example, a String object or null.
This means that each entry in a List is as wide as the CPU’s pointer type.</p>

<h4 id="typed-lists">Typed lists</h4>

<p>Dart offers typed lists that store only numbers.
These lists are available in the
<a href="https://api.dart.dev/stable/dart-typed_data/dart-typed_data-library.html">dart:typed_data library.</a>
Typed lists can store only numbers
and cannot hold regular objects or have a null entry.
The dart:typed_data library has a distinct list for each common integer size,
as well as for 32-bit and 64-bit floating-point numbers.
When working with numbers that are smaller than the pointer width,
these lists can have considerable memory savings.
Some examples:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var a = new Float64List(3);
a[0] = 1.0;
a[1] = 2.0;
a[2] = 3.0;
var b = new Int8List(3);
b[0] = 5;
b[1] = 99;
b[2] = 34;
</code></pre></div></div>

<p>In both the object list and typed list examples,
the lists named <code class="language-plaintext highlighter-rouge">a</code> are holding the same values.
Same for the lists named <code class="language-plaintext highlighter-rouge">b</code>.
What’s different is how the values are stored in memory
and how they are accessed.
More on this later.</p>

<h2 id="pulling-back-the-curtains">
<a class="anchor" href="#pulling-back-the-curtains" aria-hidden="true"><span class="octicon octicon-link"></span></a>Pulling back the curtains</h2>

<p>The deep dive begins.
This section covers the above concepts in more detail
and provides actionable tips.</p>

<h3 id="integers-1">
<a class="anchor" href="#integers-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Integers</h3>

<p>The Dart VM has multiple internal representations of integer values.
The following sections explain each one
and how to efficiently perform left shifts.</p>

<h4 id="smis-and-mints">Smis and mints</h4>

<p>Remember that the VM has three different integer representations,
switching between them automatically depending on the size of an integer.
This section focuses on smi and mint.</p>

<p>The first representation, smi,
is the same size as a pointer on your platform, minus 1 bit.
On a 32-bit machine, a smi holds a 31-bit signed integer.
On a 64-bit machine, a smi holds a 63-bit signed integer.
A smi doesn’t require a memory allocation to be created
and is stored directly in a field.
The VM can do this by storing twice the numeric value,
guaranteeing the low bit being 0.
For all other objects
(including boxed doubles, mints, and bigints),
the low bit will be 1.
The VM uses this low bit to distinguish between smis and all other objects.</p>

<p>Because the stored smi is twice the numeric value,
the value must be right shifted by 1 before operated on;
this is called <em>untagging</em>.
Conversely, after being operated on the value must be added with itself
(equivalent of a multiplication by 2);
this is called <em>tagging</em>.
Despite these extra operations, a smi is very efficient
because it never requires a memory allocation
and all accesses are direct, avoiding dependent loads.
Note that many common operations—for example,
addition—do not require the smi to be untagged.</p>

<p>Consider an object called <code class="language-plaintext highlighter-rouge">entity</code>, defined as follows:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class Entity {
  Entity() {
    scale = 2;
    x = 3;
    y = 0x40000000;
  }
  int scale;
  int x;
  int y;
}

Entity entity = new Entity();
</code></pre></div></div>

<p>After the above code executes,
in memory on a 32-bit machine the <code class="language-plaintext highlighter-rouge">entity</code> object looks like this:</p>

<p><img src="images/1.png" alt="x and scale are smis and thus stored directly; y is 2^30, so it requires a pointer to memory"></p>

<p>Now consider this Dart code:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>entity.x = entity.x * entity.scale;
</code></pre></div></div>

<p>It’s converted into the VM instructions shown in the following figure.
Each VM instruction can return a value
shown as v1, v2, and so on.</p>

<p><img src="images/2.png" alt="3 values are needed (for x, scale, and the result)"></p>

<p>After that code executes, in memory the <code class="language-plaintext highlighter-rouge">entity</code> object looks like this:</p>

<p><img src="images/3.png" alt="Same memory illustration as before, except the value of x is now 24"></p>

<p>Now consider the second representation, mint,
which holds a 64-bit signed integer.
When stored, a mint <em>does</em> require a memory allocation.
The field a mint is stored into holds the address of the mint instance.
When loading a mint value,
the CPU must first load the address where the mint is stored
before loading the actual value.</p>

<p>The following Dart code is converted into the VM instructions shown below.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>entity.y = entity.y + entity.x;
</code></pre></div></div>

<p><img src="images/4.png" alt="6 values are needed (for y, x, unboxed y, unboxed x, the result, and the boxed result"></p>

<p>After that code executes, in memory the <code class="language-plaintext highlighter-rouge">entity</code> object looks like this:</p>

<p><img src="images/5.png" alt="y's previous memory is now garbage, and a new memory location holds y's new value"></p>

<p><strong>Performance tip:</strong>
If you can, stay in smi range.
Small machine integers fit in a register and can be loaded and stored
directly in the field instead of being fetched from memory.
They also never require memory allocation.
<strong>Note:</strong> The smi range depends on the CPU architecture.</p>

<h4 id="optimally-shifting-to-the-left">Optimally shifting to the left</h4>

<p>Left shifts are used for both arithmetic and logical operations.
When shifting to the left,
you must be careful that the values remain in smi range.
The VM performs an optimization when it sees a left shift
masked with a constant smi value:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>result = (int1 &lt;&lt; int2) &amp; CONSTANT;  // CONSTANT within smi range
</code></pre></div></div>

<p>For example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>a = (b &lt;&lt; c) &amp; 0x3FFFFFFF;
</code></pre></div></div>

<p>The VM knows that the result can be stored in a smi,
and it generates code that doesn’t check whether
a mint is needed to store the result.
The constant 0x3FFFFFFF is the maximum positive smi on 32-bit architectures.
0x3FFFFFFFFFFFFFFF is the equivalent constant on 64-bit architectures.
The constant does not have to be 0x3FFFFFFF;
it can be any constant that is a smi.</p>

<p><strong>Performance tip:</strong>
Because the smi range is variable,
assume a 31-bit range unless you require more bits.</p>

<p><strong>Pro tip:</strong>
Hexadecimal constants are signed in Dart,
so you must prefix the hexadecimal constant with a minus sign
if you want it to be negative.
On a 32-bit machine,
the largest negative number that is still a smi is -0x40000000;
the largest positive number that is still a smi is 0x3FFFFFFF.</p>

<h4 id="lists-of-integers">Lists of integers</h4>

<p>When a smi is loaded or stored into an object list (List)
the smi value, unaltered, is copied into the list.
This is the most efficient way to load and store integers
within the smi range.
In contrast, loading and storing a smi into a typed list (dart:typed_data)
requires the smi to be untagged and tagged, respectively.
These operations can add overhead when working with typed lists.</p>

<p>Consider the following code,
assuming that all integer variables stay within the smi range:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>for (int i = 0; i &lt; list.length; i++) {
  list[i] = list[i] + b;
}
</code></pre></div></div>

<p>If <code class="language-plaintext highlighter-rouge">list</code> is an object list,
no smi tagging or untagging occurs.
Note that some integer operations—for example,
addition—can work on tagged smi values while others—for example,
multiplication—must first untag the smi values.
If <code class="language-plaintext highlighter-rouge">list</code> is a typed list,
the loaded value must be tagged and then,
before the result is stored,
it must be untagged.
Furthermore, the index (<code class="language-plaintext highlighter-rouge">i</code>)
into a typed list is untagged and then tagged.</p>

<p><strong>Performance tip:</strong>
When working within the smi range,
consider using an object list instead of a typed list,
to improve speed.</p>

<p>However, you might want to use a typed list instead of an object list
because typed lists have a smaller GC impact
and better CPU cache performance:</p>

<ul>
  <li>
    <p>Because typed lists can never store an object reference,
the garbage collection load for typed lists is very low.
In contrast an object list must be scanned,
and each entry is checked for an object pointer.</p>
  </li>
  <li>
    <p>Typed lists can be much more dense.
For example, if you know you need only 8 bits of precision
you can use an Int8List,
using much less memory and making better use of your CPU’s cache.</p>
  </li>
</ul>

<p>In general and specifically because of the above caveats,
it is always a good idea to benchmark 
your algorithm using both object and typed lists.</p>

<p><strong>Performance tip:</strong>
If possible, avoiding storing integers outside the smi range in typed lists.
When an integer is loaded from a typed list
that can hold integer values outside of the smi or mint range,
a check must be done and an object may be allocated.
Int32List and Uint32List can hold numbers
that are bigger than a smi on 32-bit architectures.
Int64List and Uint64List can hold numbers that are bigger than a mint,
resulting in a bigint on all platforms!</p>

<h4 id="bigints">Bigints</h4>

<p>The third integer representation, bigint,
holds an arbitrarily large signed integer.
The field a bigint is stored into holds the address of the bigint instance.
When loading a bigint,
the entire numeric value does not fit inside a CPU register,
and the CPU does not have instructions for operations on bigint values.
Thus, bigints are significantly more expensive than smis or mints.</p>

<p><strong>Performance tip:</strong>
Avoid bigint whenever possible.
The VM doesn’t optimize operations on bigint instances.</p>

<h3 id="doubles">
<a class="anchor" href="#doubles" aria-hidden="true"><span class="octicon octicon-link"></span></a>Doubles</h3>

<p>Computations involving double values are unboxed,
making them very efficient.</p>

<h4 id="lists-of-doubles">Lists of doubles</h4>

<p>When a double is stored into an object list,
it must be boxed,
which requires a memory allocation and a memory store.</p>

<p>Two typed lists support double-precision values: Float32List and Float64List.
The trade-off between the two lists is
storage density versus the conversion cost.
Float32List is twice as dense as Float64List,
but values loaded from a Float32List must be converted
to a double-precision number.
Conversely, doubles must be converted to a single-precision number
on storage in a Float32List.</p>

<p><strong>Performance tip:</strong>
Use Float32List or Float64List whenever you store lists of double values.
Unlike the case with smis,
using an object list with doubles is always slower.</p>

<p><strong>Performance tip:</strong>
Benchmark your application using both Float32List and Float64List
to determine which performs best.</p>

<h3 id="boxing">
<a class="anchor" href="#boxing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Boxing</h3>

<p><em>Boxing</em> is the operation of moving a scalar value from a register
and placing it inside a Dart object.
<em>Unboxing</em> is the opposite:
taking the scalar value stored inside a Dart object
and placing it inside a register to be operated on.</p>

<p>Boxing is expensive and something that you want to avoid
in the middle of numeric computation.
The following operations can trigger a number to be boxed:</p>

<ul>
  <li>
    <p>Passing a number to another function.
Functions accept only boxed objects,
so if you pass an unboxed number to a function,
the number will be boxed first.</p>
  </li>
  <li>
    <p>Returning a number from a function.
Functions can return only boxed objects,
so if you return an unboxed number from a function,
the number will be boxed first.</p>
  </li>
  <li>
    <p>Storing a non-smi number to a field.
Fields can hold only smi values or object pointers.</p>
  </li>
</ul>

<p>Boxing requires a memory allocation and a store.
Unboxing requires a load.</p>

<p><img src="images/6.png" alt="Illustration of boxing and unboxing 3.14159"></p>

<h3 id="lists">
<a class="anchor" href="#lists" aria-hidden="true"><span class="octicon octicon-link"></span></a>Lists</h3>

<p>Remember, two kinds of list can store numeric data—the
object list and the typed list.
This section tells you how list data is laid out in memory
and how loading and storing work.</p>

<h4 id="object-lists-instances-of-list">Object lists (instances of List)</h4>

<p>At runtime, an object list (a List) is an array of pointers.
Each entry in the array holds a pointer to the number stored in that entry.
The only exception is smi,
which fits in the memory used to store the pointer.
When type checking is not enforced,
object lists can hold objects of any type.
Object lists can contain the null object.</p>

<p><img src="images/7.png" alt="Illustration of a list's memory, which contains a smi (4) and two points to doubles (1.0 and 2.0)"></p>

<p>Loading a number from an object list works like this:</p>

<ol>
  <li>
    <p>The base address of the backing store for the list is calculated.
(For growable lists, this includes a dependent load.)</p>
  </li>
  <li>
    <p>The address of the number or the tagged smi is loaded from
the list backing store.</p>
  </li>
</ol>

<p><img src="images/8.png" alt="Illustration of loading a number from an object list"></p>

<p>Storing a number into an object list works like this:</p>

<ol>
  <li>If the number is not a smi,
a new number instance is allocated.</li>
  <li>The base address of the backing store for the list is calculated.
(For growable lists,
this includes a dependent load.)</li>
  <li>The address of the number or the tagged smi value is stored in
the list backing store.</li>
</ol>

<p><img src="images/9.png" alt="Illustration of storing a number into an object list"></p>

<h4 id="typed-lists-1">Typed lists</h4>

<p>At runtime, a typed list is an array of numeric values.
Each entry in the array always holds the value directly.
Typed lists can be much denser,
providing better memory and CPU cache usage.
Typed lists are also faster to process at garbage collection time
because they don’t have to be scanned for object pointers.</p>

<p><img src="images/10.png" alt="Illustration of a typed list's memory, containing the numbers 4, 1.0, and 2.0 (and no pointers)"></p>

<p>Loading a double-precision number from a typed data list works like this:</p>

<ol>
  <li>The base address of the backing store for the list is calculated.
(For transferable lists,
this includes a dependent load.)</li>
  <li>The value is loaded from the list backing store.</li>
</ol>

<p><img src="images/11.png" alt="Illustration of loading a number from a typed list"></p>

<p>Storing a double-precision number into a typed data list works like this:</p>

<ol>
  <li>The base address of the backing store for the list is calculated.
(For transferable lists,
this includes a dependent load.)</li>
  <li>The double number is stored into the list backing store.</li>
</ol>

<p><img src="images/12.png" alt="Illustration of storing a number into a typed list"></p>

<p>Loading an integer number from a typed list can be more expensive than
the double case in the following two cases:</p>

<ul>
  <li>
    <p>The number retrieved from the list is outside smi range
but inside mint range.
In this case a mint must allocated to store the number.
This case is possible with Int32List, Uint32List, Int64List, and Uint64List.
Optimized code can avoid the mint allocation
by loading directly into an unboxed mint.</p>
  </li>
  <li>
    <p>The number retrieved is outside mint range.
In this case a bigint must be allocated to store the number.
This case is possible with Int64List and Uint64List.</p>
  </li>
</ul>

<p>Note that loading or storing a smi into a typed list requires that
the value be tagged or untagged, respectively.</p>

<p><strong>Performance tip:</strong>
Flatten multiple-dimension lists into a single list,
and compute the flattened index at runtime.
This way you avoid the expense of dealing with a list of lists.</p>


          

        </div>
      </article>
    </main>
    <footer id="page-footer">
    <div class="footer-section footer-main">
      <a href="/" class="brand" title="Dart">
        <img src="/assets/img/shared/dart/logo+text/horizontal/white.svg" alt="Dart" width="164px">
      </a>
      <div class="footer-social-links">
        <a href="https://github.com/doggy8088/dart.tw" target="_blank" rel="noopener" title="GitHub" class="no-automatic-external">
          <svg>
            <use href="/assets/img/social/github.svg#github"></use>
          </svg>
        </a>
      </div>
    </div>
    <div class="footer-section footer-tray">
      <div class="footer-licenses">
        參考中文內容需註明本站及連結作為出處，英文內容和範例程式碼均遵從源站授權協議。
      </div>
      <div class="footer-utility-links">
        <ul>
          <li><a href="/terms" title="使用條款">使用條款</a></li>
          <li><a href="https://policies.google.com/privacy?hl=zh-TW" target="_blank" rel="noopener" title="隱私政策" class="no-automatic-external">隱私政策</a></li>
          <li><a href="/security" title="Security philosophy and practices">Dart 程式碼安全說明</a></li>
          <li><a href="https://flutter.tw/about" target="_blank">關於中文文件</a>
          </li><li><a href="https://flutter.tw/disclaimer" target="_blank">免責條款</a>
          </li><li><a href="https://dart.cn/" target="_blank">Dart 簡體中文文檔</a>
        </li></ul>
      </div>
    </div>
  </footer>

  

<script src="/assets/translator/js/translator.js"></script></body></html>