<!DOCTYPE html><html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Language" content="zh-cmn-Hans">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Google Tag Manager -->
<!--  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':-->
<!--  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],-->
<!--  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=-->
<!--  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);-->
<!--  })(window,document,'script','dataLayer','GTM-5VSZM5J');</script>-->
  <!-- End Google Tag Manager -->

  <meta name="description" content="Manage your asynchronous code: handle uncaught errors, override behavior (such as printing and scheduling tasks), and more.">
  <title>Zones | Dart</title>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-28P0PYCRZ9"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-28P0PYCRZ9');
  </script>

  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?fa71f2474b82505e00203cf9956cf0bc";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>

  <!-- Favicon / Touch Icons -->
  <link rel="icon" sizes="64x64" href="/assets/shared/dart/icon/64.png">
  <link href="/assets/img/touch-icon-iphone.png" rel="apple-touch-icon">
  <link href="/assets/img/touch-icon-ipad.png" rel="apple-touch-icon" sizes="152x152">
  <link href="/assets/img/touch-icon-iphone-retina.png" rel="apple-touch-icon" sizes="180x180">
  <link href="/assets/img/touch-icon-ipad-retina.png" rel="apple-touch-icon" sizes="167x167">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@dart_lang">
  <meta name="twitter:title" content="Zones">
  <meta name="twitter:description" content="Manage your asynchronous code: handle uncaught errors, override behavior (such as printing and scheduling tasks), and more.">

  <!-- Open Graph -->
  <meta property="og:title" content="Zones">
  <meta property="og:description" content="Manage your asynchronous code: handle uncaught errors, override behavior (such as printing and scheduling tasks), and more.">
  <meta property="og:url" content="https://dart.tw.gh.miniasp.com/articles/archive/zones">

  <meta property="og:image" content="https://dart.tw.gh.miniasp.com/assets/shared/dart-logo-for-shares.png?2">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
  <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&amp;display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Google+Sans+Display:wght@400&amp;display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Google+Sans+Mono:wght@400;500;700&amp;display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&amp;display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons&amp;display=swap" rel="stylesheet">
  <script src="https://cdn.staticfile.org/font-awesome/5.15.4/js/all.js" data-auto-replace-svg="nest">
  </script>

  <link rel="stylesheet" href="/assets/css/main.css?v=1693674404">
  <script src="https://cdn.staticfile.org/jquery/3.7.0/jquery.min.js" integrity="sha512-3gJwYpMe3QewGELv8k/BX9vcqhryRdzRMxVfq6ngyWXwo03GFEzjsUm8Q7RZcHPHksttq7/GFoxjCVUjkjvPdw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdn.staticfile.org/popper.js/1.16.1/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdn.staticfile.org/bootstrap/4.6.2/js/bootstrap.min.js" integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <!-- <script src="https://cdn.staticfile.org/js-cookie/3.0.5/js.cookie.min.js"
          integrity="sha512-nlp9/l96/EpjYBx7EP7pGASVXNe80hGhYAUrjeXnu/fyF5Py0/RXav4BBNs7n5Hx1WFhOEOWSAVjGeC3oKxDVQ=="
          crossorigin="anonymous"
          referrerpolicy="no-referrer"></script> -->

  <script src="/assets/js/vendor/code-prettify/prettify.js"></script>
  <script src="/assets/js/vendor/code-prettify/lang-dart.js"></script>
  <script src="/assets/js/vendor/code-prettify/lang-yaml.js"></script>
  <script src="/assets/js/os-tabs.js?v=1693674404"></script>
  <script src="/assets/js/utilities.js?v=1693674404"></script>
  <script src="/assets/js/main.js?v=1693674404"></script>

  <script>

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-122680122-5', 'auto');
ga('send', 'pageview');

</script>


 <link href="/assets/translator/css/translator.css" rel="stylesheet"></head>

  <body class="default obsolete show_banner">
    <section id="cookie-notice">
  <div class="container">
    <p>Google uses cookies to deliver its services, to personalize ads, and to 
      analyze traffic. You can adjust your privacy controls anytime in your 
      <a href="https://myaccount.google.com/data-and-personalization" target="_blank" rel="noopener" class="no-automatic-external">Google settings</a>. 
      <a href="https://policies.google.com/technologies/cookies" target="_blank" rel="noopener" class="no-automatic-external">Learn more</a>.
    </p>
    <button id="cookie-consent" class="btn btn-primary">Okay</button>
  </div>
</section>

    <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=G-28P0PYCRZ9"
 height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

    <header id="page-header" class="site-header">
  <nav id="mainnav" class="site-header">
  <div id="menu-toggle"><i class="material-icons">menu</i></div>
  <a href="/" class="brand" title="Dart">
    <img src="/assets/img/shared/dart/logo+text/horizontal/white.svg" alt="Dart">
  </a>
  <ul class="navbar">
    <li>
      <a href="/overview" class="nav-link">概覽</a>
    </li>
    <li class="mainnav__get-started">
      <a href="/guides" class="nav-link
        ">
        <span>文件</span>
      </a>
    </li>
    <li>
      <a href="/community" class="nav-link">社群</a>
    </li>
    <li>
      <a href="/#try-dart" class="nav-link">嘗試 Dart</a>
    </li>
    <li>
      <a href="/get-dart" class="nav-link">獲取 Dart SDK</a>
    </li>
    <li class="searchfield">
      <form action="/search" class="site-header__search form-inline" id="cse-search-box">
        <input type="hidden" name="cx" value="011220921317074318178:_yy-tmb5t_i">
        <input type="hidden" name="ie" value="UTF-8">
        <input type="hidden" name="hl" value="en">
        <input class="site-header__searchfield form-control search-field" type="search" name="q" id="q" autocomplete="off" placeholder="Search" aria-label="Search">
      </form>
    </li>
  </ul>
</nav>

  
  <div class="alert alert-warning">
    <h4 class="text-center" id="------some-of-the-content-of-this-page-might-be-out-of-date----">
      Some of the content of this page might be out of date.
    </h4>
  </div>
  
</header>
 <div class="banner">
  <p class="banner__text">
    Dart 3 已釋出！帶來了全新的
    <a href="https://dart.tw.gh.miniasp.com/language/records" class="no-automatic-external">記錄型別 (records)</a>、
    <a href="https://dart.tw.gh.miniasp.com/language/patterns" class="no-automatic-external">模式匹配 (patterns)</a>
    以及 <a href="https://dart.tw.gh.miniasp.com/language/class-modifiers" class="no-automatic-external">型別修飾符 (class modifiers)</a>。
    <br>
    <!--<a href="https://medium.com/p/53f065a10635" class="no-automatic-external">Check out the blog post</a>!-->
  </p>
</div>
 

    <div id="sidenav" class="">
  <form action="/search/" class="site-header__search form-inline">
    <input class="site-header__searchfield form-control search-field" type="search" name="q" id="q" autocomplete="off" placeholder="Search" aria-label="Search">
  </form>

  <div class="site-sidebar">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a href="/overview" class="nav-link">概覽</a>
      </li>
      <li class="nav-item">
        <a href="/community" class="nav-link">社群</a>
      </li>
      <li class="nav-item">
        <a href="https://dartpad.dev" class="nav-link">嘗試 Dart</a>
      </li>
      <li class="nav-item">
        <a href="/get-dart" class="nav-link">獲取 Dart SDK</a>
      </li>
      <li class="nav-item">
        <a href="/guides" class="nav-link">文件</a>
      </li>
    </ul>

    <ul class="nav flex-column"><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-1" role="button" aria-expanded="false" aria-controls="sidenav-1">範例和課程</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-1">
        <li class="nav-item">
    <a class="nav-link" href="/tutorials">語言概覽</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable" data-toggle="collapse" data-target="#sidenav-1-2" href="#sidenav-1-2" role="button" aria-expanded="true" aria-controls="sidenav-1-2">Codelabs
    </a>
    <ul class="nav flex-column flex-nowrap collapse show" id="sidenav-1-2">
      <li class="nav-item">
    <a class="nav-link" href="/codelabs">Codelabs 列表</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/codelabs/dart-cheatsheet">Dart 速查表</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/codelabs/iterables">可迭代集合</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/codelabs/async-await">Dart 非同步程式設計</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/codelabs/null-safety">空安全</a>
  </li></ul>
  </li>

</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-2" role="button" aria-expanded="false" aria-controls="sidenav-2">Dart 開發語言</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2">
        <li class="nav-item">
    <a class="nav-link" href="/language">介紹</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-2-2" href="#sidenav-2-2" role="button" aria-expanded="false" aria-controls="sidenav-2-2">基礎表示式
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2-2">
      <li class="nav-item">
    <a class="nav-link" href="/language/variables">變數</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/operators">運運算元</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/comments">註釋</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/metadata">註解</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/libraries">庫 &amp; 導庫</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/keywords">關鍵字</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-2-3" href="#sidenav-2-3" role="button" aria-expanded="false" aria-controls="sidenav-2-3">型別
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2-3">
      <li class="nav-item">
    <a class="nav-link" href="/language/built-in-types">基本型別</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/records">記錄 (Records)</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/collections">集合 (Collections)</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/generics">泛型 (Generics)</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/typedefs">別名 (Typedefs)</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/type-system">型別系統</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-2-4" href="#sidenav-2-4" role="button" aria-expanded="false" aria-controls="sidenav-2-4">模式匹配
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2-4">
      <li class="nav-item">
    <a class="nav-link" href="/language/patterns">概覽 &amp; 用法</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/pattern-types">模式匹配型別</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link" href="/language/functions">函式方法</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-2-6" href="#sidenav-2-6" role="button" aria-expanded="false" aria-controls="sidenav-2-6">控制流
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2-6">
      <li class="nav-item">
    <a class="nav-link" href="/language/loops">迴圈</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/branches">分支</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link" href="/language/error-handling">錯誤處理</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-2-8" href="#sidenav-2-8" role="button" aria-expanded="false" aria-controls="sidenav-2-8">類 &amp; 物件
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2-8">
      <li class="nav-item">
    <a class="nav-link" href="/language/classes">類</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/constructors">構造方法</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/methods">成員方法</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/extend">繼承</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/mixins">混入 (Mixin)</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/enums">列舉</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/extension-methods">擴充方法</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/callable-objects">可呼叫的物件</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-2-9" href="#sidenav-2-9" role="button" aria-expanded="false" aria-controls="sidenav-2-9">型別修飾符
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2-9">
      <li class="nav-item">
    <a class="nav-link" href="/language/class-modifiers">概覽 &amp; 用法</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/class-modifiers-for-apis">API 維護者應該用的型別修飾符</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/modifier-reference">速查表</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-2-10" href="#sidenav-2-10" role="button" aria-expanded="false" aria-controls="sidenav-2-10">併發
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2-10">
      <li class="nav-item">
    <a class="nav-link" href="/language/async">非同步支援</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/concurrency">Isolates</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-2-11" href="#sidenav-2-11" role="button" aria-expanded="false" aria-controls="sidenav-2-11">Null safety
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2-11">
      <li class="nav-item">
    <a class="nav-link" href="/null-safety">健全的空安全</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/null-safety/migration-guide">遷移到空安全</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/null-safety/understanding-null-safety">深入理解空安全</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/null-safety/unsound-null-safety">非健全的空安全</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/null-safety/faq">空安全常見問題和解答</a>
  </li></ul>
  </li>

</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-3" role="button" aria-expanded="false" aria-controls="sidenav-3">高效指南 (Effective Dart)</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-3">
        <li class="nav-item">
    <a class="nav-link" href="/effective-dart">概述</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/effective-dart/style">程式碼風格</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/effective-dart/documentation">文件</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/effective-dart/usage">用法範例</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/effective-dart/design">API 設計</a>
  </li>
</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-4" role="button" aria-expanded="false" aria-controls="sidenav-4">核心函式庫</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-4">
        <li class="nav-item">
    <a class="nav-link" href="/guides/libraries">概覽</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/libraries/library-tour">概覽</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-4-3" href="#sidenav-4-3" role="button" aria-expanded="false" aria-controls="sidenav-4-3">介紹文章
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-4-3">
      <li class="nav-item">
    <a class="nav-link" href="/articles/libraries/creating-streams">建立 stream</a>
  </li></ul>
  </li>

</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-5" role="button" aria-expanded="false" aria-controls="sidenav-5">Packages</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-5">
        <li class="nav-item">
    <a class="nav-link" href="/guides/packages">如何使用 package</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/libraries/useful-libraries">常用 package 介紹</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/libraries/create-packages">建立 package</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/pub/publishing">釋出 package</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/libraries/writing-package-pages">設定 package 介紹頁</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-5-6" href="#sidenav-5-6" role="button" aria-expanded="false" aria-controls="sidenav-5-6">Package 參考資料
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-5-6">
      <li class="nav-item">
    <a class="nav-link" href="/tools/pub/dependencies">依賴</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/pub/glossary">術語表</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/pub/package-layout">Package 檔案結構</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/pub/environment-variables">設定環境變數</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/pub/pubspec">Pubspec 檔案</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/pub/troubleshoot">問題排查</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/pub/verified-publishers">釋出者認證</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/pub/versioning">版本管理</a>
  </li></ul>
  </li>

</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-6" role="button" aria-expanded="false" aria-controls="sidenav-6">開發文件</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-6">
        <li class="nav-item">
    <a class="nav-link" href="/codelabs/async-await">Futures、async 和 await</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tutorials/language/streams">Streams 介紹</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/json">使用 JSON</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/language/numbers">Dart 中的數字</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-6-5" href="#sidenav-6-5" role="button" aria-expanded="false" aria-controls="sidenav-6-5">與其他語言進行互動呼叫
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-6-5">
      <li class="nav-item">
    <a class="nav-link" href="/guides/libraries/c-interop">與 C 互調</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/libraries/objective-c-interop">與 Objective-C 和 Swift 互調</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/libraries/java-interop">與 Java 和 Kotlin 互調</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/web/js-interop">與 JavaScript 互調</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link" href="/guides/google-apis">Google APIs</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/multiplatform-apps">跨平臺應用</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-6-8" href="#sidenav-6-8" role="button" aria-expanded="false" aria-controls="sidenav-6-8">命令列和伺服器端應用
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-6-8">
      <li class="nav-item">
    <a class="nav-link" href="/server">概覽</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tutorials/server/get-started">起步課程</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tutorials/server/cmdline">命令列應用</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tutorials/server/fetch-data">從網路上獲取資料</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tutorials/server/httpserver">編寫 HTTP 伺服器端應用</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/server/libraries">庫和 package</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/server/google-cloud">Google Cloud</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-6-9" href="#sidenav-6-9" role="button" aria-expanded="false" aria-controls="sidenav-6-9">網頁端 (Web) 應用
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-6-9">
      <li class="nav-item">
    <a class="nav-link" href="/web">概覽</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tutorials/web/get-started">開始使用</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-6-9-3" href="#sidenav-6-9-3" role="button" aria-expanded="false" aria-controls="sidenav-6-9-3">底層 Web 程式設計
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-6-9-3">
      <li class="nav-item">
    <a class="nav-link" href="/tutorials/web/low-level-html/connect-dart-html">Dart 與 HTML 關聯</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tutorials/web/low-level-html/add-elements">向 DOM 新增元素</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tutorials/web/low-level-html/remove-elements">移除 DOM 元素</a>
  </li>
  </ul>
  </li>
<li class="nav-item">
    <a class="nav-link" href="/web/deployment">部署</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/web/libraries">常用 Web 函式庫和 package</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link" href="/guides/environment-declarations">環境變數宣告</a>
  </li>
</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-7" role="button" aria-expanded="false" aria-controls="sidenav-7">開發工具和使用技巧</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-7">
        <li class="nav-item">
    <a class="nav-link" href="/tools">概覽</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-7-2" href="#sidenav-7-2" role="button" aria-expanded="false" aria-controls="sidenav-7-2">編輯器和除錯工具
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-7-2">
      <li class="nav-item">
    <a class="nav-link" href="/tools/jetbrains-plugin">使用 IntelliJ 和 Android Studio</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/vs-code">使用 VS Code</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/dart-devtools">Dart 開發者工具</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-7-2-4" href="#sidenav-7-2-4" role="button" aria-expanded="false" aria-controls="sidenav-7-2-4">線上執行 Dart 程式碼
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-7-2-4">
      <li class="nav-item">
    <a class="nav-link" href="/tools/dartpad">Overview</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dartpad/dartpad-best-practices">DartPad 課程</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dartpad/troubleshoot">DartPad 疑難解答</a>
  </li>
  </ul>
  </li>
</ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-7-3" href="#sidenav-7-3" role="button" aria-expanded="false" aria-controls="sidenav-7-3">命令列工具
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-7-3">
      <li class="nav-item">
    <a class="nav-link collapsable" data-toggle="collapse" data-target="#sidenav-7-3-1" href="#sidenav-7-3-1" role="button" aria-expanded="true" aria-controls="sidenav-7-3-1">Dart SDK
    </a>
    <ul class="nav flex-column flex-nowrap collapse show" id="sidenav-7-3-1">
      <li class="nav-item">
    <a class="nav-link" href="/tools/sdk">概覽</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-tool">dart 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-analyze">dart analyze 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-compile">dart compile 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-create">dart create 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-doc">dart doc 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-fix">dart fix 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-format">dart format 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-info">dart info 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/pub/cmd">dart pub 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-run">dart run 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-test">dart test 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dartaotruntime">dartaotruntime 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/experiment-flags">實驗性命令標記</a>
  </li>
  </ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable" data-toggle="collapse" data-target="#sidenav-7-3-2" href="#sidenav-7-3-2" role="button" aria-expanded="true" aria-controls="sidenav-7-3-2">其他的命令列工具
    </a>
    <ul class="nav flex-column flex-nowrap collapse show" id="sidenav-7-3-2">
      <li class="nav-item">
    <a class="nav-link" href="/tools/build_runner">build_runner 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/webdev">webdev 命令</a>
  </li>
  </ul>
  </li>
</ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-7-4" href="#sidenav-7-4" role="button" aria-expanded="false" aria-controls="sidenav-7-4">原始碼管理
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-7-4">
      <li class="nav-item">
    <a class="nav-link" href="/guides/language/formatting">程式碼格式化</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/libraries/private-files">不應提交的內容</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-7-5" href="#sidenav-7-5" role="button" aria-expanded="false" aria-controls="sidenav-7-5">靜態分析
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-7-5">
      <li class="nav-item">
    <a class="nav-link" href="/tools/analysis">自訂靜態分析</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/language/sound-problems">修復常見的型別問題</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/diagnostic-messages">診斷訊息</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/linter-rules">Linter 規則</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-7-6" href="#sidenav-7-6" role="button" aria-expanded="false" aria-controls="sidenav-7-6">測試和調優
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-7-6">
      <li class="nav-item">
    <a class="nav-link" href="/guides/testing">測試</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/web/debugging">除錯 Web 應用</a>
  </li></ul>
  </li>

</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-8" role="button" aria-expanded="false" aria-controls="sidenav-8">資源</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-8">
        <li class="nav-item">
    <a class="nav-link" href="/resources/faq">常見問題</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/language/evolution">版本演變</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/language/spec">語言規範</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/resources/dart-3-migration">Dart 3 遷移指南</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-8-5" href="#sidenav-8-5" role="button" aria-expanded="false" aria-controls="sidenav-8-5">從其他平台轉向 Dart
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-8-5">
      <li class="nav-item">
    <a class="nav-link" href="/guides/language/coming-from/js-to-dart">從 JavaScript 到 Dart</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/language/coming-from/swift-to-dart">從 Swift 到 Dart</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link" href="/resources/glossary">詞彙表</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/resources/books">書籍資源</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/resources/videos">影片資源</a>
  </li>
</ul>
    </li><li class="nav-item">
      <a class="nav-link " data-toggle="collapse" href="#sidenav-9" role="button" aria-expanded="true" aria-controls="sidenav-9">相關站點</a>

      <ul class="nav flex-column flex-nowrap collapse show" id="sidenav-9">
        <li class="nav-item">
    <a class="nav-link" href="https://api.dart.dev" target="_blank" rel="noopener">API 文件<span class="material-icons md-24">
        open_in_new
      </span></a>
  </li><li class="nav-item">
    <a class="nav-link" href="https://medium.com/dartlang" target="_blank" rel="noopener">Dart 團隊官方部落格<span class="material-icons md-24">
        open_in_new
      </span></a>
  </li><li class="nav-item">
    <a class="nav-link" href="https://dartpad.dev" target="_blank" rel="noopener">DartPad (線上編輯器)<span class="material-icons md-24">
        open_in_new
      </span></a>
  </li><li class="nav-item">
    <a class="nav-link" href="https://flutter.tw" target="_blank" rel="noopener">Flutter<span class="material-icons md-24">
        open_in_new
      </span></a>
  </li><li class="nav-item">
    <a class="nav-link" href="https://pub.dev" target="_blank" rel="noopener">Package 網站<span class="material-icons md-24">
        open_in_new
      </span></a>
  </li>
</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-10" role="button" aria-expanded="false" aria-controls="sidenav-10">關於 Dart 中文文件</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-10">
        <li class="nav-item">
    <a class="nav-link" href="https://flutter.tw/about/docs-cn" target="_blank" rel="noopener">關於本站<span class="material-icons md-24">
        open_in_new
      </span></a>
  </li><li class="nav-item">
    <a class="nav-link" href="https://flutter.tw/disclaimer" target="_blank" rel="noopener">免責條款 (Disclaimer)<span class="material-icons md-24">
        open_in_new
      </span></a>
  </li>
</ul>
    </li></ul>

  </div>
</div>

    <main id="page-content">
      







<div id="site-toc--side" class="site-toc ">
  <header class="site-toc__title">
    目錄
    
  </header>
  <ul id="toc" class="section-nav">
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#asynchronous-dynamic-extents">Asynchronous dynamic extents</a></li>
<li class="toc-entry nav-item toc-h2"><a class="nav-link" href="#zone-basics">Zone basics</a></li>
<li class="toc-entry nav-item toc-h2"><a class="nav-link" href="#handling-uncaught-errors">Handling uncaught errors</a>
<ul class="nav">
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#example-errors-cant-cross-into-error-zones">Example: Errors can’t cross into error zones</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#example-errors-cant-leave-error-zones">Example: Errors can’t leave error zones</a></li>
</ul>
</li>
<li class="toc-entry nav-item toc-h2"><a class="nav-link" href="#using-zones-with-streams">Using zones with streams</a>
<ul class="nav">
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#example-using-a-stream-with-runzonedguarded">Example: Using a stream with runZonedGuarded()</a></li>
</ul>
</li>
<li class="toc-entry nav-item toc-h2"><a class="nav-link" href="#storing-zone-local-values">Storing zone-local values</a>
<ul class="nav">
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#example-using-a-zone-local-value-for-debug-logs">Example: Using a zone-local value for debug logs</a></li>
</ul>
</li>
<li class="toc-entry nav-item toc-h2"><a class="nav-link" href="#overriding-functionality">Overriding functionality</a>
<ul class="nav">
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#example-overriding-print">Example: Overriding print</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#arguments-to-interceptors-and-delegates">Arguments to interceptors and delegates</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#example-delegating-to-the-parent-zone">Example: Delegating to the parent zone</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#example-executing-code-when-entering-and-leaving-a-zone">Example: Executing code when entering and leaving a zone</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#example-handling-callbacks">Example: Handling callbacks</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#implementing-asynchronous-callbacks">Implementing asynchronous callbacks</a></li>
</ul>
</li>
<li class="toc-entry nav-item toc-h2"><a class="nav-link" href="#summary">Summary</a>
<ul class="nav">
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#more-resources">More resources</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#more-examples">More examples</a></li>
</ul>
</li>
</ul>
  
</div>


      <article>
        <div class="content">
          

          <div id="site-content-title">
            <div id="page-github-links" class="btn-group" aria-label="Page GitHub links" role="group">
  <a href="https://github.com/doggy8088/dart.tw/tree/master/src/_articles/archive/zones.md" class="btn no-automatic-external" title="View page source" target="_blank" rel="noopener">
    <i class="material-icons">description</i>
  </a>
  <a href="https://github.com/doggy8088/dart.tw/issues/new?template=1_page_issue.yml&amp;title=[PAGE ISSUE]: 'Zones'&amp;page-url=https://dart.tw.gh.miniasp.com/articles/archive/zones&amp;page-source=https://github.com/doggy8088/dart.tw/tree/master/src/_articles/archive/zones.md" class="btn no-automatic-external" title="Report an issue with this page" target="_blank" rel="noopener">
    <i class="material-icons">bug_report</i>
  </a>
</div>

            
            <h1 id="zones">Zones</h1>
            </div>
          







<div id="site-toc--inline" class="site-toc toc-collapsible toc-collapsed">
  <header class="site-toc__title">
    目錄
    
      <span class="site-toc--inline__toggle toc-toggle-down"><i class="material-icons">keyboard_arrow_down</i></span>
      <span class="site-toc--inline__toggle toc-toggle-up"><i class="material-icons">keyboard_arrow_up</i></span>
    
  </header>
  <ul id="toc" class="section-nav">
<li class="toc-entry toc-h3"><a href="#asynchronous-dynamic-extents">Asynchronous dynamic extents</a></li>
<li class="toc-entry toc-h2"><a href="#zone-basics">Zone basics</a></li>
<li class="toc-entry toc-h2"><a href="#handling-uncaught-errors">Handling uncaught errors</a>
<ul>
<li class="toc-entry toc-h3"><a href="#example-errors-cant-cross-into-error-zones">Example: Errors can’t cross into error zones</a></li>
<li class="toc-entry toc-h3"><a href="#example-errors-cant-leave-error-zones">Example: Errors can’t leave error zones</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#using-zones-with-streams">Using zones with streams</a>
<ul>
<li class="toc-entry toc-h3"><a href="#example-using-a-stream-with-runzonedguarded">Example: Using a stream with runZonedGuarded()</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#storing-zone-local-values">Storing zone-local values</a>
<ul>
<li class="toc-entry toc-h3"><a href="#example-using-a-zone-local-value-for-debug-logs">Example: Using a zone-local value for debug logs</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#overriding-functionality">Overriding functionality</a>
<ul>
<li class="toc-entry toc-h3"><a href="#example-overriding-print">Example: Overriding print</a></li>
<li class="toc-entry toc-h3"><a href="#arguments-to-interceptors-and-delegates">Arguments to interceptors and delegates</a></li>
<li class="toc-entry toc-h3"><a href="#example-delegating-to-the-parent-zone">Example: Delegating to the parent zone</a></li>
<li class="toc-entry toc-h3"><a href="#example-executing-code-when-entering-and-leaving-a-zone">Example: Executing code when entering and leaving a zone</a></li>
<li class="toc-entry toc-h3"><a href="#example-handling-callbacks">Example: Handling callbacks</a></li>
<li class="toc-entry toc-h3"><a href="#implementing-asynchronous-callbacks">Implementing asynchronous callbacks</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#summary">Summary</a>
<ul>
<li class="toc-entry toc-h3"><a href="#more-resources">More resources</a></li>
<li class="toc-entry toc-h3"><a href="#more-examples">More examples</a></li>
</ul>
</li>
</ul>
  
    <span class="site-toc--inline__toggle toc-toggle-more-items"><i class="material-icons">more_horiz</i></span>
  
</div>


          <style>
.zone1 {
  background-color: rgb(208, 211, 255);
}

.zone2 {
  background-color: rgb(195, 255, 231);
}

.zone3 {
  background-color: rgb(255, 240, 164);
}
</style>

<h3 id="asynchronous-dynamic-extents">
<a class="anchor" href="#asynchronous-dynamic-extents" aria-hidden="true"><span class="octicon octicon-link"></span></a>Asynchronous dynamic extents</h3>

<p>This article discusses zone-related APIs in the <a href="(https://api.dart.dev/stable/dart-async/dart-async-library.html)">dart:async</a> library,
with a focus on the top-level <a href="(https://api.dart.dev/stable/dart-async/runZoned.html)"><code class="language-plaintext highlighter-rouge">runZoned()</code></a>
and <a href="(https://api.dart.dev/stable/dart-async/runZonedGuarded.html)"><code class="language-plaintext highlighter-rouge">runZonedGuarded()</code></a> functions.
Review the techniques covered in
<a href="/guides/libraries/futures-error-handling">Futures and Error Handling</a>
before reading this article.</p>

<p>Zones make the following tasks possible:</p>

<ul>
  <li>
    <p><strong>Protecting your app from exiting due to
an uncaught exception</strong>.
For example,
a simple HTTP server
might use the following asynchronous code:</p>

    <pre class="prettyprint lang-dart"><code><span class="highlight">runZonedGuarded(() {</span>
  HttpServer.bind('0.0.0.0', port).then((server) {
    server.listen(staticFiles.serveRequest);
  });
<span class="highlight">},
(error, stackTrace) =&gt; print('Oh noes! $error $stackTrace'));</span></code></pre>

    <p>Running the HTTP server in a zone
enables the app to continue running despite uncaught (but non-fatal)
errors in the server’s asynchronous code.</p>
  </li>
  <li>
    <p><strong>Associating data</strong>—known as
<em>zone-local values</em>—<strong>with individual zones</strong>.</p>
  </li>
  <li>
    <p><strong>Overriding a limited set of methods</strong>,
such as <code class="language-plaintext highlighter-rouge">print()</code> and <code class="language-plaintext highlighter-rouge">scheduleMicrotask()</code>,
within part or all of the code.</p>
  </li>
  <li>
    <p><strong>Performing an operation each time that
code enters or exits a zone</strong>.
Such operations could include
starting or stopping a timer,
or saving a stack trace.</p>
  </li>
</ul>

<p>You might have encountered something similar to zones in other languages.
<em>Domains</em> in Node.js were an inspiration for Dart’s zones.
Java’s <em>thread-local storage</em>
also has some similarities.
Closest of all is Brian Ford’s JavaScript port of Dart zones,
<a href="https://github.com/btford/zone.js/">zone.js</a>, which he describes in
<a href="https://www.youtube.com/watch?v=3IqtmUscE_U">this video</a>.</p>

<h2 id="zone-basics">
<a class="anchor" href="#zone-basics" aria-hidden="true"><span class="octicon octicon-link"></span></a>Zone basics</h2>

<p>A <em>zone</em> represents the asynchronous dynamic extent of a call.
It is the computation that is performed as part of a call and, transitively,
the asynchronous callbacks that have been registered by that code.</p>

<p>For example,
in the HTTP server example,
<code class="language-plaintext highlighter-rouge">bind()</code>, <code class="language-plaintext highlighter-rouge">then()</code>, and the callback of <code class="language-plaintext highlighter-rouge">then()</code>
all execute in the same zone—the zone
that was created using <code class="language-plaintext highlighter-rouge">runZoned()</code>.</p>

<p>In the next example,
the code executes in 3 different zones:
<span class="zone1">zone #1</span> (the root zone),
<span class="zone2">zone #2</span>, and
<span class="zone3">zone #3</span>.</p>

<!-- ex1.dart -->
<!-- Using pre instead of prettify so we can use background colors -->
<pre>import 'dart:async';

<span class="zone1">main() {
  foo();
  var future;
  runZoned(() {</span>          // Starts a new child zone (zone #2).
<span class="zone2">    future = new Future(bar).then(baz);
  </span><span class="zone1">});
  future.then(qux);
}</span>

foo() =&gt; <em><span class="zone1">...foo</span><span class="zone3">-body...</span></em>  // Executed twice (once each in two zones).
bar() =&gt; <em><span class="zone2">...bar-body...</span></em>
baz(x) =&gt; <span class="zone2">runZoned(() =&gt;</span> <span class="zone3">foo()</span><span class="zone2">);</span> // New child zone (zone #3).
qux(x) =&gt; <em><span class="zone1">...qux-body...</span></em>
</pre>

<p>The following figure shows the code’s execution order,
as well as which zone the code executes in.</p>

<p><img src="images/trace.png" alt="illustration of program execution"></p>

<p>Each call to <code class="language-plaintext highlighter-rouge">runZoned()</code> creates a new zone
and executes code in that zone.
When that code schedules a task—such
as calling baz()—that
task executes in the zone where it was scheduled.
For example, the call to qux() (last line of main())
runs in
<span class="zone1">zone #1</span> (the root zone)
even though it’s attached to a future that itself runs in
<span class="zone2">zone #2</span>.</p>

<p>Child zones don’t completely replace their parent zone.
Instead new zones are nested inside their surrounding zone.
For example,
<span class="zone2">zone #2</span> contains
<span class="zone3">zone #3</span>, and
<span class="zone1">zone #1</span> (the root zone)
contains both
<span class="zone2">zone #2</span> and
<span class="zone3">zone #3</span>.</p>

<p>All Dart code executes in the root zone.
Code might execute in other nested child zones as well,
but at a minimum it always runs in the root zone.</p>

<h2 id="handling-uncaught-errors">
<a class="anchor" href="#handling-uncaught-errors" aria-hidden="true"><span class="octicon octicon-link"></span></a>Handling uncaught errors</h2>

<p>Zones are able to catch and handle uncaught errors.</p>

<p><em>Uncaught errors</em> often occur because of code using <code class="language-plaintext highlighter-rouge">throw</code>
to raise an exception without an accompanying <code class="language-plaintext highlighter-rouge">catch</code>
statement to handle it.
Uncaught errors can also arise in <code class="language-plaintext highlighter-rouge">async</code> functions
when a Future completes with an error result,
but is missing a corresponding <code class="language-plaintext highlighter-rouge">await</code> to handle the error.</p>

<p>An uncaught error reports to the current zone that failed to catch it.
By default, zones will crash the program in response to uncaught errors.
You can install your own custom <em>uncaught error handler</em> to a new zone
to intercept and handle uncaught errors however you prefer.</p>

<p>To introduce a new zone with an uncaught error handler,
use the <code class="language-plaintext highlighter-rouge">runZoneGuarded</code> method. Its <code class="language-plaintext highlighter-rouge">onError</code> callback becomes the
uncaught error handler of a new zone. This callback handles any
synchronous errors that the call throws.</p>

<!-- run_zoned1.dart -->
<pre class="prettyprint lang-dart"><code>runZonedGuarded(() {
  Timer.run(() { throw 'Would normally kill the program'; });
}, (error, stackTrace) {
  print('Uncaught error: $error');
});</code></pre>

<p><em>Other zone APIs that facilitate uncaught error handling include
<a href="(https://api.dart.dev/stabledart-async/Zone/fork.html)"><code class="language-plaintext highlighter-rouge">Zone.fork</code></a>, <a href="(https://api.dart.dev/stabledart-async/Zone/runGuarded.html)"><code class="language-plaintext highlighter-rouge">Zone.runGuarded</code></a>
and <a href="(https://api.dart.dev/stabledart-async/ZoneSpecification/handleUncaughtError.html)"><code class="language-plaintext highlighter-rouge">ZoneSpecification.uncaughtErrorHandler</code></a>.</em></p>

<p>The preceding code has an asynchronous callback
(through <code class="language-plaintext highlighter-rouge">Timer.run()</code>) that throws an exception.
Normally this exception would be an unhandled error and reach the top level
(which, in the standalone Dart executable, would kill the running process).
However, with the zoned error handler,
the error is passed to the error handler and doesn’t shut down the program.</p>

<p>One notable difference between try-catch and zoned error handlers is
that zones continue to execute after uncaught errors occur.
If other asynchronous callbacks are scheduled within the zone,
they still execute.
As a consequence a zoned error handler might
be invoked multiple times.</p>

<p>Any zone with an uncaught error handler is called an <em>error zone</em>.
An error zone might handle errors that originate
in a descendant of that zone.
A simple rule determines where
errors are handled in a sequence of future transformations
(using <code class="language-plaintext highlighter-rouge">then()</code> or <code class="language-plaintext highlighter-rouge">catchError()</code>):
Errors on Future chains never cross the boundaries of error zones.</p>

<p>If an error reaches an error zone boundary,
it is treated as unhandled error at that point.</p>

<aside class="alert alert-info" role="alert">
  <p><i class="material-icons" aria-hidden="true">info</i>
  <strong>API note:</strong>
  Handling uncaught errors doesn’t <em>require</em> zones.
  The isolate API <a href="https://api.dart.dev/dev/dart-isolate/Isolate/run.html"><code class="language-plaintext highlighter-rouge">Isolate.run()</code></a> also handles 
  listening for uncaught errors.</p>
</aside>

<h3 id="example-errors-cant-cross-into-error-zones">
<a class="anchor" href="#example-errors-cant-cross-into-error-zones" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example: Errors can’t cross into error zones</h3>

<p>In the following example,
the error raised by the first line
can’t cross into an error zone.</p>

<!-- run_zoned2.dart -->
<pre class="prettyprint lang-dart"><code>var f = new Future.error(499);
f = f.whenComplete(() { print('Outside of zones'); });
runZoned(() {
  f = f.whenComplete(() { print('Inside non-error zone'); });
});
runZonedGuarded(() {
  f = f.whenComplete(() { print('Inside error zone (not called)'); });
}, (error) { print(error); });</code></pre>

<p>Here’s the output you see if you run the example:</p>

<pre class="prettyprint lang-xml"><code>Outside of zones
Inside non-error zone
Uncaught Error: 499
Unhandled exception:
499
...stack trace...</code></pre>

<p>If you remove the call to <code class="language-plaintext highlighter-rouge">runZoned()</code> or
to <code class="language-plaintext highlighter-rouge">runZonedGuarded()</code>,
you see this output:</p>

<pre class="prettyprint lang-xml"><code>Outside of zones
Inside non-error zone
<span class="highlight">Inside error zone (not called)</span>
Uncaught Error: 499
Unhandled exception:
499
...stack trace...</code></pre>

<p>Note how removing either the zone or error zone causes
the error to propagate further.</p>

<p>The stack trace appears because the error happens outside an error zone.
If you add an error zone around the whole code snippet,
then you can avoid the stack trace.</p>

<h3 id="example-errors-cant-leave-error-zones">
<a class="anchor" href="#example-errors-cant-leave-error-zones" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example: Errors can’t leave error zones</h3>

<p>As the preceding code shows,
errors can’t cross into error zones.
Similarly, errors can’t cross <em>out</em> of error zones.
Consider this example:</p>

<!-- run_zoned3.dart -->
<pre class="prettyprint lang-dart"><code>var completer = new Completer();
var future = completer.future.then((x) =&gt; x + 1);
var zoneFuture;
runZonedGuarded(() {
  zoneFuture = future.then((y) =&gt; throw 'Inside zone');
}, (error) { print('Caught: $error'); });

zoneFuture.catchError((e) { print('Never reached'); });
completer.complete(499);</code></pre>

<p>Even though the future chain ends in a <code class="language-plaintext highlighter-rouge">catchError()</code>,
the asynchronous error can’t leave the error zone.
The zoned error handler found in <code class="language-plaintext highlighter-rouge">runZonedGuarded()</code>
handles the error.
As a result, <em>zoneFuture never completes</em> — neither
with a value, nor with an error.</p>

<h2 id="using-zones-with-streams">
<a class="anchor" href="#using-zones-with-streams" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using zones with streams</h2>

<p>The rule for zones and streams
is simpler than for futures:</p>

<aside class="alert alert-info" role="alert">
  <p><i class="material-icons" aria-hidden="true">info</i> <strong>備註:</strong>
  Transformations and other callbacks execute in the zone
  where the stream is listened to.</p>
</aside>

<p>This rule follows from the guideline that
streams should have no side effect until listened to.
A similar situation in synchronous code is the behavior of Iterables,
which aren’t evaluated until you ask for values.</p>

<h3 id="example-using-a-stream-with-runzonedguarded">
<a class="anchor" href="#example-using-a-stream-with-runzonedguarded" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example: Using a stream with <code class="language-plaintext highlighter-rouge">runZonedGuarded()</code>
</h3>

<p>The following example sets up a stream with a callback,
and then executes that stream in a new zone with <code class="language-plaintext highlighter-rouge">runZonedGuarded()</code>:</p>

<!-- stream.dart -->
<pre class="prettyprint lang-dart"><code>var stream = new File('stream.dart').openRead()
    .map((x) =&gt; throw 'Callback throws');

runZonedGuarded(() { stream.listen(print); },
         (e) { print('Caught error: $e'); });</code></pre>

<p>The error handler in <code class="language-plaintext highlighter-rouge">runZonedGuarded()</code>
catches the error the callback throws.
Here’s the output:</p>

<pre class="prettyprint lang-xml"><code>Caught error: Callback throws</code></pre>

<p>As the output shows,
the callback is associated with the listening zone,
not with the zone where <code class="language-plaintext highlighter-rouge">map()</code> is called.</p>

<h2 id="storing-zone-local-values">
<a class="anchor" href="#storing-zone-local-values" aria-hidden="true"><span class="octicon octicon-link"></span></a>Storing zone-local values</h2>

<p>If you ever wanted to use a static variable
but couldn’t because
multiple concurrently running computations interfered with each other,
consider using a zone-local value.
You might add a zone-local value to help with debugging.
Another use case is dealing with an HTTP request:
you could have the user ID
and its authorization token in zone-local values.</p>

<p>Use the <code class="language-plaintext highlighter-rouge">zoneValues</code> argument to <code class="language-plaintext highlighter-rouge">runZoned()</code> to
store values in the newly created zone:</p>

<!-- value1.dart -->
<pre class="prettyprint lang-dart"><code>runZoned(() {
  print(Zone.current[#key]);
}, zoneValues: { #key: 499 });</code></pre>

<p>To read zone-local values, use the zone’s index operator and the value’s key:
<code>[<em>key</em>]</code>.
Any object can be used as a key, as long as it has compatible
<code class="language-plaintext highlighter-rouge">operator ==</code> and <code class="language-plaintext highlighter-rouge">hashCode</code> implementations.
Typically, a key is a symbol literal:
<code>#<em>identifier</em></code>.</p>

<p>You can’t change the object that a key maps to,
but you can manipulate the object.
For example, the following code
adds an item to a zone-local list:</p>

<!-- value1_1.dart -->
<pre class="prettyprint lang-dart"><code>runZoned(() {
  Zone.current[#key].add(499);
  print(Zone.current[#key]); // [499]
}, zoneValues: { #key: [] });</code></pre>

<p>A zone inherits zone-local values from its parent zone,
so adding nested zones doesn’t accidentally drop existing values.
Nested zones can, however, shadow parent values.</p>

<aside class="alert alert-warning" role="alert">
  <p><i class="material-icons" aria-hidden="true">error</i> <strong>重要說明:</strong>
  Try to use unique objects for keys,
  so they’re less likely to conflict with other libraries.</p>
</aside>

<h3 id="example-using-a-zone-local-value-for-debug-logs">
<a class="anchor" href="#example-using-a-zone-local-value-for-debug-logs" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example: Using a zone-local value for debug logs</h3>

<p>Say you have two files, foo.txt and bar.txt,
and want to print all of their lines.
The program might look like this:</p>

<!-- value2.dart -->
<pre class="prettyprint lang-dart"><code>import 'dart:async';
import 'dart:convert';
import 'dart:io';

Future splitLinesStream(stream) {
  return stream
      .transform(ASCII.decoder)
      .transform(const LineSplitter())
      .toList();
}

Future splitLines(filename) {
  return splitLinesStream(new File(filename).openRead());
}
main() {
  Future.forEach(['foo.txt', 'bar.txt'],
                 (file) =&gt; splitLines(file)
                     .then((lines) { lines.forEach(print); }));
}</code></pre>

<p>This program works,
but let’s assume that you now want to know
which file each line comes from,
and that you can’t just add a filename argument to <code class="language-plaintext highlighter-rouge">splitLinesStream()</code>.
With zone-local values you can add the filename to the returned string
(new lines are highlighted):</p>

<!-- value3.dart -->
<pre class="prettyprint lang-dart"><code>import 'dart:async';
import 'dart:convert';
import 'dart:io';

Future splitLinesStream(stream) {
  return stream
      .transform(ASCII.decoder)
      .transform(const LineSplitter())
<span class="highlight">      .map((line) =&gt; '${Zone.current[#filename]}: $line')</span>
      .toList();
}

Future splitLines(filename) {
<span class="highlight">  return runZoned(() {</span>
    return splitLinesStream(new File(filename).openRead());
<span class="highlight">  }, zoneValues: { #filename: filename });</span>
}

main() {
  Future.forEach(['foo.txt', 'bar.txt'],
                 (file) =&gt; splitLines(file)
                     .then((lines) { lines.forEach(print); }));
}</code></pre>

<p>Note that the new code doesn’t modify the function signatures or
pass the filename from <code class="language-plaintext highlighter-rouge">splitLines()</code> to <code class="language-plaintext highlighter-rouge">splitLinesStream()</code>.
Instead, it uses zone-local values to implement
a feature similar to a static variable
that works in asynchronous contexts.</p>

<h2 id="overriding-functionality">
<a class="anchor" href="#overriding-functionality" aria-hidden="true"><span class="octicon octicon-link"></span></a>Overriding functionality</h2>

<p>Use the <code class="language-plaintext highlighter-rouge">zoneSpecification</code> argument to <code class="language-plaintext highlighter-rouge">runZoned()</code>
to override functionality that is managed by zones.
The argument’s value is a
<a href="https://api.dart.dev/stable/dart-async/ZoneSpecification-class.html">ZoneSpecification</a> object,
with which you can override any of the following functionality:</p>

<ul>
  <li>Forking child zones</li>
  <li>Registering and running callbacks in the zone</li>
  <li>Scheduling microtasks and timers</li>
  <li>Handling uncaught asynchronous errors
(<code class="language-plaintext highlighter-rouge">runZonedGuarded()</code> is a shortcut for this)</li>
  <li>Printing</li>
</ul>

<h3 id="example-overriding-print">
<a class="anchor" href="#example-overriding-print" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example: Overriding print</h3>

<p>As a simple example of overriding functionality,
here is a way to silence all prints inside a zone:</p>

<!-- specification1.dart -->
<pre class="prettyprint lang-dart"><code>import 'dart:async';

main() {
  runZoned(() {
    print('Will be ignored');
  }, zoneSpecification: new ZoneSpecification(
    print: (self, parent, zone, message) {
      // Ignore message.
    }));
}</code></pre>

<p>Inside the forked zone,
the <code class="language-plaintext highlighter-rouge">print()</code> function is overridden by the specified print interceptor,
which simply discards the message.
Overriding print is possible because <code class="language-plaintext highlighter-rouge">print()</code>
(like <code class="language-plaintext highlighter-rouge">scheduleMicrotask()</code> and the Timer constructors)
uses the current zone (<code class="language-plaintext highlighter-rouge">Zone.current</code>) to do its work.</p>

<h3 id="arguments-to-interceptors-and-delegates">
<a class="anchor" href="#arguments-to-interceptors-and-delegates" aria-hidden="true"><span class="octicon octicon-link"></span></a>Arguments to interceptors and delegates</h3>

<p>As the print example shows,
an interceptor adds three arguments
to those defined in the Zone class’s corresponding method.
For example, Zone’s <code class="language-plaintext highlighter-rouge">print()</code> method has one argument:
<code class="language-plaintext highlighter-rouge">print(String line)</code>.
The interceptor version of <code class="language-plaintext highlighter-rouge">print()</code>,
as defined by ZoneSpecification,
has four arguments:
<code class="language-plaintext highlighter-rouge">print(Zone self, ZoneDelegate parent, Zone zone, String line)</code>.</p>

<p>The three interceptor arguments always appear in the same order,
before any other arguments.</p>

<dl>
  <dt><code class="language-plaintext highlighter-rouge">self</code></dt>
  <dd>The zone that’s handling the callback.</dd>
  <dt><code class="language-plaintext highlighter-rouge">parent</code></dt>
  <dd>A ZoneDelegate representing the parent zone.
Use it to forward operations to the parent.</dd>
  <dt><code class="language-plaintext highlighter-rouge">zone</code></dt>
  <dd>The zone where the operation originated.
Some operations need to know which zone the operation was invoked on.
For example, <code class="language-plaintext highlighter-rouge">zone.fork(specification)</code> must
create a new zone as child of <code class="language-plaintext highlighter-rouge">zone</code>.
As another example,
even when you delegate <code class="language-plaintext highlighter-rouge">scheduleMicrotask()</code> to another zone,
the original <code class="language-plaintext highlighter-rouge">zone</code> must be the one that executes the microtask.</dd>
</dl>

<p>When an interceptor delegates a method to the parent,
the parent (ZoneDelegate) version of the method
has just one additional argument:
<code class="language-plaintext highlighter-rouge">zone</code>, the zone where the original call originated from.
For example,
the signature of the <code class="language-plaintext highlighter-rouge">print()</code> method on a ZoneDelegate is
<code class="language-plaintext highlighter-rouge">print(Zone zone, String line)</code>.</p>

<p>Here’s an example of the arguments
for another interceptable method, <code class="language-plaintext highlighter-rouge">scheduleMicrotask()</code>:</p>

<table>
  <tbody>
    <tr>
      <td><strong>Where defined</strong></td>
      <td><strong>Method signature</strong></td>
    </tr>
    <tr>
      <td>Zone</td>
      <td><code class="language-plaintext highlighter-rouge">void scheduleMicrotask(void f())</code></td>
    </tr>
    <tr>
      <td>ZoneSpecification&nbsp;</td>
      <td><code class="language-plaintext highlighter-rouge">void scheduleMicrotask(Zone self, ZoneDelegate parent, Zone zone, void f())</code></td>
    </tr>
    <tr>
      <td>ZoneDelegate</td>
      <td><code class="language-plaintext highlighter-rouge">void scheduleMicrotask(Zone zone, void f())</code></td>
    </tr>
  </tbody>
</table>

<h3 id="example-delegating-to-the-parent-zone">
<a class="anchor" href="#example-delegating-to-the-parent-zone" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example: Delegating to the parent zone</h3>

<p>Here is an example that shows how to delegate to the parent zone:</p>

<!-- specification2.dart -->
<pre class="prettyprint lang-dart"><code>import 'dart:async';

main() {
  runZoned(() {
    var currentZone = Zone.current;
    scheduleMicrotask(() {
      print(identical(currentZone, Zone.current));  // prints true.
    });
  }, zoneSpecification: new ZoneSpecification(
    scheduleMicrotask: (self, parent, zone, task) {
      print('scheduleMicrotask has been called inside the zone');
      // The origin `zone` needs to be passed to the parent so that
      // the task can be executed in it.
      parent.scheduleMicrotask(zone, task);
    }));
}</code></pre>

<h3 id="example-executing-code-when-entering-and-leaving-a-zone">
<a class="anchor" href="#example-executing-code-when-entering-and-leaving-a-zone" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example: Executing code when entering and leaving a zone</h3>

<p>Say you want to know how much time some asynchronous code
spends executing.
You can do this by putting the code in a zone,
starting a timer every time the zone is entered,
and stopping the timer whenever the zone is left.</p>

<p>Providing <code class="language-plaintext highlighter-rouge">run*</code> parameters to the ZoneSpecification
lets you specify the code that the zone executes.</p>

<aside class="alert alert-info" role="alert">
  <p><i class="material-icons" aria-hidden="true">info</i>
  <strong>API note:</strong>
  In the future, zones might provide a simpler alternative
  for the common case of sandwiching zone code:
  an onEnter/onLeave API.
  See <a href="https://github.com/dart-lang/sdk/issues/17532">issue 17532</a>
  for details.</p>
</aside>

<p>The <code class="language-plaintext highlighter-rouge">run*</code> parameters—<code class="language-plaintext highlighter-rouge">run</code>, <code class="language-plaintext highlighter-rouge">runUnary</code>, and <code class="language-plaintext highlighter-rouge">runBinary</code>—specify
code to execute every time the zone is asked to execute code.
These parameters work for zero-argument, one-argument,
and two-argument callbacks, respectively.
The <code class="language-plaintext highlighter-rouge">run</code> parameter also works for the initial, synchronous code
that executes just after calling <code class="language-plaintext highlighter-rouge">runZoned()</code>.</p>

<p>Here’s an example of profiling code using <code class="language-plaintext highlighter-rouge">run*</code>:</p>

<!-- profile_run.dart -->
<pre class="prettyprint lang-dart"><code>final total = new Stopwatch();
final user = new Stopwatch();

final specification = new ZoneSpecification(
  run: (self, parent, zone, f) {
    user.start();
    try { return parent.run(zone, f); } finally { user.stop(); }
  },
  runUnary: (self, parent, zone, f, arg) {
    user.start();
    try { return parent.runUnary(zone, f, arg); } finally { user.stop(); }
  },
  runBinary: (self, parent, zone, f, arg1, arg2) {
    user.start();
    try {
      return parent.runBinary(zone, f, arg1, arg2);
    } finally {
      user.stop();
    }
  });

runZoned(() {
  total.start();
  // ... Code that runs synchronously...
  // ... Then code that runs asynchronously ...
    .then((...) {
      print(total.elapsedMilliseconds);
      print(user.elapsedMilliseconds);
    });
}, zoneSpecification: specification);</code></pre>

<p>In this code,
each <code class="language-plaintext highlighter-rouge">run*</code> override just starts the user timer,
executes the specified function,
and then stops the user timer.</p>

<h3 id="example-handling-callbacks">
<a class="anchor" href="#example-handling-callbacks" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example: Handling callbacks</h3>

<p>Provide <code class="language-plaintext highlighter-rouge">register*Callback</code> parameters to the ZoneSpecification
to wrap or change callback code—the code
that’s executed asynchronously in the zone.
Like the <code class="language-plaintext highlighter-rouge">run*</code> parameters,
the <code class="language-plaintext highlighter-rouge">register*Callback</code> parameters have three forms:
<code class="language-plaintext highlighter-rouge">registerCallback</code> (for callbacks with no arguments),
<code class="language-plaintext highlighter-rouge">registerUnaryCallback</code> (one argument), and
<code class="language-plaintext highlighter-rouge">registerBinaryCallback</code> (two arguments).</p>

<p>Here’s an example that makes the zone
save a stack trace
before the code disappears into an asynchronous context.</p>

<!-- debug.dart -->
<pre class="prettyprint lang-dart"><code>import 'dart:async';

get currentStackTrace {
  try {
    throw 0;
  } catch(_, st) {
    return st;
  }
}

var lastStackTrace = null;

bar() =&gt; throw "in bar";
foo() =&gt; new Future(bar);

main() {
  final specification = new ZoneSpecification(
    registerCallback: (self, parent, zone, f) {
      var stackTrace = currentStackTrace;
      return parent.registerCallback(zone, () {
        lastStackTrace = stackTrace;
        return f();
      });
    },
    registerUnaryCallback: (self, parent, zone, f) {
      var stackTrace = currentStackTrace;
      return parent.registerUnaryCallback(zone, (arg) {
        lastStackTrace = stackTrace;
        return f(arg);
      });
    },
    registerBinaryCallback: (self, parent, zone, f) {
      var stackTrace = currentStackTrace;
      return parent.registerBinaryCallback(zone, (arg1, arg2) {
        lastStackTrace = stackTrace;
        return f(arg1, arg2);
      });
    },
    handleUncaughtError: (self, parent, zone, error, stackTrace) {
      if (lastStackTrace != null) print("last stack: $lastStackTrace");
      return parent.handleUncaughtError(zone, error, stackTrace);
    });

  runZoned(() {
    foo();
  }, zoneSpecification: specification);
}</code></pre>

<p>Go ahead and run the example.
You’ll see a “last stack” trace (<code class="language-plaintext highlighter-rouge">lastStackTrace</code>)
that includes <code class="language-plaintext highlighter-rouge">foo()</code>,
since <code class="language-plaintext highlighter-rouge">foo()</code> was called synchronously.
The next stack trace (<code class="language-plaintext highlighter-rouge">stackTrace</code>)
is from the asynchronous context,
which knows about <code class="language-plaintext highlighter-rouge">bar()</code> but not <code class="language-plaintext highlighter-rouge">foo()</code>.</p>

<h3 id="implementing-asynchronous-callbacks">
<a class="anchor" href="#implementing-asynchronous-callbacks" aria-hidden="true"><span class="octicon octicon-link"></span></a>Implementing asynchronous callbacks</h3>

<p>Even if you’re implementing an asynchronous API,
you might not have to deal with zones at all.
For example, although you might expect the dart:io library
to keep track of the current zones,
it instead relies on the zone handling of dart:async classes
such as Future and Stream.</p>

<p>If you do handle zones explicitly,
then you need to register all asynchronous callbacks
and ensure that each callback is invoked in the zone
where it was registered.
The <code class="language-plaintext highlighter-rouge">bind*Callback</code> helper methods of Zone
make this task easier.
They’re shortcuts for <code class="language-plaintext highlighter-rouge">register*Callback</code> and <code class="language-plaintext highlighter-rouge">run*</code>,
ensuring that each callback is registered and runs in that Zone.</p>

<p>If you need more control than <code class="language-plaintext highlighter-rouge">bind*Callback</code> gives you,
then you need to use <code class="language-plaintext highlighter-rouge">register*Callback</code> and <code class="language-plaintext highlighter-rouge">run*</code>.
You might also want to use the <code class="language-plaintext highlighter-rouge">run*Guarded</code> methods of Zone,
which wrap the call into a try-catch
and invoke the <code class="language-plaintext highlighter-rouge">uncaughtErrorHandler</code>
if an error occurs.</p>

<h2 id="summary">
<a class="anchor" href="#summary" aria-hidden="true"><span class="octicon octicon-link"></span></a>Summary</h2>

<p>Zones are good for protecting your code from
uncaught exceptions in asynchronous code,
but they can do much more.
You can associate data with zones,
and you can override core functionality such as
printing and task scheduling.
Zones enable better debugging and provide hooks
that you can use for functionality such as profiling.</p>

<h3 id="more-resources">
<a class="anchor" href="#more-resources" aria-hidden="true"><span class="octicon octicon-link"></span></a>More resources</h3>

<dl>
  <dt>Zone-related API documentation</dt>
  <dd>Read the docs for
<a href="https://api.dart.dev/stable/dart-async/runZoned.html">runZoned()</a>,
<a href="https://api.dart.dev/stable/dart-async/runZonedGuarded.html">runZonedGuarded()</a>,
<a href="https://api.dart.dev/stable/dart-async/Zone-class.html">Zone</a>,
<a href="https://api.dart.dev/stable/dart-async/ZoneDelegate-class.html">ZoneDelegate</a>, and
<a href="https://api.dart.dev/stable/dart-async/ZoneSpecification-class.html">ZoneSpecification</a>.</dd>
  <dt>stack_trace</dt>
  <dd>With the stack_trace library’s
<a href="https://pub.dev/documentation/stack_trace/latest/stack_trace/Chain-class.html">Chain class</a>
you can get better stack traces for asynchronously executed code.
See the <a href="https://pub.dev/packages/stack_trace">stack_trace package</a>
at the pub.dev site for more information.</dd>
</dl>

<h3 id="more-examples">
<a class="anchor" href="#more-examples" aria-hidden="true"><span class="octicon octicon-link"></span></a>More examples</h3>

<p>Here are some more complex examples of using zones.</p>

<dl>
  <dt>The task_interceptor example</dt>
  <dd>The toy zone in
<a href="https://github.com/dart-archive/www.dartlang.org/blob/master/src/tests/site/articles/zones/task_interceptor.dart">task_interceptor.dart</a>
intercepts <code class="language-plaintext highlighter-rouge">scheduleMicrotask</code>, <code class="language-plaintext highlighter-rouge">createTimer</code>, and <code class="language-plaintext highlighter-rouge">createPeriodicTimer</code>
to simulate the behavior of the Dart primitives
without yielding to the event loop.</dd>
  <dt>The source code for the stack_trace package</dt>
  <dd>The <a href="https://pub.dev/packages/stack_trace">stack_trace package</a>
uses zones to form chains of stack traces
for debugging asynchronous code.
Zone features used include error handling, zone-local values, and callbacks.
You can find the stack_trace source code in the
<a href="https://github.com/dart-lang/stack_trace">stack_trace GitHub project</a>.</dd>
  <dt>The source code for dart:html and dart:async</dt>
  <dd>These two SDK libraries implement APIs featuring asynchronous callbacks,
and thus they deal with zones.
You can browse or download their source code under the
<a href="https://github.com/dart-lang/sdk/tree/main/sdk/lib">sdk/lib directory</a>
of the
<a href="https://github.com/dart-lang/sdk">Dart GitHub project</a>.</dd>
</dl>

<p><em>Thanks to Anders Johnsen and Lasse Reichstein Nielsen
for their reviews of this article.</em></p>

          

        </div>
      </article>
    </main>
    <footer id="page-footer">
    <div class="footer-section footer-main">
      <a href="/" class="brand" title="Dart">
        <img src="/assets/img/shared/dart/logo+text/horizontal/white.svg" alt="Dart" width="164px">
      </a>
      <div class="footer-social-links">
        <a href="https://github.com/doggy8088/dart.tw" target="_blank" rel="noopener" title="GitHub" class="no-automatic-external">
          <svg>
            <use href="/assets/img/social/github.svg#github"></use>
          </svg>
        </a>
      </div>
    </div>
    <div class="footer-section footer-tray">
      <div class="footer-licenses">
        參考中文內容需註明本站及連結作為出處，英文內容和範例程式碼均遵從源站授權協議。
      </div>
      <div class="footer-utility-links">
        <ul>
          <li><a href="/terms" title="使用條款">使用條款</a></li>
          <li><a href="https://policies.google.com/privacy?hl=zh-TW" target="_blank" rel="noopener" title="隱私政策" class="no-automatic-external">隱私政策</a></li>
          <li><a href="/security" title="Security philosophy and practices">Dart 程式碼安全說明</a></li>
          <li><a href="https://flutter.tw/about" target="_blank">關於中文文件</a>
          </li><li><a href="https://flutter.tw/disclaimer" target="_blank">免責條款</a>
          </li><li><a href="https://dart.cn/" target="_blank">Dart 簡體中文文檔</a>
        </li></ul>
      </div>
    </div>
  </footer>

  

<script src="/assets/translator/js/translator.js"></script></body></html>