<!DOCTYPE html><html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Language" content="zh-cmn-Hans">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Google Tag Manager -->
<!--  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':-->
<!--  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],-->
<!--  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=-->
<!--  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);-->
<!--  })(window,document,'script','dataLayer','GTM-5VSZM5J');</script>-->
  <!-- End Google Tag Manager -->

  <meta name="description" content="To use Objective-C and Swift code in your Dart program, use package:ffigen.">
  <title>Objective-C and Swift interop using package:ffigen | Dart</title>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-28P0PYCRZ9"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-28P0PYCRZ9');
  </script>

  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?fa71f2474b82505e00203cf9956cf0bc";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>

  <!-- Favicon / Touch Icons -->
  <link rel="icon" sizes="64x64" href="/assets/shared/dart/icon/64.png">
  <link href="/assets/img/touch-icon-iphone.png" rel="apple-touch-icon">
  <link href="/assets/img/touch-icon-ipad.png" rel="apple-touch-icon" sizes="152x152">
  <link href="/assets/img/touch-icon-iphone-retina.png" rel="apple-touch-icon" sizes="180x180">
  <link href="/assets/img/touch-icon-ipad-retina.png" rel="apple-touch-icon" sizes="167x167">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@dart_lang">
  <meta name="twitter:title" content="Objective-C and Swift interop using package:ffigen">
  <meta name="twitter:description" content="To use Objective-C and Swift code in your Dart program, use package:ffigen.">

  <!-- Open Graph -->
  <meta property="og:title" content="Objective-C and Swift interop using package:ffigen">
  <meta property="og:description" content="To use Objective-C and Swift code in your Dart program, use package:ffigen.">
  <meta property="og:url" content="https://dart.tw.gh.miniasp.com/guides/libraries/objective-c-interop">

  <meta property="og:image" content="https://dart.tw.gh.miniasp.com/assets/shared/dart-logo-for-shares.png?2">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
  <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&amp;display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Google+Sans+Display:wght@400&amp;display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Google+Sans+Mono:wght@400;500;700&amp;display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&amp;display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons&amp;display=swap" rel="stylesheet">
  <script src="https://cdn.staticfile.org/font-awesome/5.15.4/js/all.js" data-auto-replace-svg="nest">
  </script>

  <link rel="stylesheet" href="/assets/css/main.css?v=1693674404">
  <script src="https://cdn.staticfile.org/jquery/3.7.0/jquery.min.js" integrity="sha512-3gJwYpMe3QewGELv8k/BX9vcqhryRdzRMxVfq6ngyWXwo03GFEzjsUm8Q7RZcHPHksttq7/GFoxjCVUjkjvPdw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdn.staticfile.org/popper.js/1.16.1/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdn.staticfile.org/bootstrap/4.6.2/js/bootstrap.min.js" integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <!-- <script src="https://cdn.staticfile.org/js-cookie/3.0.5/js.cookie.min.js"
          integrity="sha512-nlp9/l96/EpjYBx7EP7pGASVXNe80hGhYAUrjeXnu/fyF5Py0/RXav4BBNs7n5Hx1WFhOEOWSAVjGeC3oKxDVQ=="
          crossorigin="anonymous"
          referrerpolicy="no-referrer"></script> -->

  <script src="/assets/js/vendor/code-prettify/prettify.js"></script>
  <script src="/assets/js/vendor/code-prettify/lang-dart.js"></script>
  <script src="/assets/js/vendor/code-prettify/lang-yaml.js"></script>
  <script src="/assets/js/os-tabs.js?v=1693674404"></script>
  <script src="/assets/js/utilities.js?v=1693674404"></script>
  <script src="/assets/js/main.js?v=1693674404"></script>

  <script>

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-122680122-5', 'auto');
ga('send', 'pageview');

</script>


 <link href="/assets/translator/css/translator.css" rel="stylesheet"></head>

  <body class="default show_banner">
    <section id="cookie-notice">
  <div class="container">
    <p>Google uses cookies to deliver its services, to personalize ads, and to 
      analyze traffic. You can adjust your privacy controls anytime in your 
      <a href="https://myaccount.google.com/data-and-personalization" target="_blank" rel="noopener" class="no-automatic-external">Google settings</a>. 
      <a href="https://policies.google.com/technologies/cookies" target="_blank" rel="noopener" class="no-automatic-external">Learn more</a>.
    </p>
    <button id="cookie-consent" class="btn btn-primary">Okay</button>
  </div>
</section>

    <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=G-28P0PYCRZ9"
 height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

    <header id="page-header" class="site-header">
  <nav id="mainnav" class="site-header">
  <div id="menu-toggle"><i class="material-icons">menu</i></div>
  <a href="/" class="brand" title="Dart">
    <img src="/assets/img/shared/dart/logo+text/horizontal/white.svg" alt="Dart">
  </a>
  <ul class="navbar">
    <li>
      <a href="/overview" class="nav-link">概覽</a>
    </li>
    <li class="mainnav__get-started">
      <a href="/guides" class="nav-link
         active">
        <span>文件</span>
      </a>
    </li>
    <li>
      <a href="/community" class="nav-link">社群</a>
    </li>
    <li>
      <a href="/#try-dart" class="nav-link">嘗試 Dart</a>
    </li>
    <li>
      <a href="/get-dart" class="nav-link">獲取 Dart SDK</a>
    </li>
    <li class="searchfield">
      <form action="/search" class="site-header__search form-inline" id="cse-search-box">
        <input type="hidden" name="cx" value="011220921317074318178:_yy-tmb5t_i">
        <input type="hidden" name="ie" value="UTF-8">
        <input type="hidden" name="hl" value="en">
        <input class="site-header__searchfield form-control search-field" type="search" name="q" id="q" autocomplete="off" placeholder="Search" aria-label="Search">
      </form>
    </li>
  </ul>
</nav>

  
</header>
 <div class="banner">
  <p class="banner__text">
    Dart 3 已釋出！帶來了全新的
    <a href="https://dart.tw.gh.miniasp.com/language/records" class="no-automatic-external">記錄型別 (records)</a>、
    <a href="https://dart.tw.gh.miniasp.com/language/patterns" class="no-automatic-external">模式匹配 (patterns)</a>
    以及 <a href="https://dart.tw.gh.miniasp.com/language/class-modifiers" class="no-automatic-external">型別修飾符 (class modifiers)</a>。
    <br>
    <!--<a href="https://medium.com/p/53f065a10635" class="no-automatic-external">Check out the blog post</a>!-->
  </p>
</div>
 

    <div id="sidenav" class="">
  <form action="/search/" class="site-header__search form-inline">
    <input class="site-header__searchfield form-control search-field" type="search" name="q" id="q" autocomplete="off" placeholder="Search" aria-label="Search">
  </form>

  <div class="site-sidebar">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a href="/overview" class="nav-link">概覽</a>
      </li>
      <li class="nav-item">
        <a href="/community" class="nav-link">社群</a>
      </li>
      <li class="nav-item">
        <a href="https://dartpad.dev" class="nav-link">嘗試 Dart</a>
      </li>
      <li class="nav-item">
        <a href="/get-dart" class="nav-link">獲取 Dart SDK</a>
      </li>
      <li class="nav-item">
        <a href="/guides" class="nav-link active">文件</a>
      </li>
    </ul>

    <ul class="nav flex-column"><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-1" role="button" aria-expanded="false" aria-controls="sidenav-1">範例和課程</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-1">
        <li class="nav-item">
    <a class="nav-link" href="/tutorials">語言概覽</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable" data-toggle="collapse" data-target="#sidenav-1-2" href="#sidenav-1-2" role="button" aria-expanded="true" aria-controls="sidenav-1-2">Codelabs
    </a>
    <ul class="nav flex-column flex-nowrap collapse show" id="sidenav-1-2">
      <li class="nav-item">
    <a class="nav-link" href="/codelabs">Codelabs 列表</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/codelabs/dart-cheatsheet">Dart 速查表</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/codelabs/iterables">可迭代集合</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/codelabs/async-await">Dart 非同步程式設計</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/codelabs/null-safety">空安全</a>
  </li></ul>
  </li>

</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-2" role="button" aria-expanded="false" aria-controls="sidenav-2">Dart 開發語言</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2">
        <li class="nav-item">
    <a class="nav-link" href="/language">介紹</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-2-2" href="#sidenav-2-2" role="button" aria-expanded="false" aria-controls="sidenav-2-2">基礎表示式
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2-2">
      <li class="nav-item">
    <a class="nav-link" href="/language/variables">變數</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/operators">運運算元</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/comments">註釋</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/metadata">註解</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/libraries">庫 &amp; 導庫</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/keywords">關鍵字</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-2-3" href="#sidenav-2-3" role="button" aria-expanded="false" aria-controls="sidenav-2-3">型別
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2-3">
      <li class="nav-item">
    <a class="nav-link" href="/language/built-in-types">基本型別</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/records">記錄 (Records)</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/collections">集合 (Collections)</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/generics">泛型 (Generics)</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/typedefs">別名 (Typedefs)</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/type-system">型別系統</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-2-4" href="#sidenav-2-4" role="button" aria-expanded="false" aria-controls="sidenav-2-4">模式匹配
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2-4">
      <li class="nav-item">
    <a class="nav-link" href="/language/patterns">概覽 &amp; 用法</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/pattern-types">模式匹配型別</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link" href="/language/functions">函式方法</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-2-6" href="#sidenav-2-6" role="button" aria-expanded="false" aria-controls="sidenav-2-6">控制流
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2-6">
      <li class="nav-item">
    <a class="nav-link" href="/language/loops">迴圈</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/branches">分支</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link" href="/language/error-handling">錯誤處理</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-2-8" href="#sidenav-2-8" role="button" aria-expanded="false" aria-controls="sidenav-2-8">類 &amp; 物件
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2-8">
      <li class="nav-item">
    <a class="nav-link" href="/language/classes">類</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/constructors">構造方法</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/methods">成員方法</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/extend">繼承</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/mixins">混入 (Mixin)</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/enums">列舉</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/extension-methods">擴充方法</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/callable-objects">可呼叫的物件</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-2-9" href="#sidenav-2-9" role="button" aria-expanded="false" aria-controls="sidenav-2-9">型別修飾符
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2-9">
      <li class="nav-item">
    <a class="nav-link" href="/language/class-modifiers">概覽 &amp; 用法</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/class-modifiers-for-apis">API 維護者應該用的型別修飾符</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/modifier-reference">速查表</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-2-10" href="#sidenav-2-10" role="button" aria-expanded="false" aria-controls="sidenav-2-10">併發
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2-10">
      <li class="nav-item">
    <a class="nav-link" href="/language/async">非同步支援</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/language/concurrency">Isolates</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-2-11" href="#sidenav-2-11" role="button" aria-expanded="false" aria-controls="sidenav-2-11">Null safety
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2-11">
      <li class="nav-item">
    <a class="nav-link" href="/null-safety">健全的空安全</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/null-safety/migration-guide">遷移到空安全</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/null-safety/understanding-null-safety">深入理解空安全</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/null-safety/unsound-null-safety">非健全的空安全</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/null-safety/faq">空安全常見問題和解答</a>
  </li></ul>
  </li>

</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-3" role="button" aria-expanded="false" aria-controls="sidenav-3">高效指南 (Effective Dart)</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-3">
        <li class="nav-item">
    <a class="nav-link" href="/effective-dart">概述</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/effective-dart/style">程式碼風格</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/effective-dart/documentation">文件</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/effective-dart/usage">用法範例</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/effective-dart/design">API 設計</a>
  </li>
</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-4" role="button" aria-expanded="false" aria-controls="sidenav-4">核心函式庫</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-4">
        <li class="nav-item">
    <a class="nav-link" href="/guides/libraries">概覽</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/libraries/library-tour">概覽</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-4-3" href="#sidenav-4-3" role="button" aria-expanded="false" aria-controls="sidenav-4-3">介紹文章
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-4-3">
      <li class="nav-item">
    <a class="nav-link" href="/articles/libraries/creating-streams">建立 stream</a>
  </li></ul>
  </li>

</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-5" role="button" aria-expanded="false" aria-controls="sidenav-5">Packages</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-5">
        <li class="nav-item">
    <a class="nav-link" href="/guides/packages">如何使用 package</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/libraries/useful-libraries">常用 package 介紹</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/libraries/create-packages">建立 package</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/pub/publishing">釋出 package</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/libraries/writing-package-pages">設定 package 介紹頁</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-5-6" href="#sidenav-5-6" role="button" aria-expanded="false" aria-controls="sidenav-5-6">Package 參考資料
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-5-6">
      <li class="nav-item">
    <a class="nav-link" href="/tools/pub/dependencies">依賴</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/pub/glossary">術語表</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/pub/package-layout">Package 檔案結構</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/pub/environment-variables">設定環境變數</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/pub/pubspec">Pubspec 檔案</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/pub/troubleshoot">問題排查</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/pub/verified-publishers">釋出者認證</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/pub/versioning">版本管理</a>
  </li></ul>
  </li>

</ul>
    </li><li class="nav-item">
      <a class="nav-link active" data-toggle="collapse" href="#sidenav-6" role="button" aria-expanded="true" aria-controls="sidenav-6">開發文件</a>

      <ul class="nav flex-column flex-nowrap collapse show" id="sidenav-6">
        <li class="nav-item">
    <a class="nav-link" href="/codelabs/async-await">Futures、async 和 await</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tutorials/language/streams">Streams 介紹</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/json">使用 JSON</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/language/numbers">Dart 中的數字</a>
  </li><li class="nav-item">
    <a class="nav-link active collapsable" data-toggle="collapse" data-target="#sidenav-6-5" href="#sidenav-6-5" role="button" aria-expanded="true" aria-controls="sidenav-6-5">與其他語言進行互動呼叫
    </a>
    <ul class="nav flex-column flex-nowrap collapse show" id="sidenav-6-5">
      <li class="nav-item">
    <a class="nav-link" href="/guides/libraries/c-interop">與 C 互調</a>
  </li><li class="nav-item">
    <a class="nav-link active" href="/guides/libraries/objective-c-interop">與 Objective-C 和 Swift 互調</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/libraries/java-interop">與 Java 和 Kotlin 互調</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/web/js-interop">與 JavaScript 互調</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link" href="/guides/google-apis">Google APIs</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/multiplatform-apps">跨平臺應用</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-6-8" href="#sidenav-6-8" role="button" aria-expanded="false" aria-controls="sidenav-6-8">命令列和伺服器端應用
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-6-8">
      <li class="nav-item">
    <a class="nav-link" href="/server">概覽</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tutorials/server/get-started">起步課程</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tutorials/server/cmdline">命令列應用</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tutorials/server/fetch-data">從網路上獲取資料</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tutorials/server/httpserver">編寫 HTTP 伺服器端應用</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/server/libraries">庫和 package</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/server/google-cloud">Google Cloud</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-6-9" href="#sidenav-6-9" role="button" aria-expanded="false" aria-controls="sidenav-6-9">網頁端 (Web) 應用
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-6-9">
      <li class="nav-item">
    <a class="nav-link" href="/web">概覽</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tutorials/web/get-started">開始使用</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-6-9-3" href="#sidenav-6-9-3" role="button" aria-expanded="false" aria-controls="sidenav-6-9-3">底層 Web 程式設計
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-6-9-3">
      <li class="nav-item">
    <a class="nav-link" href="/tutorials/web/low-level-html/connect-dart-html">Dart 與 HTML 關聯</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tutorials/web/low-level-html/add-elements">向 DOM 新增元素</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tutorials/web/low-level-html/remove-elements">移除 DOM 元素</a>
  </li>
  </ul>
  </li>
<li class="nav-item">
    <a class="nav-link" href="/web/deployment">部署</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/web/libraries">常用 Web 函式庫和 package</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link" href="/guides/environment-declarations">環境變數宣告</a>
  </li>
</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-7" role="button" aria-expanded="false" aria-controls="sidenav-7">開發工具和使用技巧</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-7">
        <li class="nav-item">
    <a class="nav-link" href="/tools">概覽</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-7-2" href="#sidenav-7-2" role="button" aria-expanded="false" aria-controls="sidenav-7-2">編輯器和除錯工具
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-7-2">
      <li class="nav-item">
    <a class="nav-link" href="/tools/jetbrains-plugin">使用 IntelliJ 和 Android Studio</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/vs-code">使用 VS Code</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/dart-devtools">Dart 開發者工具</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-7-2-4" href="#sidenav-7-2-4" role="button" aria-expanded="false" aria-controls="sidenav-7-2-4">線上執行 Dart 程式碼
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-7-2-4">
      <li class="nav-item">
    <a class="nav-link" href="/tools/dartpad">Overview</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dartpad/dartpad-best-practices">DartPad 課程</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dartpad/troubleshoot">DartPad 疑難解答</a>
  </li>
  </ul>
  </li>
</ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-7-3" href="#sidenav-7-3" role="button" aria-expanded="false" aria-controls="sidenav-7-3">命令列工具
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-7-3">
      <li class="nav-item">
    <a class="nav-link collapsable" data-toggle="collapse" data-target="#sidenav-7-3-1" href="#sidenav-7-3-1" role="button" aria-expanded="true" aria-controls="sidenav-7-3-1">Dart SDK
    </a>
    <ul class="nav flex-column flex-nowrap collapse show" id="sidenav-7-3-1">
      <li class="nav-item">
    <a class="nav-link" href="/tools/sdk">概覽</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-tool">dart 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-analyze">dart analyze 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-compile">dart compile 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-create">dart create 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-doc">dart doc 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-fix">dart fix 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-format">dart format 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-info">dart info 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/pub/cmd">dart pub 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-run">dart run 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-test">dart test 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dartaotruntime">dartaotruntime 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/experiment-flags">實驗性命令標記</a>
  </li>
  </ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable" data-toggle="collapse" data-target="#sidenav-7-3-2" href="#sidenav-7-3-2" role="button" aria-expanded="true" aria-controls="sidenav-7-3-2">其他的命令列工具
    </a>
    <ul class="nav flex-column flex-nowrap collapse show" id="sidenav-7-3-2">
      <li class="nav-item">
    <a class="nav-link" href="/tools/build_runner">build_runner 命令</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/webdev">webdev 命令</a>
  </li>
  </ul>
  </li>
</ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-7-4" href="#sidenav-7-4" role="button" aria-expanded="false" aria-controls="sidenav-7-4">原始碼管理
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-7-4">
      <li class="nav-item">
    <a class="nav-link" href="/guides/language/formatting">程式碼格式化</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/libraries/private-files">不應提交的內容</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-7-5" href="#sidenav-7-5" role="button" aria-expanded="false" aria-controls="sidenav-7-5">靜態分析
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-7-5">
      <li class="nav-item">
    <a class="nav-link" href="/tools/analysis">自訂靜態分析</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/language/sound-problems">修復常見的型別問題</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/diagnostic-messages">診斷訊息</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/linter-rules">Linter 規則</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-7-6" href="#sidenav-7-6" role="button" aria-expanded="false" aria-controls="sidenav-7-6">測試和調優
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-7-6">
      <li class="nav-item">
    <a class="nav-link" href="/guides/testing">測試</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/web/debugging">除錯 Web 應用</a>
  </li></ul>
  </li>

</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-8" role="button" aria-expanded="false" aria-controls="sidenav-8">資源</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-8">
        <li class="nav-item">
    <a class="nav-link" href="/resources/faq">常見問題</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/language/evolution">版本演變</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/language/spec">語言規範</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/resources/dart-3-migration">Dart 3 遷移指南</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-8-5" href="#sidenav-8-5" role="button" aria-expanded="false" aria-controls="sidenav-8-5">從其他平台轉向 Dart
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-8-5">
      <li class="nav-item">
    <a class="nav-link" href="/guides/language/coming-from/js-to-dart">從 JavaScript 到 Dart</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/language/coming-from/swift-to-dart">從 Swift 到 Dart</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link" href="/resources/glossary">詞彙表</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/resources/books">書籍資源</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/resources/videos">影片資源</a>
  </li>
</ul>
    </li><li class="nav-item">
      <a class="nav-link " data-toggle="collapse" href="#sidenav-9" role="button" aria-expanded="true" aria-controls="sidenav-9">相關站點</a>

      <ul class="nav flex-column flex-nowrap collapse show" id="sidenav-9">
        <li class="nav-item">
    <a class="nav-link" href="https://api.dart.dev" target="_blank" rel="noopener">API 文件<span class="material-icons md-24">
        open_in_new
      </span></a>
  </li><li class="nav-item">
    <a class="nav-link" href="https://medium.com/dartlang" target="_blank" rel="noopener">Dart 團隊官方部落格<span class="material-icons md-24">
        open_in_new
      </span></a>
  </li><li class="nav-item">
    <a class="nav-link" href="https://dartpad.dev" target="_blank" rel="noopener">DartPad (線上編輯器)<span class="material-icons md-24">
        open_in_new
      </span></a>
  </li><li class="nav-item">
    <a class="nav-link" href="https://flutter.tw" target="_blank" rel="noopener">Flutter<span class="material-icons md-24">
        open_in_new
      </span></a>
  </li><li class="nav-item">
    <a class="nav-link" href="https://pub.dev" target="_blank" rel="noopener">Package 網站<span class="material-icons md-24">
        open_in_new
      </span></a>
  </li>
</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-10" role="button" aria-expanded="false" aria-controls="sidenav-10">關於 Dart 中文文件</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-10">
        <li class="nav-item">
    <a class="nav-link" href="https://flutter.tw/about/docs-cn" target="_blank" rel="noopener">關於本站<span class="material-icons md-24">
        open_in_new
      </span></a>
  </li><li class="nav-item">
    <a class="nav-link" href="https://flutter.tw/disclaimer" target="_blank" rel="noopener">免責條款 (Disclaimer)<span class="material-icons md-24">
        open_in_new
      </span></a>
  </li>
</ul>
    </li></ul>

  </div>
</div>

    <main id="page-content">
      







<div id="site-toc--side" class="site-toc ">
  <header class="site-toc__title">
    目錄
    
  </header>
  <ul id="toc" class="section-nav">
<li class="toc-entry nav-item toc-h2"><a class="nav-link" href="#objective-c-example">Objective-C Example</a>
<ul class="nav">
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#configuring-ffigen">Configuring ffigen</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#generating-the-dart-bindings">Generating the Dart bindings</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#using-the-bindings">Using the bindings</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#callbacks-and-multithreading-limitations">Callbacks and multithreading limitations</a></li>
</ul>
</li>
<li class="toc-entry nav-item toc-h2"><a class="nav-link" href="#swift-example">Swift example</a>
<ul class="nav">
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#generating-the-objective-c-wrapper-header">Generating the Objective-C wrapper header</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#configuring-ffigen-1">Configuring ffigen</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#generating-the-dart-bindings-1">Generating the Dart bindings</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#using-the-bindings-1">Using the bindings</a></li>
</ul>
</li>
</ul>
  
</div>


      <article>
        <div class="content">
          

          <div id="site-content-title">
            <div id="page-github-links" class="btn-group" aria-label="Page GitHub links" role="group">
  <a href="https://github.com/doggy8088/dart.tw/tree/master/src/_guides/libraries/objective-c-interop.md" class="btn no-automatic-external" title="View page source" target="_blank" rel="noopener">
    <i class="material-icons">description</i>
  </a>
  <a href="https://github.com/doggy8088/dart.tw/issues/new?template=1_page_issue.yml&amp;title=[PAGE ISSUE]: 'Objective-C and Swift interop using package:ffigen'&amp;page-url=https://dart.tw.gh.miniasp.com/guides/libraries/objective-c-interop&amp;page-source=https://github.com/doggy8088/dart.tw/tree/master/src/_guides/libraries/objective-c-interop.md" class="btn no-automatic-external" title="Report an issue with this page" target="_blank" rel="noopener">
    <i class="material-icons">bug_report</i>
  </a>
</div>

            
            <h1 id="objective-c-and-swift-interop-using-packageffigen">Objective-C and Swift interop using package:ffigen</h1>
            </div>
          







<div id="site-toc--inline" class="site-toc toc-collapsible toc-collapsed">
  <header class="site-toc__title">
    目錄
    
      <span class="site-toc--inline__toggle toc-toggle-down"><i class="material-icons">keyboard_arrow_down</i></span>
      <span class="site-toc--inline__toggle toc-toggle-up"><i class="material-icons">keyboard_arrow_up</i></span>
    
  </header>
  <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#objective-c-example">Objective-C Example</a>
<ul>
<li class="toc-entry toc-h3"><a href="#configuring-ffigen">Configuring ffigen</a></li>
<li class="toc-entry toc-h3"><a href="#generating-the-dart-bindings">Generating the Dart bindings</a></li>
<li class="toc-entry toc-h3"><a href="#using-the-bindings">Using the bindings</a></li>
<li class="toc-entry toc-h3"><a href="#callbacks-and-multithreading-limitations">Callbacks and multithreading limitations</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#swift-example">Swift example</a>
<ul>
<li class="toc-entry toc-h3"><a href="#generating-the-objective-c-wrapper-header">Generating the Objective-C wrapper header</a></li>
<li class="toc-entry toc-h3"><a href="#configuring-ffigen-1">Configuring ffigen</a></li>
<li class="toc-entry toc-h3"><a href="#generating-the-dart-bindings-1">Generating the Dart bindings</a></li>
<li class="toc-entry toc-h3"><a href="#using-the-bindings-1">Using the bindings</a></li>
</ul>
</li>
</ul>
  
    <span class="site-toc--inline__toggle toc-toggle-more-items"><i class="material-icons">more_horiz</i></span>
  
</div>


          <p>Dart mobile, command-line, and server apps
running on the <a href="/overview#platform">Dart Native platform</a>, on macOS or iOS,
can use <code class="language-plaintext highlighter-rouge">dart:ffi</code> and <a href="https://pub.dev/packages/ffigen"><code class="language-plaintext highlighter-rouge">package:ffigen</code></a>
to call Objective-C and Swift APIs.</p>

<aside class="alert alert-info" role="alert">
  <p><i class="material-icons" aria-hidden="true">info</i> <strong>備註:</strong>
  This interop feature is <strong>experimental</strong>,
  and <a href="https://github.com/dart-lang/sdk/issues/49673">in active development</a>.</p>
</aside>

<p><code class="language-plaintext highlighter-rouge">dart:ffi</code> allows Dart code to interact with native C APIs.
Objective-C is based on and compatible with C,
so it is possible to interact with Objective-C APIs using only <code class="language-plaintext highlighter-rouge">dart:ffi</code>.
However, doing so involves a lot of boilerplate code,
so you can use <code class="language-plaintext highlighter-rouge">package:ffigen</code> to automatically generate
the Dart FFI bindings for a given Objective-C API.
To learn more about FFI and interfacing with C code directly,
see the <a href="/guides/libraries/c-interop">C interop guide</a>.</p>

<p>You can generate Objective-C headers for Swift APIs,
allowing <code class="language-plaintext highlighter-rouge">dart:ffi</code> and <code class="language-plaintext highlighter-rouge">package:ffigen</code> to interact with Swift.</p>

<h2 id="objective-c-example">
<a class="anchor" href="#objective-c-example" aria-hidden="true"><span class="octicon octicon-link"></span></a>Objective-C Example</h2>

<p>This guide walks you through <a href="https://github.com/dart-lang/ffigen/tree/master/example/objective_c">an example</a>
that uses <code class="language-plaintext highlighter-rouge">package:ffigen</code> to generate bindings for
<a href="https://developer.apple.com/documentation/avfaudio/avaudioplayer?language=objc"><code class="language-plaintext highlighter-rouge">AVAudioPlayer</code></a>.
This API requires at least macOS SDK 10.7,
so check your version and update Xcode if necessary:</p>

<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>xcodebuild <span class="nt">-showsdks</span>
</code></pre></div></div>

<p>Generating bindings to wrap an Objective-C API is similar to wrapping a C API.
Direct <code class="language-plaintext highlighter-rouge">package:ffigen</code> at the header file that describes the API,
and then load the library with <code class="language-plaintext highlighter-rouge">dart:ffi</code>.</p>

<p><code class="language-plaintext highlighter-rouge">package:ffigen</code> parses Objective-C header files
using <a href="https://llvm.org/">LLVM</a>,
so you’ll need to install that first.
See <a href="https://pub.dev/packages/ffigen#installing-llvm">Installing LLVM</a>
from the ffigen README for more details.</p>

<h3 id="configuring-ffigen">
<a class="anchor" href="#configuring-ffigen" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuring ffigen</h3>

<p>First, add <code class="language-plaintext highlighter-rouge">package:ffigen</code> as a dev dependency:</p>

<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>dart pub add <span class="nt">--dev</span> ffigen
</code></pre></div></div>

<p>Then, configure ffigen to generate bindings for the
Objective-C header containing the API.
The ffigen configuration options go in your <code class="language-plaintext highlighter-rouge">pubspec.yaml</code> file,
under a top-level <code class="language-plaintext highlighter-rouge">ffigen</code> entry.
Alternatively, you can put the ffigen config in its own <code class="language-plaintext highlighter-rouge">.yaml</code> file.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">ffigen</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">AVFAudio</span>
  <span class="na">description</span><span class="pi">:</span> <span class="s">Bindings for AVFAudio.</span>
  <span class="na">language</span><span class="pi">:</span> <span class="s">objc</span>
  <span class="na">output</span><span class="pi">:</span> <span class="s1">'</span><span class="s">avf_audio_bindings.dart'</span>
  <span class="na">headers</span><span class="pi">:</span>
    <span class="na">entry-points</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/System/Library/Frameworks/AVFAudio.framework/Headers/AVAudioPlayer.h'</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">name</code> is the name of the native library wrapper class
that will be generated,
and the <code class="language-plaintext highlighter-rouge">description</code> will be used in the documentation for that class.
The <code class="language-plaintext highlighter-rouge">output</code> is the path of the Dart file that ffigen will create.
The entry point is the header file containing the API.
In this example, it is the internal <code class="language-plaintext highlighter-rouge">AVAudioPlayer.h</code> header.</p>

<p>Another import thing you’ll see,
if you look at the <a href="https://github.com/dart-lang/ffigen/tree/master/example/objective_c/pubspec.yaml">example config</a>,
is the exclude and include options.
By default, <code class="language-plaintext highlighter-rouge">ffigen</code> generates bindings for everything
it finds in the header,
and everything that those bindings depend on in other headers.
Most Objective-C libraries depend on Apple’s internal libraries,
which are very large.
If bindings are generated without any filters,
the resulting file can be millions of lines long.
To solve this problem,
the ffigen config has fields that allow you to filter out
all the functions, structs, enums, etc., that you’re not interested in.
For this example, we’re only interested in <code class="language-plaintext highlighter-rouge">AVAudioPlayer</code>,
so you can exclude everything else:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="na">exclude-all-by-default</span><span class="pi">:</span> <span class="kc">true</span>
  <span class="na">objc-interfaces</span><span class="pi">:</span>
    <span class="na">include</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">AVAudioPlayer'</span>
</code></pre></div></div>

<p>Since <code class="language-plaintext highlighter-rouge">AVAudioPlayer</code> is explicitly included like this,
<code class="language-plaintext highlighter-rouge">ffigen</code> excludes all other interfaces.
The <code class="language-plaintext highlighter-rouge">exclude-all-by-default</code> flag tells <code class="language-plaintext highlighter-rouge">ffigen</code> to
exclude everything else.
The result is that nothing is included except <code class="language-plaintext highlighter-rouge">AVAudioPlayer</code>,
and its dependencies, such as <code class="language-plaintext highlighter-rouge">NSObject</code> and <code class="language-plaintext highlighter-rouge">NSString</code>.
So instead of several million lines of bindings,
you end up with tens of thousands.</p>

<p>If you need more granular control,
you can exclude or include all declarations individually,
rather than using <code class="language-plaintext highlighter-rouge">exclude-all-by-default</code>:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="na">functions</span><span class="pi">:</span>
    <span class="na">exclude</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">.*'</span>
  <span class="na">structs</span><span class="pi">:</span>
    <span class="na">exclude</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">.*'</span>
  <span class="na">unions</span><span class="pi">:</span>
    <span class="na">exclude</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">.*'</span>
  <span class="na">globals</span><span class="pi">:</span>
    <span class="na">exclude</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">.*'</span>
  <span class="na">macros</span><span class="pi">:</span>
    <span class="na">exclude</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">.*'</span>
  <span class="na">enums</span><span class="pi">:</span>
    <span class="na">exclude</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">.*'</span>
  <span class="na">unnamed-enums</span><span class="pi">:</span>
    <span class="na">exclude</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">.*'</span>
</code></pre></div></div>

<p>These <code class="language-plaintext highlighter-rouge">exclude</code> entries all exclude the regular expression <code class="language-plaintext highlighter-rouge">'.*'</code>,
which matches anything.</p>

<p>You can also use the <code class="language-plaintext highlighter-rouge">preamble</code> option
to insert text at the top of the generated file.
In this example, the <code class="language-plaintext highlighter-rouge">preamble</code> was used
to insert some linter ignore rules at the top of the generated file:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="na">preamble</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">// ignore_for_file: camel_case_types, non_constant_identifier_names, unused_element, unused_field, return_of_invalid_type, void_checks, annotate_overrides, no_leading_underscores_for_local_identifiers, library_private_types_in_public_api</span>
</code></pre></div></div>

<p>See the <a href="https://pub.dev/packages/ffigen#configurations">ffigen readme</a>
for a full list of configuration options.</p>

<h3 id="generating-the-dart-bindings">
<a class="anchor" href="#generating-the-dart-bindings" aria-hidden="true"><span class="octicon octicon-link"></span></a>Generating the Dart bindings</h3>

<p>To generate the bindings, navigate to the example directory,
and run ffigen:</p>

<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>dart run ffigen
</code></pre></div></div>

<p>This will search in the <code class="language-plaintext highlighter-rouge">pubspec.yaml</code> file for a top-level <code class="language-plaintext highlighter-rouge">ffigen</code> entry.
If you chose to put the ffigen config in a separate file, use the
<code class="language-plaintext highlighter-rouge">--config</code> option and specify that file:</p>

<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>dart run ffigen <span class="nt">--config</span> my_ffigen_config.yaml
</code></pre></div></div>

<p>For this example, this will generate
<a href="https://github.com/dart-lang/ffigen/tree/master/example/objective_c/avf_audio_bindings.dart">avf_audio_bindings.dart</a>.</p>

<p>This file contains a class called <code class="language-plaintext highlighter-rouge">AVFAudio</code>, which is the native library
wrapper that loads all the API functions using FFI,
and provides convenient wrapper methods to call them.
The other classes in this file are all Dart wrappers
around the Objective-C interfaces that we need,
such as <code class="language-plaintext highlighter-rouge">AVAudioPlayer</code> and its dependencies.</p>

<h3 id="using-the-bindings">
<a class="anchor" href="#using-the-bindings" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using the bindings</h3>

<p>Now you’re ready to load and interact with the generated library.
The example app, <a href="https://github.com/dart-lang/ffigen/tree/master/example/objective_c/play_audio.dart">play_audio.dart</a>,
loads and plays audio files passed as command line arguments.
The first step is to load the
<a href="https://developer.apple.com/documentation/avfaudio?language=objc">dylib</a>
and instantiate the native <code class="language-plaintext highlighter-rouge">AVFAudio</code> library:</p>

<div class="language-dart highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="s">'dart:ffi'</span><span class="o">;</span>
<span class="kn">import</span> <span class="s">'avf_audio_bindings.dart'</span><span class="o">;</span>

<span class="kd">const</span> <span class="n">_dylibPath</span> <span class="o">=</span>
    <span class="s">'/System/Library/Frameworks/AVFAudio.framework/Versions/Current/AVFAudio'</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">List</span><span class="p">&lt;</span><span class="kt">String</span><span class="p">&gt;</span> <span class="n">args</span><span class="p">)</span> <span class="kd">async</span> <span class="p">{</span>
  <span class="kd">final</span> <span class="n">lib</span> <span class="o">=</span> <span class="n">AVFAudio</span><span class="p">(</span><span class="n">DynamicLibrary</span><span class="o">.</span><span class="na">open</span><span class="p">(</span><span class="n">_dylibPath</span><span class="p">));</span>
</code></pre></div></div>

<p>Since you’re loading an internal library,
the dylib path is pointing at an internal framework dylib.
You can also load your own <code class="language-plaintext highlighter-rouge">.dylib</code> file,
or if the library is statically linked into your app (often the case on iOS)
you can use <a href="https://api.dart.dev/dart-ffi/DynamicLibrary/DynamicLibrary.process.html"><code class="language-plaintext highlighter-rouge">DynamicLibrary.process()</code></a>:</p>

<div class="language-dart highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">final</span> <span class="n">lib</span> <span class="o">=</span> <span class="n">AVFAudio</span><span class="p">(</span><span class="n">DynamicLibrary</span><span class="o">.</span><span class="na">process</span><span class="p">());</span>
</code></pre></div></div>

<p>The goal of the example is to play each of the audio files
specified as command line arguments one by one.
For each argument,
you first have to convert the Dart <code class="language-plaintext highlighter-rouge">String</code> to an Objective-C <code class="language-plaintext highlighter-rouge">NSString</code>.
The generated <code class="language-plaintext highlighter-rouge">NSString</code> wrapper has a convenient constructor
that handles this conversion,
and a <code class="language-plaintext highlighter-rouge">toString()</code> method that converts it back to a Dart <code class="language-plaintext highlighter-rouge">String</code>.</p>

<div class="language-dart highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">for</span> <span class="p">(</span><span class="kd">final</span> <span class="n">file</span> <span class="k">in</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">final</span> <span class="n">fileStr</span> <span class="o">=</span> <span class="n">NSString</span><span class="p">(</span><span class="n">lib</span><span class="p">,</span> <span class="n">file</span><span class="p">);</span>
    <span class="n">print</span><span class="p">(</span><span class="s">'Loading </span><span class="si">$fileStr</span><span class="s">'</span><span class="p">);</span>
</code></pre></div></div>

<p>The audio player expects an <code class="language-plaintext highlighter-rouge">NSURL</code>, so next we use the <a href="https://developer.apple.com/documentation/foundation/nsurl/1410828-fileurlwithpath?language=objc"><code class="language-plaintext highlighter-rouge">fileURLWithPath:</code></a>
method to convert the <code class="language-plaintext highlighter-rouge">NSString</code> to an <code class="language-plaintext highlighter-rouge">NSURL</code>.
Since <code class="language-plaintext highlighter-rouge">:</code> is not a valid character in a Dart method name,
it has been translated to <code class="language-plaintext highlighter-rouge">_</code> in the bindings.</p>

<div class="language-dart highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">final</span> <span class="n">fileUrl</span> <span class="o">=</span> <span class="n">NSURL</span><span class="o">.</span><span class="na">fileURLWithPath_</span><span class="p">(</span><span class="n">lib</span><span class="p">,</span> <span class="n">fileStr</span><span class="p">);</span>
</code></pre></div></div>

<p>Now, you can construct the <code class="language-plaintext highlighter-rouge">AVAudioPlayer</code>.
Constructing an Objective-C object has two stages.
<code class="language-plaintext highlighter-rouge">alloc</code> allocates the memory for the object,
but doesn’t initialize it.
Methods with names starting with <code class="language-plaintext highlighter-rouge">init*</code> do the initialization.
Some interfaces also provide <code class="language-plaintext highlighter-rouge">new*</code> methods that do both of these steps.</p>

<p>To initialize the <code class="language-plaintext highlighter-rouge">AVAudioPlayer</code>,
use the <a href="https://developer.apple.com/documentation/avfaudio/avaudioplayer/1387281-initwithcontentsofurl?language=objc"><code class="language-plaintext highlighter-rouge">initWithContentsOfURL:error:</code></a> method:</p>

<div class="language-dart highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">final</span> <span class="n">player</span> <span class="o">=</span>
        <span class="n">AVAudioPlayer</span><span class="o">.</span><span class="na">alloc</span><span class="p">(</span><span class="n">lib</span><span class="p">)</span><span class="o">.</span><span class="na">initWithContentsOfURL_error_</span><span class="p">(</span><span class="n">fileUrl</span><span class="p">,</span> <span class="n">nullptr</span><span class="p">);</span>
</code></pre></div></div>

<p>Objective-C uses reference counting for memory management
(through retain, release, and other functions),
but on the Dart side memory management is handled automatically.
The Dart wrapper object retains a reference to the Objective-C object,
and when the Dart object is garbage collected,
the generated code automatically releases that reference using a
<a href="https://api.dart.dev/dart-ffi/NativeFinalizer-class.html"><code class="language-plaintext highlighter-rouge">NativeFinalizer</code></a>.</p>

<p>Next, look up the length of the audio file,
which you’ll need later to wait for the audio to finish.
The <a href="https://developer.apple.com/documentation/avfaudio/avaudioplayer/1388395-duration?language=objc"><code class="language-plaintext highlighter-rouge">duration</code></a> is a <code class="language-plaintext highlighter-rouge">@property(readonly)</code>.
Objective-C properties are translated into getters and setters
on the generated Dart wrapper object.
Since <code class="language-plaintext highlighter-rouge">duration</code> is <code class="language-plaintext highlighter-rouge">readonly</code>, only the getter is generated.</p>

<p>The resulting <code class="language-plaintext highlighter-rouge">NSTimeInterval</code> is just a type aliased <code class="language-plaintext highlighter-rouge">double</code>,
so you can immediately use the Dart <code class="language-plaintext highlighter-rouge">.ceil()</code> method
to round up to the next second:</p>

<div class="language-dart highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">final</span> <span class="n">durationSeconds</span> <span class="o">=</span> <span class="n">player</span><span class="o">.</span><span class="na">duration</span><span class="o">.</span><span class="na">ceil</span><span class="p">();</span>
    <span class="n">print</span><span class="p">(</span><span class="s">'</span><span class="si">$durationSeconds</span><span class="s"> sec'</span><span class="p">);</span>
</code></pre></div></div>

<p>Finally, you can use the <a href="https://developer.apple.com/documentation/avfaudio/avaudioplayer/1387388-play?language=objc"><code class="language-plaintext highlighter-rouge">play</code></a> method to play the audio,
then check the status, and wait for the duration of the audio file:</p>

<div class="language-dart highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">final</span> <span class="n">status</span> <span class="o">=</span> <span class="n">player</span><span class="o">.</span><span class="na">play</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">print</span><span class="p">(</span><span class="s">'Playing...'</span><span class="p">);</span>
      <span class="k">await</span> <span class="n">Future</span><span class="p">&lt;</span><span class="kt">void</span><span class="p">&gt;</span><span class="o">.</span><span class="na">delayed</span><span class="p">(</span><span class="n">Duration</span><span class="p">(</span><span class="nl">seconds:</span> <span class="n">durationSeconds</span><span class="p">));</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">print</span><span class="p">(</span><span class="s">'Failed to play audio.'</span><span class="p">);</span>
    <span class="p">}</span>
</code></pre></div></div>

<h3 id="callbacks-and-multithreading-limitations">
<a class="anchor" href="#callbacks-and-multithreading-limitations" aria-hidden="true"><span class="octicon octicon-link"></span></a>Callbacks and multithreading limitations</h3>

<p>Multithreading issues are the biggest limitation
of Dart’s experimental support for Objective-C interop.
These limitations are due to the relationship between
Dart isolates and OS threads,
and the way Apple’s APIs handle multithreading:</p>

<ul>
  <li>Dart isolates are not the same thing as threads.
Isolates run on threads,
but aren’t guaranteed to run on any particular thread,
and the VM might change which thread an isolate is running on
without warning.
There is an <a href="https://github.com/dart-lang/sdk/issues/46943">open feature request</a> to allow isolates to be
pinned to specific threads.</li>
  <li>While <code class="language-plaintext highlighter-rouge">ffigen</code> supports converting
Dart functions to Objective-C blocks,
most Apple APIs don’t make any guarantees about
on which thread a callback will run.</li>
  <li>Most APIs that involve UI interaction
can only be called on the main thread,
also called the <em>platform</em> thread in Flutter.</li>
  <li>Many Apple APIs are <a href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/ThreadSafetySummary/ThreadSafetySummary.html">not thread safe</a>.</li>
</ul>

<p>The first two points mean that a callback created in one isolate
might be invoked on a thread running a different isolate,
or no isolate at all.
This will cause your app to crash.
You can work around this limitation by writing some
Objective-C code that intercepts your callback and
forwards it over a <a href="https://api.dart.dev/dart-ffi/NativePort.html"><code class="language-plaintext highlighter-rouge">Dart_Port</code></a>
to the correct isolate.
For an example of this,
see the implementation of <a href="https://github.com/dart-lang/http/blob/master/pkgs/cupertino_http/src/CUPHTTPClientDelegate.m"><code class="language-plaintext highlighter-rouge">package:cupertino_http</code></a>.</p>

<p>The third point means that directly calling some Apple APIs
using the generated Dart bindings might be thread unsafe.
This could crash your app, or cause other unpredictable behavior.
You can work around this limitation by writing some
Objective-C code that dispatches your call
to the main thread.
For more information, see the <a href="https://developer.apple.com/documentation/dispatch?language=objc">Objective-C dispatch documentation</a>.</p>

<p>Regarding the last point,
although Dart isolates can switch threads,
they only ever run on one thread at a time.
So, the API you are interacting with
doesn’t necessarily have to be thread safe,
as long as it is not thread hostile,
and doesn’t have constraints about which thread it’s called from.</p>

<p>You can safely interact with Objective-C code,
as long as you keep these limitations in mind.</p>

<h2 id="swift-example">
<a class="anchor" href="#swift-example" aria-hidden="true"><span class="octicon octicon-link"></span></a>Swift example</h2>

<p>This <a href="https://github.com/dart-lang/ffigen/tree/master/example/swift">example</a> demonstrates how to
make a Swift class compatible with Objective-C,
generate a wrapper header, and invoke it from Dart code.</p>

<h3 id="generating-the-objective-c-wrapper-header">
<a class="anchor" href="#generating-the-objective-c-wrapper-header" aria-hidden="true"><span class="octicon octicon-link"></span></a>Generating the Objective-C wrapper header</h3>

<p>Swift APIs can be made compatible with Objective-C,
by using the <code class="language-plaintext highlighter-rouge">@objc</code> annotation.
Make sure to make any classes or methods you want to use
<code class="language-plaintext highlighter-rouge">public</code>, and have your classes extend <code class="language-plaintext highlighter-rouge">NSObject</code>.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">Foundation</span>

<span class="kd">@objc</span> <span class="kd">public</span> <span class="kd">class</span> <span class="kt">SwiftClass</span><span class="p">:</span> <span class="kt">NSObject</span> <span class="p">{</span>
  <span class="kd">@objc</span> <span class="kd">public</span> <span class="kd">func</span> <span class="nf">sayHello</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">"Hello from Swift!"</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">@objc</span> <span class="kd">public</span> <span class="k">var</span> <span class="nv">someField</span> <span class="o">=</span> <span class="mi">123</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>If you’re trying to interact with a third-party library,
and can’t modify their code,
you might need to write an Objective-C compatible wrapper class
that exposes the methods you want to use.</p>

<p>For more information about Objective-C / Swift interoperability,
see the <a href="https://developer.apple.com/documentation/swift/importing-swift-into-objective-c">Swift documentation</a>.</p>

<p>Once you’ve made your class compatible,
you can generate an Objective-C wrapper header.
You can do this using Xcode,
or using the Swift command-line compiler, <code class="language-plaintext highlighter-rouge">swiftc</code>.
This example uses the command line:</p>

<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>swiftc <span class="nt">-c</span> swift_api.swift             <span class="se">\</span>
<span class="go">    -module-name swift_module           \
    -emit-objc-header-path swift_api.h  \
    -emit-library -o libswiftapi.dylib
</span></code></pre></div></div>

<p>This command compiles the Swift file, <code class="language-plaintext highlighter-rouge">swift_api.swift</code>,
and generates a wrapper header, <code class="language-plaintext highlighter-rouge">swift_api.h</code>.
It also generates the dylib you’re going to load later,
<code class="language-plaintext highlighter-rouge">libswiftapi.dylib</code>.</p>

<p>You can verify that the header generated correctly by opening it, 
and checking that the interfaces are what you expect.
Towards the bottom of the file,
you should see something like the following:</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">SWIFT_CLASS</span><span class="p">(</span><span class="s">"_TtC12swift_module10SwiftClass"</span><span class="p">)</span>
<span class="k">@interface</span> <span class="nc">SwiftClass</span> <span class="p">:</span> <span class="nc">NSObject</span>
<span class="k">-</span> <span class="p">(</span><span class="n">NSString</span> <span class="o">*</span> <span class="n">_Nonnull</span><span class="p">)</span><span class="n">sayHello</span> <span class="n">SWIFT_WARN_UNUSED_RESULT</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">)</span> <span class="n">NSInteger</span> <span class="n">someField</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="n">nonnull</span> <span class="n">instancetype</span><span class="p">)</span><span class="n">init</span> <span class="n">OBJC_DESIGNATED_INITIALIZER</span><span class="p">;</span>
<span class="k">@end</span>
</code></pre></div></div>

<p>If the interface is missing, or doesn’t have all its methods,
make sure they’re all annotated with <code class="language-plaintext highlighter-rouge">@objc</code> and <code class="language-plaintext highlighter-rouge">public</code>.</p>

<h3 id="configuring-ffigen-1">
<a class="anchor" href="#configuring-ffigen-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuring ffigen</h3>

<p>Ffigen only sees the Objective-C wrapper header, <code class="language-plaintext highlighter-rouge">swift_api.h</code>.
So most of this config looks similar
to the Objective-C example,
including setting the language to <code class="language-plaintext highlighter-rouge">objc</code>.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">ffigen</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">SwiftLibrary</span>
  <span class="na">description</span><span class="pi">:</span> <span class="s">Bindings for swift_api.</span>
  <span class="na">language</span><span class="pi">:</span> <span class="s">objc</span>
  <span class="na">output</span><span class="pi">:</span> <span class="s1">'</span><span class="s">swift_api_bindings.dart'</span>
  <span class="na">exclude-all-by-default</span><span class="pi">:</span> <span class="kc">true</span>
  <span class="na">objc-interfaces</span><span class="pi">:</span>
    <span class="na">include</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">SwiftClass'</span>
    <span class="na">module</span><span class="pi">:</span>
      <span class="s1">'</span><span class="s">SwiftClass'</span><span class="err">:</span> <span class="s1">'</span><span class="s">swift_module'</span>
  <span class="na">headers</span><span class="pi">:</span>
    <span class="na">entry-points</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">swift_api.h'</span>
  <span class="na">preamble</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">// ignore_for_file: camel_case_types, non_constant_identifier_names, unused_element, unused_field, return_of_invalid_type, void_checks, annotate_overrides, no_leading_underscores_for_local_identifiers, library_private_types_in_public_api</span>
</code></pre></div></div>

<p>As before, set the language to <code class="language-plaintext highlighter-rouge">objc</code>,
and the entry point to the header;
exclude everything by default,
and explicitly include the interface you are binding.</p>

<p>One important difference between the config
for a wrapped Swift API and a pure Objective-C API:
the <code class="language-plaintext highlighter-rouge">objc-interfaces</code> -&gt; <code class="language-plaintext highlighter-rouge">module</code> option.
When <code class="language-plaintext highlighter-rouge">swiftc</code> compiles the library,
it gives the Objective-C interface a module prefix.
Internally, <code class="language-plaintext highlighter-rouge">SwiftClass</code> is actually registered as
<code class="language-plaintext highlighter-rouge">swift_module.SwiftClass</code>.
You need to tell <code class="language-plaintext highlighter-rouge">ffigen</code> about this prefix,
so it loads the correct class from the dylib.</p>

<p>Not every class gets this prefix.
For example, <code class="language-plaintext highlighter-rouge">NSString</code> and <code class="language-plaintext highlighter-rouge">NSObject</code> 
won’t get a module prefix, 
because they are internal classes.
This is why the <code class="language-plaintext highlighter-rouge">module</code> option maps
from class name to module prefix.
You can also use regular expressions to match
multiple class names at once.</p>

<p>The module prefix is whatever you passed to
<code class="language-plaintext highlighter-rouge">swiftc</code> in the <code class="language-plaintext highlighter-rouge">-module-name</code> flag.
In this example, it’s <code class="language-plaintext highlighter-rouge">swift_module</code>.
If you don’t explicitly set this flag,
it defaults to the name of the Swift file.</p>

<p>If you aren’t sure what the module name is,
you can also check the generated Objective-C header.
Above the <code class="language-plaintext highlighter-rouge">@interface</code>, you’ll find a <code class="language-plaintext highlighter-rouge">SWIFT_CLASS</code> macro:</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">SWIFT_CLASS</span><span class="p">(</span><span class="s">"_TtC12swift_module10SwiftClass"</span><span class="p">)</span>
<span class="k">@interface</span> <span class="nc">SwiftClass</span> <span class="p">:</span> <span class="nc">NSObject</span>
</code></pre></div></div>

<p>The string inside the macro is a bit cryptic, but you can
see it contains the module name and the class name:
<code class="language-plaintext highlighter-rouge">"_TtC12</code><strong><em><code class="language-plaintext highlighter-rouge">swift_module</code></em></strong><code class="language-plaintext highlighter-rouge">10</code><strong><em><code class="language-plaintext highlighter-rouge">SwiftClass</code></em></strong><code class="language-plaintext highlighter-rouge">"</code>.</p>

<p>Swift can even demangle this name for us:</p>

<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span><span class="nb">echo</span> <span class="s2">"_TtC12swift_module10SwiftClass"</span> | swift demangle
</code></pre></div></div>

<p>This outputs <code class="language-plaintext highlighter-rouge">swift_module.SwiftClass</code>.</p>

<h3 id="generating-the-dart-bindings-1">
<a class="anchor" href="#generating-the-dart-bindings-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Generating the Dart bindings</h3>

<p>As before, navigate to the example directory,
and run ffigen:</p>

<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>dart run ffigen
</code></pre></div></div>

<p>This generates <code class="language-plaintext highlighter-rouge">swift_api_bindings.dart</code>.</p>

<h3 id="using-the-bindings-1">
<a class="anchor" href="#using-the-bindings-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using the bindings</h3>

<p>Interacting with these bindings is exactly the same
as for a normal Objective-C library:</p>

<div class="language-dart highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="s">'dart:ffi'</span><span class="o">;</span>
<span class="kn">import</span> <span class="s">'swift_api_bindings.dart'</span><span class="o">;</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">final</span> <span class="n">lib</span> <span class="o">=</span> <span class="n">SwiftLibrary</span><span class="p">(</span><span class="n">DynamicLibrary</span><span class="o">.</span><span class="na">open</span><span class="p">(</span><span class="s">'libswiftapi.dylib'</span><span class="p">));</span>
  <span class="kd">final</span> <span class="n">object</span> <span class="o">=</span> <span class="n">SwiftClass</span><span class="o">.</span><span class="na">new1</span><span class="p">(</span><span class="n">lib</span><span class="p">);</span>
  <span class="n">print</span><span class="p">(</span><span class="n">object</span><span class="o">.</span><span class="na">sayHello</span><span class="p">());</span>
  <span class="n">print</span><span class="p">(</span><span class="s">'field = </span><span class="si">${object.someField}</span><span class="s">'</span><span class="p">);</span>
  <span class="n">object</span><span class="o">.</span><span class="na">someField</span> <span class="o">=</span> <span class="mi">456</span><span class="p">;</span>
  <span class="n">print</span><span class="p">(</span><span class="s">'field = </span><span class="si">${object.someField}</span><span class="s">'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Note that the module name is not mentioned
in the generated Dart API.
It’s only used internally,
to load the class from the dylib.</p>

<p>Now you can run the example using:</p>

<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>dart run example.dart
</code></pre></div></div>


          

        </div>
      </article>
    </main>
    <footer id="page-footer">
    <div class="footer-section footer-main">
      <a href="/" class="brand" title="Dart">
        <img src="/assets/img/shared/dart/logo+text/horizontal/white.svg" alt="Dart" width="164px">
      </a>
      <div class="footer-social-links">
        <a href="https://github.com/doggy8088/dart.tw" target="_blank" rel="noopener" title="GitHub" class="no-automatic-external">
          <svg>
            <use href="/assets/img/social/github.svg#github"></use>
          </svg>
        </a>
      </div>
    </div>
    <div class="footer-section footer-tray">
      <div class="footer-licenses">
        參考中文內容需註明本站及連結作為出處，英文內容和範例程式碼均遵從源站授權協議。
      </div>
      <div class="footer-utility-links">
        <ul>
          <li><a href="/terms" title="使用條款">使用條款</a></li>
          <li><a href="https://policies.google.com/privacy?hl=zh-TW" target="_blank" rel="noopener" title="隱私政策" class="no-automatic-external">隱私政策</a></li>
          <li><a href="/security" title="Security philosophy and practices">Dart 程式碼安全說明</a></li>
          <li><a href="https://flutter.tw/about" target="_blank">關於中文文件</a>
          </li><li><a href="https://flutter.tw/disclaimer" target="_blank">免責條款</a>
          </li><li><a href="https://dart.cn/" target="_blank">Dart 簡體中文文檔</a>
        </li></ul>
      </div>
    </div>
  </footer>

  

<script src="/assets/translator/js/translator.js"></script></body></html>